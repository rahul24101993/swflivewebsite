{"remainingRequest":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\@swf\\tooling\\rewired\\soaServiceLoader.js!C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\@swf\\core\\src\\kernel\\src\\js\\soa\\kernel\\soaService.js","dependencies":[{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\@swf\\core\\src\\kernel\\src\\js\\soa\\kernel\\soaService.js","mtime":1655724734704},{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\babel-loader\\lib\\index.js","mtime":1655724676058},{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\babel-loader\\lib\\index.js","mtime":1655724676058},{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\babel-loader\\lib\\index.js","mtime":1655724676058},{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1655724666708},{"path":"C:\\Users\\rahukl57\\Desktop\\SWF\\CreatingOwnComponentUsingJsx\\node_modules\\@swf\\tooling\\rewired\\soaServiceLoader.js","mtime":1655724719795}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gQ29weXJpZ2h0IChjKSAyMDIyIFNpZW1lbnMKLyogZXNsaW50LWRpc2FibGUgc29uYXJqcy9jb2duaXRpdmUtY29tcGxleGl0eSAqLwoKLyoqCiAqIFRoaXMgaXMgdGhlIFRlYW1jZW50ZXIgU09BIFNlcnZpY2UuIEl0J3MgdGhlIGNlbnRyYWwgcGlwZWxpbmUgZm9yIGludm9raW5nIEpTT04gU09BIEFQSXMgJiBGTVMgQVBJcyBmcm9tIHRoZSBjbGllbnQuCiAqCiAqIE5vdGU6IE1hbnkgb2YgdGhlIHRoZSBmdW5jdGlvbnMgZGVmaW5lZCBpbiB0aGlzIG1vZHVsZSByZXR1cm4gYSB7QGxpbmtjb2RlIG1vZHVsZTphbmd1amFyflByb21pc2V8UHJvbWlzZX0gb2JqZWN0LgogKiBUaGUgY2FsbGVyIHNob3VsZCBwcm92aWRlIGNhbGxiYWNrIGZ1bmN0aW9uKHMpIHRvIHRoZSAndGhlbicgbWV0aG9kIG9mIHRoaXMgcmV0dXJuZWQgb2JqZWN0IChlLmcuIHN1Y2Nlc3NDYWxsYmFjaywKICogW2Vycm9yQ2FsbGJhY2ssIFtub3RpZnlDYWxsYmFja11dKS4gVGhlc2UgbWV0aG9kcyB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBzZXJ2aWNlIHJlc3VsdCBpcyBrbm93bi4KICoKICogQG1vZHVsZSBzb2Eva2VybmVsL3NvYVNlcnZpY2UKICovCmltcG9ydCBBd1Byb21pc2VTZXJ2aWNlIGZyb20gJ2pzL2F3UHJvbWlzZVNlcnZpY2UnOwppbXBvcnQgQXdIdHRwU2VydmljZSBmcm9tICdqcy9hd0h0dHBTZXJ2aWNlJzsKaW1wb3J0IGNkbSBmcm9tICdzb2Eva2VybmVsL2NsaWVudERhdGFNb2RlbCc7CmltcG9ydCBjbW0gZnJvbSAnc29hL2tlcm5lbC9jbGllbnRNZXRhTW9kZWwnOwppbXBvcnQgcHJvcFBvbGljeVN2YyBmcm9tICdzb2Eva2VybmVsL3Byb3BlcnR5UG9saWN5U2VydmljZSc7CmltcG9ydCBhcHBDdHhTdmMgZnJvbSAnanMvYXBwQ3R4U2VydmljZSc7CmltcG9ydCB0eXBlQ2FjaGVTdmMgZnJvbSAnc29hL2tlcm5lbC90eXBlQ2FjaGVTZXJ2aWNlJzsKaW1wb3J0IGNvbmZpZ1N2YyBmcm9tICdqcy9jb25maWd1cmF0aW9uU2VydmljZSc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCBhc3NlcnQgZnJvbSAnYXNzZXJ0JzsKaW1wb3J0IERlYnVnIGZyb20gJ2RlYnVnJzsKaW1wb3J0IGxvZ2dlciBmcm9tICdqcy9sb2dnZXInOwppbXBvcnQgZXZlbnRCdXMgZnJvbSAnanMvZXZlbnRCdXMnOwppbXBvcnQgYnJvd3NlclV0aWxzIGZyb20gJ2pzL2Jyb3dzZXJVdGlscyc7CmltcG9ydCBsb2NhbFN0cmcgZnJvbSAnanMvbG9jYWxTdG9yYWdlJzsKCi8qKgogKiBCb29sZWFuIHRvIGluZGljYXRlIGlmIHdlJ3JlIHNpZ25lZCBpbnRvIHRoZSBzZXJ2ZXIuIFRoaXMgaXMganVzdCBhbiBvYnNlcnZlciBzdGF0ZS4gVHJ1ZSBzaWduaW4gc3RhdGUgaXMKICogbWFuYWdlZCBieSB0aGUgU2Vzc2lvbiBNYW5hZ2VyLgogKgogKiBAcHJpdmF0ZQogKi8KbGV0IF9zaWduZWRJbiA9IGZhbHNlOwoKLyoqCiAqIERhdGUvVGltZSBvZiB0aGUgbGFzdCBwcm9ncmVzcyAnc3RhcnQnLiBUaGlzIGlzIHVzZWQgdG8gY29tcHV0ZSB0aGUgYW1vdW50IG9mIHRpbWUgYSBzaW5nbGUgU09BIHBvc3QgdGFrZXMuCiAqCiAqIEBwcml2YXRlCiAqLwpjb25zdCBfbGFzdFN0YXJ0RGF0ZSA9IHt9OwoKLyoqCiAqIExpc3Qgb2YgdHlwZSBuYW1lcyB3aGljaCBoYXZlIGJlZW4gZGVlbWVkIGludmFsaWQgYmFzZWQgdXBvbiB0aGUgcHJldmlvdXMgc2VydmVyIHJlc3BvbnNlcy4KICoKICogQHByaXZhdGUKICovCmxldCBfaW52YWxpZFR5cGVOYW1lcyA9IFsgJ2NvbnRlbnRzJyBdOwoKLyoqCiAqIFR5cGVzIHRoYXQgbmVlZCBsb2FkZWQgaWYgYXZhaWxhYmxlLgogKiBPbiBBVyBzdGFydHVwLgogKiBAcHJpdmF0ZQogKi8KbGV0IF9hd1N0YXJ0dXBQcmVmZXJlbmNlczsKCi8qKgogKiBUeXBlcyBjYWNoZSB0aW1lc3RhbXAKICoKICogQHByaXZhdGUKICovCmxldCBfdHlwZUNhY2hlTE1EOwoKLyoqCiAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHRlc3QgaWYgYSBzdHJpbmcgZW5kcyB3aXRoICJbXSIKICovCmNvbnN0IFJFR0VYX0FSUkFZX1NVRkZJWCA9IC9cW1xdJC9pOwoKLyoqCiAqIENvbnN0YW50IGZvciBvcGVyYXRpb24gbmFtZSB1c2VkIGZvciBnZXQgVEMgU2Vzc2lvbiBJbmZvCiAqCiAqIEB0eXBlIHtzdHJpbmd9CiAqLwpjb25zdCBHRVRfU0VTU0lPTl9JTkZPID0gewogICAgc2VydmljZU5hbWU6ICdJbnRlcm5hbC1BV1MyLTIwMTctMTItRGF0YU1hbmFnZW1lbnQnLAogICAgb3BlcmF0aW9uTmFtZTogJ2dldFRDU2Vzc2lvbkFuYWx5dGljc0luZm8nCn07CgovKioKICogU09BIHJlZGlyZWN0CiAqLwpsZXQgX3JlZGlyZWN0U29hU3ZjOwoKZXhwb3J0IGNvbnN0IHNldFNvYVJlZGlyZWN0ID0gZnVuY3Rpb24oIHJlZGlyZWN0ICkgeyBfcmVkaXJlY3RTb2FTdmMgPSByZWRpcmVjdDsgfTsKCi8qKiBEZWJ1ZyB0cmFjZSBmdW5jdGlvbiAqLwpjb25zdCB0cmFjZSA9IG5ldyBEZWJ1ZyggJ3NvYVNlcnZpY2UnICk7CgovKiogT2JqZWN0IHRvIHRyYWNrIHdoaWNoIHR5cGVzIGFyZSBjdXJyZW50bHkgYmVpbmcgbG9hZGVkIHN1Y2ggdGhhdCBnZXRUeXBlRGVzY3JpcHRpb25zMiBpcyBub3QgZHVwbGljYXRlZCBmb3IgdGhlIHNhbWUgdHlwZSAqLwpjb25zdCBfdHlwZUxvYWRJblByb2dyZXNzID0ge307CgovKiogY2xpZW50IElEIHVzZWQgaW4gU09BIGhlYWRlciAqLwpsZXQgX2NsaWVudElkID0gJ0FjdGl2ZVdvcmtzcGFjZUNsaWVudCc7CgovKiogdGltZW91dCB0byBhbGxvdyBwb2xsaW5nIFNPQSBjYWxscyB0byBiZSBtYWRlIGFmdGVyIGxhc3Qgbm9uLXBvbGxpbmcgY2FsbCAqLwpsZXQgX3BvbGxpbmdUaW1lb3V0ID0gMTUgKiA2MDsgLy8gMTUgbWludXRlcyBkZWZhdWx0CgpsZXQgcGVuZGluZ1JlcXVlc3RzID0gMDsKCi8qKgogKiBJbml0aWFsaXplICdib2R5RWxlbWVudFtrZXldJyBiYXNlZCBvbiBnaXZlbiBpbmZvcm1hdGlvbi4KICoKICogQHByaXZhdGUKICoKICogQHBhcmFtIHtPYmplY3R9IHN0YXRlIC0gc3RhdGUgb2JqZWN0CiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlTmFtZSAtIHR5cGUgbmFtZQogKiBAcGFyYW0ge09iamVjdH0gYm9keUVsZW1lbnQgLSBib2R5IGVsZW1lbnQKICogQHBhcmFtIHtTdHJpbmd9IGtleSAtIGtleQogKiBAcGFyYW0ge0Jvb2xlYW59IGRlbGV0ZWQgLSB3YXMgdGhlIGtleSBqdXN0IGRlbGV0ZWQ/CiAqLwpmdW5jdGlvbiBpbml0aWFsaXplRmllbGQoIHN0YXRlLCB0eXBlTmFtZSwgYm9keUVsZW1lbnQsIGtleSwgZGVsZXRlZCApIHsKICAgIHN3aXRjaCAoIHR5cGVOYW1lICkgewogICAgICAgIGNhc2UgJ1N0cmluZyc6CiAgICAgICAgY2FzZSAnRGF0ZSc6CiAgICAgICAgICAgIGJvZHlFbGVtZW50WyBrZXkgXSA9ICcnOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdpbnQnOgogICAgICAgIGNhc2UgJ2Zsb2F0JzoKICAgICAgICBjYXNlICdkb3VibGUnOgogICAgICAgICAgICBib2R5RWxlbWVudFsga2V5IF0gPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICAgICAgYm9keUVsZW1lbnRbIGtleSBdID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ01vZGVsT2JqJzoKICAgICAgICBjYXNlICdNb2RlbE9iamVjdCc6CiAgICAgICAgICAgIGJvZHlFbGVtZW50WyBrZXkgXSA9IHsKICAgICAgICAgICAgICAgIHVpZDogZGVsZXRlZCA/IGNkbS5OVUxMX1VJRCA6ICcnLAogICAgICAgICAgICAgICAgdHlwZTogZGVsZXRlZCA/ICd1bmtub3duVHlwZScgOiAnJwogICAgICAgICAgICB9OwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiggUkVHRVhfQVJSQVlfU1VGRklYLnRlc3QoIHR5cGVOYW1lICkgKSB7CiAgICAgICAgICAgICAgICAvLyBBcnJheQogICAgICAgICAgICAgICAgYm9keUVsZW1lbnRbIGtleSBdID0gW107CiAgICAgICAgICAgIH0gZWxzZSBpZiggc3RhdGUuc2NoZW1hU2VydmljZS5oYXNPd25Qcm9wZXJ0eSggdHlwZU5hbWUgKSAmJiBfLmlzQXJyYXkoIHN0YXRlLnNjaGVtYVNlcnZpY2VbIHR5cGVOYW1lIF0gKSApIHsKICAgICAgICAgICAgICAgIC8vIEVudW0gc3VwcG9ydC4uLiBkZWZhdWx0IHRvIGZpcnN0IGVudHJ5CiAgICAgICAgICAgICAgICBib2R5RWxlbWVudFsga2V5IF0gPSBzdGF0ZS5zY2hlbWFTZXJ2aWNlWyB0eXBlTmFtZSBdWyAwIF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBPYmplY3Qgb3IgbWFwCiAgICAgICAgICAgICAgICBib2R5RWxlbWVudFsga2V5IF0gPSB7fTsKICAgICAgICAgICAgfQogICAgfQp9CgovKioKICogVFJVRSBpZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBpbiB0aGUgc2NoZW1hLgogKgogKiBAcHJpdmF0ZQogKgogKiBAcGFyYW0ge09iamVjdH0gc3RhdGUgLSBzdGF0ZSBvYmplY3QKICogQHBhcmFtIHtPYmplY3R9IHNjaGVtYUVsZW1lbnQgLSBzY2hlbWEgZWxlbWVudCB0byBldmFsdWF0ZSB0byBkZXRlcm1pbmUgaWYgZWxlbWVudCBzaG91bGQgYmUgYSBtYXAKICoKICogQHJldHVybnMge0Jvb2xlYW59IFRSVUUgaWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgaW4gdGhlIHNjaGVtYS4KICovCmZ1bmN0aW9uIGlzTWFwKCBzdGF0ZSwgc2NoZW1hRWxlbWVudCApIHsKICAgIGlmKCBPYmplY3Qua2V5cyggc2NoZW1hRWxlbWVudCApLmxlbmd0aCA9PT0gMiAmJgogICAgICAgIHNjaGVtYUVsZW1lbnQuaGFzT3duUHJvcGVydHkoICdrZXknICkgJiYKICAgICAgICBzY2hlbWFFbGVtZW50Lmhhc093blByb3BlcnR5KCAndmFsdWUnICkgJiYKICAgICAgICAhc3RhdGUuc2NoZW1hU2VydmljZS5oYXNPd25Qcm9wZXJ0eSggc2NoZW1hRWxlbWVudC5rZXkgKSApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKLyoqCiAqIFZhbGlkYXRlIGVsZW1lbnQgdHlwZSAmIHJlY3Vyc2UgaWYgbm9uLXRyaXZpYWwgdHlwZS4KICoKICogQHByaXZhdGUKICoKICogQHBhcmFtIHtPYmplY3R9IHN0YXRlIC0gc3RhdGUgb2JqZWN0CiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlTmFtZSAtIHR5cGUgbmFtZQogKiBAcGFyYW0ge09iamVjdH0gYm9keUVsZW1lbnQgLSBib2R5IGVsZW1lbnQKICogQHJldHVybnMge09iamVjdH0gLi4uCiAqLwpmdW5jdGlvbiB2YWxpZGF0ZUVsZW1lbnRUeXBlKCBzdGF0ZSwgdHlwZU5hbWUsIGJvZHlFbGVtZW50ICkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNvbXBsZXhpdHkKICAgIHN3aXRjaCAoIHR5cGVOYW1lICkgewogICAgICAgIGNhc2UgJ1N0cmluZyc6CiAgICAgICAgY2FzZSAnRGF0ZSc6CiAgICAgICAgICAgIGlmKCAhXy5pc1N0cmluZyggYm9keUVsZW1lbnQgKSApIHsKICAgICAgICAgICAgICAgIHN0YXRlLmlzc3Vlcy5wdXNoKCAnSU5WQUxJRCBGSUVMRDogRXhwZWN0ZWQgc3RyaW5nLCBub3QgJyArIHR5cGVvZiBib2R5RWxlbWVudCArICcgLS0nICsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5qb2luKCAnLicgKSApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2ludCc6CiAgICAgICAgY2FzZSAnZmxvYXQnOgogICAgICAgIGNhc2UgJ2RvdWJsZSc6CiAgICAgICAgICAgIGlmKCAhXy5pc051bWJlciggYm9keUVsZW1lbnQgKSApIHsKICAgICAgICAgICAgICAgIHN0YXRlLmlzc3Vlcy5wdXNoKCAnSU5WQUxJRCBGSUVMRDogRXhwZWN0ZWQgbnVtYmVyLCBub3QgJyArIHR5cGVvZiBib2R5RWxlbWVudCArICcgLS0nICsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5qb2luKCAnLicgKSApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgICBpZiggIV8uaXNCb29sZWFuKCBib2R5RWxlbWVudCApICkgewogICAgICAgICAgICAgICAgc3RhdGUuaXNzdWVzLnB1c2goICdJTlZBTElEIEZJRUxEOiBFeHBlY3RlZCBib29sZWFuLCBub3QgJyArIHR5cGVvZiBib2R5RWxlbWVudCArICcgLS0nICsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5qb2luKCAnLicgKSApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ01vZGVsT2JqJzoKICAgICAgICBjYXNlICdNb2RlbE9iamVjdCc6CiAgICAgICAgICAgIGlmKCAhYm9keUVsZW1lbnQgfHwgIWJvZHlFbGVtZW50LnVpZCB8fCAhYm9keUVsZW1lbnQudHlwZSApIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdWlkOiAhYm9keUVsZW1lbnQgfHwgIWJvZHlFbGVtZW50LnVpZCA/IGNkbS5OVUxMX1VJRCA6IGJvZHlFbGVtZW50LnVpZCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAhYm9keUVsZW1lbnQgfHwgIWJvZHlFbGVtZW50LnR5cGUgPyAndW5rbm93blR5cGUnIDogYm9keUVsZW1lbnQudHlwZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggT2JqZWN0LmtleXMoIGJvZHlFbGVtZW50ICkubGVuZ3RoICE9PSAyICkgewogICAgICAgICAgICAgICAgLy8gcmVwbGFjZSB3aXRoIG5ldyBvYmplY3QgaWYgaXQncyBub3QgYWxyZWFkeSB1aWQgJiB0eXBlIG9ubHkKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdWlkOiBib2R5RWxlbWVudC51aWQsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogYm9keUVsZW1lbnQudHlwZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdJQ3JlYXRlSW5wdXQnOgogICAgICAgICAgICBpZiggIWJvZHlFbGVtZW50IHx8ICFib2R5RWxlbWVudC5ib05hbWUgfHwgIV8uaXNTdHJpbmcoIGJvZHlFbGVtZW50LmJvTmFtZSApICkgewogICAgICAgICAgICAgICAgc3RhdGUuaXNzdWVzLnB1c2goICdJTlZBTElEIEZJRUxEIFZBTFVFOiBFeHBlY3QgdHlwZSBvZiBJQ3JlYXRlSW5wdXQnICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYoIHN0YXRlLnNjaGVtYVNlcnZpY2UuaGFzT3duUHJvcGVydHkoIHR5cGVOYW1lICkgKSB7CiAgICAgICAgICAgICAgICBpZiggXy5pc0FycmF5KCBzdGF0ZS5zY2hlbWFTZXJ2aWNlWyB0eXBlTmFtZSBdICkgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRW51bQogICAgICAgICAgICAgICAgICAgIGlmKCBzdGF0ZS5zY2hlbWFTZXJ2aWNlWyB0eXBlTmFtZSBdLmluZGV4T2YoIGJvZHlFbGVtZW50ICkgPT09IC0xICkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5pc3N1ZXMucHVzaCggJ0lOVkFMSUQgRklFTEQgVkFMVUU6IE5vdCB2YWxpZCBlbnVtIHZhbHVlICcgKyB0eXBlTmFtZSArICcgZXhwZWN0ZWQgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zY2hlbWFTZXJ2aWNlWyB0eXBlTmFtZSBdLnRvU3RyaW5nKCkgKyAnIC0tJyArIHN0YXRlLnN0YWNrLmpvaW4oICcuJyApICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBPYmplY3QgcHJvY2Vzc2luZwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRBbmRWYWxpZGF0ZUVsZW1lbnRSZWN1cnNlKCBzdGF0ZSwgc3RhdGUuc2NoZW1hU2VydmljZVsgdHlwZU5hbWUgXSwgYm9keUVsZW1lbnQgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmKCBSRUdFWF9BUlJBWV9TVUZGSVgudGVzdCggdHlwZU5hbWUgKSApIHsKICAgICAgICAgICAgICAgIC8vIEFycmF5IHByb2Nlc3NpbmcKICAgICAgICAgICAgICAgIGlmKCAhXy5pc0FycmF5KCBib2R5RWxlbWVudCApICkgewogICAgICAgICAgICAgICAgICAgIHN0YXRlLmlzc3Vlcy5wdXNoKCAnSU5WQUxJRCBGSUVMRDogRXhwZWN0ZWQgYXJyYXksIG5vdCAnICsgdHlwZW9mIGJvZHlFbGVtZW50ICsgJyAtLScgKwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5qb2luKCAnLicgKSApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlTmFtZTIgPSB0eXBlTmFtZS5zdWJzdHJpbmcoIDAsIHR5cGVOYW1lLmxlbmd0aCAtIDIgKTsKICAgICAgICAgICAgICAgIGxldCByZXBsYWNlbWVudEFycmF5ID0gbnVsbDsKICAgICAgICAgICAgICAgIGZvciggbGV0IGlpID0gYm9keUVsZW1lbnQubGVuZ3RoIC0gMTsgaWkgPj0gMDsgaWktLSApIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5wdXNoKCBpaSApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcGxhY2VtZW50ID0gdmFsaWRhdGVFbGVtZW50VHlwZSggc3RhdGUsIHR5cGVOYW1lMiwgYm9keUVsZW1lbnRbIGlpIF0gKTsKICAgICAgICAgICAgICAgICAgICBpZiggcmVwbGFjZW1lbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAhcmVwbGFjZW1lbnRBcnJheSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3VsZCBwcm9iYWJseSByZXBsYWNlIHRoZSBhcnJheSBpbiBjYXNlIGNhbGxlciBpcyB1c2luZyBmb3Igc29tZXRoaW5nIGVsc2UuLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50QXJyYXkgPSBib2R5RWxlbWVudC5zbGljZSggMCApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50QXJyYXlbIGlpIF0gPSByZXBsYWNlbWVudDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggcmVwbGFjZW1lbnRBcnJheSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVwbGFjZW1lbnRBcnJheTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmKCAvXihTdHJpbmd8SW50fEJvb2x8RG91YmxlfEZsb2F0fERhdGV8VGFnKSh8VmVjdG9yKU1hcC8udGVzdCggdHlwZU5hbWUgKSApIHsKICAgICAgICAgICAgICAgIC8vIE1hcCBwcm9jZXNzaW5nCiAgICAgICAgICAgICAgICBsZXQgdHlwZU5hbWUyOwogICAgICAgICAgICAgICAgaWYoIHR5cGVOYW1lLmluZGV4T2YoICdTdHJpbmcnICkgPT09IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZU5hbWUyID0gJ1N0cmluZyc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIHR5cGVOYW1lLmluZGV4T2YoICdEYXRlJyApID09PSAwICkgewogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lMiA9ICdEYXRlJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiggdHlwZU5hbWUuaW5kZXhPZiggJ0ludCcgKSA9PT0gMCApIHsKICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZTIgPSAnaW50JzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiggdHlwZU5hbWUuaW5kZXhPZiggJ0Zsb2F0JyApID09PSAwICkgewogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lMiA9ICdmbG9hdCc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIHR5cGVOYW1lLmluZGV4T2YoICdEb3VibGUnICkgPT09IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZU5hbWUyID0gJ2RvdWJsZSc7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIHR5cGVOYW1lLmluZGV4T2YoICdCb29sJyApID09PSAwICkgewogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lMiA9ICdib29sZWFuJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiggdHlwZU5hbWUuaW5kZXhPZiggJ1RhZycgKSA9PT0gMCApIHsKICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZTIgPSAnTW9kZWxPYmplY3QnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIC9WZWN0b3JNYXAvZy50ZXN0KCB0eXBlTmFtZSApICkgewogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lMiArPSAnW10nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXy5mb3JFYWNoKCBib2R5RWxlbWVudCwgZnVuY3Rpb24oIHZhbHVlLCBrZXkgKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlRmluYWwgPSB2YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYoICFfLmlzU3RyaW5nKCBrZXkgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuaXNzdWVzLnB1c2goICdJTlZBTElEIEZJRUxEOiBFeHBlY3RlZCBzdHJpbmcsIG5vdCAnICsgdHlwZW9mIGtleSArICcgLS0nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YWNrLmpvaW4oICcuJyApICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoIHR5cGVOYW1lMiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICFib2R5RWxlbWVudFsga2V5IF0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplRmllbGQoIHN0YXRlLCB0eXBlTmFtZTIsIGJvZHlFbGVtZW50LCBrZXksIGZhbHNlICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUZpbmFsID0gYm9keUVsZW1lbnRbIGtleSBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCB0eXBlTmFtZTIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggIWJvZHlFbGVtZW50WyBrZXkgXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplRmllbGQoIHN0YXRlLCB0eXBlTmFtZTIsIGJvZHlFbGVtZW50LCBrZXksIGZhbHNlICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVGaW5hbCA9IGJvZHlFbGVtZW50WyBrZXkgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YWNrLnB1c2goIGtleSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSB2YWxpZGF0ZUVsZW1lbnRUeXBlKCBzdGF0ZSwgdHlwZU5hbWUyLCB2YWx1ZUZpbmFsICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggcmVwbGFjZW1lbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keUVsZW1lbnRbIGtleSBdID0gcmVwbGFjZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmlzc3Vlcy5wdXNoKCAnSU5WQUxJRCBGSUVMRDogVW5zdXBwb3J0ZWQgbWFwIHR5cGUgb2YgJyArIHR5cGVOYW1lICsgJyAtLScgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YWNrLmpvaW4oICcuJyApICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuaXNzdWVzLnB1c2goICdJTlZBTElEIEZJRUxEOiBVbnN1cHBvcnRlZCBtYXAgdHlwZSBvZiAnICsgdHlwZU5hbWUgKyAnIC0tJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5qb2luKCAnLicgKSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0YXRlLmlzc3Vlcy5wdXNoKCAnSU5WQUxJRCBGSUVMRDogVW5zdXBwb3J0ZWQgdHlwZSBvZiAnICsgdHlwZU5hbWUgKyAnIC0tJyArCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3RhY2suam9pbiggJy4nICkgKTsKICAgICAgICAgICAgfQogICAgfQp9CgovKioKICogUmVjdXJzaXZlIG1ldGhvZCBmb3IgZGVmYXVsdCAmIHZhbGlkYXRlIFNPQSBvcGVyYXRpb24gYm9keS4KICoKICogQHBhcmFtIHtPYmplY3R9IHN0YXRlIC0gc3RhdGUgb2JqZWN0CiAqIEBwYXJhbSB7T2JqZWN0fSBzY2hlbWFFbGVtZW50IC0gc2NoZW1hIGVsZW1lbnQvY3Vyc29yIGZvciB0aGUgd2FsawogKiBAcGFyYW0ge09iamVjdH0gYm9keUVsZW1lbnQgLSBib2R5IGVsZW1lbnQvY3Vyc29yIGZvciB0aGUgd2FsawogKiBAcHJpdmF0ZQogKi8KZnVuY3Rpb24gZGVmYXVsdEFuZFZhbGlkYXRlRWxlbWVudFJlY3Vyc2UoIHN0YXRlLCBzY2hlbWFFbGVtZW50LCBib2R5RWxlbWVudCApIHsKICAgIC8vIFdhbGsgc2NoZW1hIHRvIGFkZCBhbnkgbWlzc2luZyBmaWVsZHMKICAgIGNvbnN0IGlzTWFwTGNsID0gaXNNYXAoIHN0YXRlLCBzY2hlbWFFbGVtZW50ICk7CgogICAgaWYoICFpc01hcExjbCApIHsKICAgICAgICBfLmZvckVhY2goIHNjaGVtYUVsZW1lbnQsIGZ1bmN0aW9uKCB0eXBlTmFtZSwga2V5MiApIHsKICAgICAgICAgICAgbGV0IGRlbGV0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYoIGJvZHlFbGVtZW50Lmhhc093blByb3BlcnR5KCBrZXkyICkgJiYKICAgICAgICAgICAgICAgIGJvZHlFbGVtZW50WyBrZXkyIF0gPT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgYm9keUVsZW1lbnRbIGtleTIgXTsKICAgICAgICAgICAgICAgIGRlbGV0ZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggIWJvZHlFbGVtZW50Lmhhc093blByb3BlcnR5KCBrZXkyICkgfHwgIWJvZHlFbGVtZW50WyBrZXkyIF0gKSB7CiAgICAgICAgICAgICAgICBpbml0aWFsaXplRmllbGQoIHN0YXRlLCB0eXBlTmFtZSwgYm9keUVsZW1lbnQsIGtleTIsIGRlbGV0ZWQgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gKTsKICAgIH0KCiAgICAvLyBXYWxrIGJvZHkgZWxlbWVudCB0byB2YWxpZGF0ZSBhZ2FpbnN0IHNjaGVtYSAmIHJlY3Vyc2UKICAgIGxldCByZXBsYWNlbWVudCA9IG51bGw7CgogICAgXy5mb3JFYWNoKCBib2R5RWxlbWVudCwgZnVuY3Rpb24gZm9yRWFjaGRlZmF1bHRBbmRWYWxpZGF0ZUVsZW1lbnRSZWN1cnNlKCB2YWx1ZSwga2V5MiApIHsKICAgICAgICBpZiggaXNNYXBMY2wgKSB7CiAgICAgICAgICAgIGlmKCBfLmlzQXJyYXkoIGJvZHlFbGVtZW50ICkgKSB7CiAgICAgICAgICAgICAgICBmb3IoIGxldCBpaSA9IDA7IGlpIDwgYm9keUVsZW1lbnRbIDAgXS5sZW5ndGg7IGlpKysgKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3RhY2sucHVzaCggaWkgKTsKICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudCA9IHZhbGlkYXRlRWxlbWVudFR5cGUoIHN0YXRlLCBzY2hlbWFFbGVtZW50LmtleSwgYm9keUVsZW1lbnRbIDAgXVsgaWkgXSApOwogICAgICAgICAgICAgICAgICAgIGlmKCByZXBsYWNlbWVudCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYm9keUVsZW1lbnRbIDAgXVsgaWkgXSA9IHJlcGxhY2VtZW50OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXBsYWNlbWVudCA9IHZhbGlkYXRlRWxlbWVudFR5cGUoIHN0YXRlLCBzY2hlbWFFbGVtZW50LnZhbHVlLCBib2R5RWxlbWVudFsgMSBdWyBpaSBdICk7CiAgICAgICAgICAgICAgICAgICAgaWYoIHJlcGxhY2VtZW50ICkgewogICAgICAgICAgICAgICAgICAgICAgICBib2R5RWxlbWVudFsgMSBdWyBpaSBdID0gcmVwbGFjZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9yKCBjb25zdCBtYXBLZXkgaW4gYm9keUVsZW1lbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoIGJvZHlFbGVtZW50Lmhhc093blByb3BlcnR5KCBrZXkyICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnN0YWNrLnB1c2goIGtleTIgKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSB2YWxpZGF0ZUVsZW1lbnRUeXBlKCBzdGF0ZSwgc2NoZW1hRWxlbWVudC5rZXksIG1hcEtleSApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiggcmVwbGFjZW1lbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IGJvZHlFbGVtZW50WyBtYXBLZXkgXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBib2R5RWxlbWVudFsgbWFwS2V5IF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5RWxlbWVudFsgcmVwbGFjZW1lbnQgXSA9IG9sZFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50ID0gdmFsaWRhdGVFbGVtZW50VHlwZSggc3RhdGUsIHNjaGVtYUVsZW1lbnQudmFsdWUsIGJvZHlFbGVtZW50WyBtYXBLZXkgXSApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiggcmVwbGFjZW1lbnQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5RWxlbWVudFsgbWFwS2V5IF0gPSByZXBsYWNlbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYoIHNjaGVtYUVsZW1lbnQuaGFzT3duUHJvcGVydHkoIGtleTIgKSApIHsKICAgICAgICAgICAgc3RhdGUuc3RhY2sucHVzaCgga2V5MiApOwogICAgICAgICAgICByZXBsYWNlbWVudCA9IHZhbGlkYXRlRWxlbWVudFR5cGUoIHN0YXRlLCBzY2hlbWFFbGVtZW50WyBrZXkyIF0sIHZhbHVlICk7CiAgICAgICAgICAgIGlmKCByZXBsYWNlbWVudCApIHsKICAgICAgICAgICAgICAgIGJvZHlFbGVtZW50WyBrZXkyIF0gPSByZXBsYWNlbWVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5zdGFjay5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS5pc3N1ZXMucHVzaCggJ0lOVkFMSUQgRklFTEQ6IFVuZXhwZWN0ZWQgdHlwZSBvZiAnICsgc3RhdGUuc3RhY2suam9pbiggJy4nICkgKyAnLicgKyBrZXkyICk7CiAgICAgICAgICAgIGRlbGV0ZSBib2R5RWxlbWVudFsga2V5MiBdOwogICAgICAgIH0KICAgIH0gKTsKfQoKLyoqCiAqIERlZmF1bHQgJiB2YWxpZGF0ZSBTT0Egb3BlcmF0aW9uIGJvZHkuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBzY2hlbWFTZXJ2aWNlIC0gc2NoZW1hIGZvciBzZXJ2aWNlCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSAtIHNlcnZpY2UgbmFtZQogKiBAcGFyYW0ge1N0cmluZ30gb3BlcmF0aW9uTmFtZSAtIG9wZXJhdGlvbiBuYW1lCiAqIEBwYXJhbSB7T2JqZWN0fSBib2R5IC0gcmVxdWVzdCBib2R5CiAqIEByZXR1cm5zIHtPYmplY3R9IHJlcXVlc3QgYm9keSB3aXRoIGRlZmF1bHRpbmcgJiB2YWxpZGF0aW9uIGNvbXBsZXRlCiAqIEBwcml2YXRlCiAqLwpmdW5jdGlvbiBkZWZhdWx0QW5kVmFsaWRhdGVFbGVtZW50KCBzY2hlbWFTZXJ2aWNlLCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwgYm9keSApIHsKICAgIGNvbnN0IHN0YXRlID0gewogICAgICAgIC8vIElmIGNhbGxlciBoYXMgcGFzc2VkIG51bGwsIHRoZXkndmUgaW5kaWNhdGVkIHRoYXQgdGhlcmUncyBhbiBlbXB0eSBib2R5LgogICAgICAgIGJvZHk6IGJvZHkgPyBib2R5IDoge30sCiAgICAgICAgc2VydmljZU5hbWU6IHNlcnZpY2VOYW1lLAogICAgICAgIG9wZXJhdGlvbk5hbWU6IG9wZXJhdGlvbk5hbWUsCiAgICAgICAgc2NoZW1hU2VydmljZTogc2NoZW1hU2VydmljZSwKICAgICAgICBpc3N1ZXM6IFtdLAogICAgICAgIHN0YWNrOiBbXQogICAgfTsKCiAgICBpZiggc3RhdGUuc2NoZW1hU2VydmljZSApIHsKICAgICAgICBzdGF0ZS5vcGVyYXRpb24gPSBzdGF0ZS5zY2hlbWFTZXJ2aWNlWyBzdGF0ZS5vcGVyYXRpb25OYW1lIF07CiAgICAgICAgaWYoIHN0YXRlLm9wZXJhdGlvbiApIHsKICAgICAgICAgICAgLy8gV2FsayBib2R5IG1ha2Ugc3VyZSBpdCBhbGlnbnMgdG8gdGhlIHNjaGVtYQogICAgICAgICAgICBkZWZhdWx0QW5kVmFsaWRhdGVFbGVtZW50UmVjdXJzZSggc3RhdGUsIHN0YXRlLm9wZXJhdGlvbiwgc3RhdGUuYm9keSApOwoKICAgICAgICAgICAgaWYoIHN0YXRlLmlzc3Vlcy5sZW5ndGggPiAwICkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCAnSW52YWxpZCBTT0EgcmVxdWVzdCBib2R5IVxuJyArIHN0YXRlLmlzc3Vlcy5qb2luKCAnXG4nICkgKyAnXG5cbklucHV0IGJvZHk6JywKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5ib2R5ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoICdObyBTT0Egb3BlcmF0aW9uIGZvciAnICsgc3RhdGUuc2VydmljZU5hbWUgKyAnICcgKyBzdGF0ZS5vcGVyYXRpb25OYW1lICsKICAgICAgICAgICAgICAgICchIFNraXBwaW5nIHZhbGlkYXRpb24gJiBkZWZhdWx0IG9mIFNPQSBpbnB1dC4nICk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBsb2dnZXIuZXJyb3IoICdObyBTT0Egc2VydmljZSBmb3IgJyArIHN0YXRlLnNlcnZpY2VOYW1lICsKICAgICAgICAgICAgJyEgU2tpcHBpbmcgdmFsaWRhdGlvbiAmIGRlZmF1bHQgb2YgU09BIGlucHV0LicgKTsKICAgIH0KICAgIHJldHVybiBzdGF0ZS5ib2R5Owp9CgovLyBSZXNwb25zZSBwcm9jZXNzaW5nCgovKioKICogUHJvY2VzcyBhbiBhcnJheSBvZiBvYmplY3RzIHRvIGNyZWF0ZSBhIHNpbmdsZSBzdHJpbmcgb2YgbWVzc2FnZXMuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlcyAtIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyBtZXNzYWdlIGZpZWxkcwogKiBAcGFyYW0ge09iamVjdH0gbXNnT2JqIC0gbWVzc2FnZSBvYmplY3Qgd2l0aCBtZXNzYWdlIHZhbHVlICYgbGV2ZWwKICovCmZ1bmN0aW9uIGdldE1lc3NhZ2VTdHJpbmcoIG1lc3NhZ2VzLCBtc2dPYmogKSB7CiAgICBfLmZvckVhY2goIG1lc3NhZ2VzLCBmdW5jdGlvbiggb2JqZWN0ICkgewogICAgICAgIGlmKCBtc2dPYmoubXNnLmxlbmd0aCA+IDAgKSB7CiAgICAgICAgICAgIG1zZ09iai5tc2cgKz0gJ1xuJzsKICAgICAgICB9CiAgICAgICAgbXNnT2JqLm1zZyArPSBvYmplY3QubWVzc2FnZTsKICAgICAgICBtc2dPYmoubGV2ZWwgPSBfLm1heCggWyBtc2dPYmoubGV2ZWwsIG9iamVjdC5sZXZlbCBdICk7CiAgICB9ICk7Cn0KCi8qKgogKiBSZXR1cm4gYSByZWZlcmVuY2UgdG8gYSBuZXcgJ2Vycm9yJyBvYmplY3Qgc2V0IHdpdGggdGhlIGdpdmVuIGVycm9yIGluZm9ybWF0aW9uLgogKgogKiBAcGFyYW0ge09iamVjdH0gZXJySW4gLSBlcnJvciBpbgogKgogKiBAcmV0dXJucyB7T2JqZWN0fSAtIEphdmFTY3JpcHQgRXJyb3Igb2JqZWN0CiAqLwpleHBvcnQgY29uc3QgY3JlYXRlRXJyb3IgPSBmdW5jdGlvbiggZXJySW4gKSB7CiAgICBjb25zdCBtc2dPYmogPSB7CiAgICAgICAgbXNnOiAnJywKICAgICAgICBsZXZlbDogMAogICAgfTsKICAgIGlmKCBlcnJJbi5tZXNzYWdlICkgewogICAgICAgIG1zZ09iai5tc2cgPSBlcnJJbi5tZXNzYWdlOwogICAgfSBlbHNlIGlmKCBlcnJJbi5zdGF0dXMgfHwgZXJySW4uc3RhdHVzVGV4dCApIHsKICAgICAgICBtc2dPYmoubXNnID0gZXJySW4uc3RhdHVzICsgJyAnICsgZXJySW4uc3RhdHVzVGV4dDsKICAgIH0gZWxzZSBpZiggZXJySW4uUGFydGlhbEVycm9ycyApIHsKICAgICAgICBfLmZvckVhY2goIGVyckluLlBhcnRpYWxFcnJvcnMsIGZ1bmN0aW9uKCBwYXJ0aWFsRXJyb3IgKSB7CiAgICAgICAgICAgIGdldE1lc3NhZ2VTdHJpbmcoIHBhcnRpYWxFcnJvci5lcnJvclZhbHVlcywgbXNnT2JqICk7CiAgICAgICAgfSApOwogICAgfSBlbHNlIGlmKCBlcnJJbi5wYXJ0aWFsRXJyb3JzICkgewogICAgICAgIF8uZm9yRWFjaCggZXJySW4ucGFydGlhbEVycm9ycywgZnVuY3Rpb24oIHBhcnRpYWxFcnJvciApIHsKICAgICAgICAgICAgZ2V0TWVzc2FnZVN0cmluZyggcGFydGlhbEVycm9yLmVycm9yVmFsdWVzLCBtc2dPYmogKTsKICAgICAgICB9ICk7CiAgICB9IGVsc2UgaWYoIGVyckluLm1lc3NhZ2VzICkgewogICAgICAgIGdldE1lc3NhZ2VTdHJpbmcoIGVyckluLm1lc3NhZ2VzLCBtc2dPYmogKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbXNnT2JqLm1zZyA9IGVyckluLnRvU3RyaW5nKCk7CiAgICB9CiAgICBpZiggZXJySW4uZGF0YSAmJiBlcnJJbi5kYXRhLm1lc3NhZ2VzICkgewogICAgICAgIGdldE1lc3NhZ2VTdHJpbmcoIGVyckluLmRhdGEubWVzc2FnZXMsIG1zZ09iaiApOwogICAgfQogICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoIG1zZ09iai5tc2cgKTsKICAgIGVycm9yLmNhdXNlID0gZXJySW47CiAgICBlcnJvci5sZXZlbCA9IG1zZ09iai5sZXZlbDsKICAgIHJldHVybiBlcnJvcjsKfTsKCi8qKgogKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UgLSByZXNwb25zZQogKiBAcmV0dXJuIHtPYmplY3R8bnVsbH0gc2VydmljZSBkYXRhCiAqLwpmdW5jdGlvbiBnZXRTZXJ2aWNlRGF0YSggcmVzcG9uc2UgKSB7CiAgICBpZiggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoICcuUU5hbWUnICkgJiYgL1wuU2VydmljZURhdGEkLy50ZXN0KCByZXNwb25zZVsgJy5RTmFtZScgXSApICkgewogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0gZWxzZSBpZiggcmVzcG9uc2UuU2VydmljZURhdGEgKSB7CiAgICAgICAgLy8gSWYgdGhlIHNlcnZpY2UgZGF0YSBpcyBhIG1lbWJlciBmaWVsZCwgdXBkYXRlIHRoZSBzZXJ2aWNlIGRhdGEgcmVmZXJlbmNlCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLlNlcnZpY2VEYXRhOwogICAgfQp9CgovKioKICogUHJvY2VzcyBTT0EgcGFydGlhbCBleGNlcHRpb25zIGluIHJlc3BvbnNlLgogKgogKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UgSlNPTiByZXNwb25zZSBkYXRhCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSAtIHNlcnZpY2UgbmFtZQogKiBAcGFyYW0ge1N0cmluZ30gb3BlcmF0aW9uTmFtZSAtIG9wZXJhdGlvbiBuYW1lCiAqIEByZXR1cm4ge09iamVjdH0gcmVzcG9uc2UgSlNPTiByZXNwb25zZSBkYXRhCiAqLwpmdW5jdGlvbiBwcm9jZXNzRXhjZXB0aW9ucyggcmVzcG9uc2UsIHNlcnZpY2VOYW1lLCBvcGVyYXRpb25OYW1lICkgewogICAgY29uc3Qgc2VydmljZURhdGEgPSBnZXRTZXJ2aWNlRGF0YSggcmVzcG9uc2UgKTsKICAgIGlmKCBzZXJ2aWNlRGF0YSAmJiBzZXJ2aWNlRGF0YS5wYXJ0aWFsRXJyb3JzIHx8CiAgICAgICAgcmVzcG9uc2UuUGFydGlhbEVycm9ycyAmJiAhXy5pc0VtcHR5KCByZXNwb25zZS5QYXJ0aWFsRXJyb3JzICkgKSB7CiAgICAgICAgLy8gUHVibGlzaCBTQU4gZXZlbnQgdG8gbG9nIHRoZSBTT0EgZXJyb3JzIHRvIGFuYWx5dGljcwogICAgICAgIGxldCBxTmFtZSA9ICd1bmtub3duJzsKICAgICAgICBpZiggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoICcuUU5hbWUnICkgKSB7CiAgICAgICAgICAgIHFOYW1lID0gcmVzcG9uc2VbICcuUU5hbWUnIF07CiAgICAgICAgfQoKICAgICAgICBldmVudEJ1cy5wdWJsaXNoT25DaGFubmVsKCB7CiAgICAgICAgICAgIGNoYW5uZWw6ICdTQU5fRXZlbnRzJywKICAgICAgICAgICAgdG9waWM6ICdhdy1jb21tYW5kLWxvZ0VycnJvcycsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHNhblFOYW1lOiBxTmFtZSwKICAgICAgICAgICAgICAgIHNhblBhcnRpYWxFcnJvcnM6IHNlcnZpY2VEYXRhICYmIHNlcnZpY2VEYXRhLnBhcnRpYWxFcnJvcnMgfHwgcmVzcG9uc2UsCiAgICAgICAgICAgICAgICBzYW5TZXJ2aWNlTmFtZTogc2VydmljZU5hbWUsCiAgICAgICAgICAgICAgICBzYW5PcGVyYXRpb25OYW1lOiBvcGVyYXRpb25OYW1lLAogICAgICAgICAgICAgICAgc2FuTG9nQ29ycmVsYXRpb25JRDogbG9nZ2VyLmdldENvcnJlbGF0aW9uSUQoKQogICAgICAgICAgICB9CiAgICAgICAgfSApOwogICAgfQoKICAgIC8vIFNob3VsZCB3ZSBzZWFyY2ggZm9yICdFeGNlcHRpb24nIGluIFFOYW1lPwogICAgaWYoIHJlc3BvbnNlICYmIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCAnLlFOYW1lJyApICkgewogICAgICAgIGlmKCAvSW52YWxpZFVzZXJFeGNlcHRpb24kLy50ZXN0KCByZXNwb25zZVsgJy5RTmFtZScgXSApICkgewogICAgICAgICAgICBpZiggb3BlcmF0aW9uTmFtZSA9PT0gR0VUX1NFU1NJT05fSU5GTy5vcGVyYXRpb25OYW1lICkgewogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgdHJpdmlhbCBjYXNlIG9mIGluaXRpYWwgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyLgogICAgICAgICAgICAgICAgdGhyb3cgZXhwb3J0cy5jcmVhdGVFcnJvciggcmVzcG9uc2UgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaGl0IHRoZSBJbnZhbGlkVXNlckV4Y2VwdGlvbiBkdXJpbmcgYSBub24tbG9naW4gcmVsYXRlZCBTT0EgY2FsbC4KICAgICAgICAgICAgLy8gdGhpcyBpcyBhIHNlc3Npb24gdGltZS1vdXQgc2l0dWF0aW9uLgogICAgICAgICAgICBldmVudEJ1cy5wdWJsaXNoKCAnc2Vzc2lvbi5zdGFsZScsIHt9ICk7CgogICAgICAgICAgICBjb25zb2xlLmxvZyggJ0VuY291bnRlcmVkIFNlc3Npb24gdGltZW91dC4gU09BIFJlcXVlc3QgZm9yIHNlcnZpY2U6ICcgKyBzZXJ2aWNlTmFtZSArICcsICcgKyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICAgIG9wZXJhdGlvbk5hbWUgKyAnICBXaWxsIHJlZnJlc2ggdGhlIHBhZ2UgaW4gb3JkZXIgdG8gcmUtQXV0aGVudGljYXRlLicgKTsKICAgICAgICAgICAgLy8gYXNzdW1wdGlvbiBpcyB0aGF0IHdlJ3ZlIHRpbWVkIG91dCwgc28gbmVlZCB0byAicmVBdXRoZW50aWNhdGUiLgogICAgICAgICAgICAvLyBMZWdhY3kgR1dUIGxvZ2ljIHdvdWxkIGNhbGwgdGhlIHNlc3Npb24gbWFuYWdlciB0byByZWF1dGhlbnRpY2F0ZSgpLCBidXQgdGhhdAogICAgICAgICAgICAvLyBwYXR0ZXJuIGlzIG5vIGxvbmdlciB1c2VkLiAgSW4gZ2VuZXJhbCB3ZSBqdXN0IHdpbGwgcmVsb2FkIHRoZSBwYWdlIGFuZAogICAgICAgICAgICAvLyB0aGF0IHdpbGwgdXBkYXRlIHRoZSBhdXRoZW50aWNhdGlvbiBzdGF0ZSBhbmQgdHJpZ2dlciByZWF1dGhlbnRpY2F0aW9uLgogICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoIGZhbHNlICk7IC8vIHRyaWdnZXIgYSBwYWdlIHJlZnJlc2gsIHRoYXQgd2lsbCByZWxvYWQgYW5kIGF1dGhlbnRpY2F0ZSBhZ2Fpbi4KICAgICAgICB9CiAgICAgICAgLy8gRklYTUUgdGhpcyBzaG91bGQgYmUgY29uZGl0aW9uZWQgd2l0aCBhIFFOYW1lIGNoZWNrLi4uCiAgICAgICAgaWYoIC9FeGNlcHRpb24kLy50ZXN0KCByZXNwb25zZVsgJy5RTmFtZScgXSApICkgewogICAgICAgICAgICB0aHJvdyBleHBvcnRzLmNyZWF0ZUVycm9yKCByZXNwb25zZSApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2U7Cn0KCi8qKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge09iamVjdH0gcGFyZW50IC0gcGFyZW50IGVsZW1lbnQKICogQHBhcmFtIHtBcnJheX0gbW9kZWxPYmpzIC0gQXJyYXkgb2Yge01vZGVsT2JqZWN0fSBmb3VuZCBpbiByZXNwb25zZQogKiBAcGFyYW0ge09iamVjdH0gdHlwZU5hbWVzIC0gYXJyYXkgb2YgcmVmZXJlbmNlZCB0eXBlIG5hbWVzCiAqLwpmdW5jdGlvbiBleHRyYWN0TW9kZWxPYmpBbmRUeXBlRnJvbVJlc3BvbnNlKCBwYXJlbnQsIG1vZGVsT2JqcywgdHlwZU5hbWVzICkgewogICAgXy5mb3JFYWNoKCBwYXJlbnQsIGZ1bmN0aW9uKCBjaGlsZCwga2V5ICkgewogICAgICAgIGlmKCBfLmlzUGxhaW5PYmplY3QoIGNoaWxkICkgKSB7CiAgICAgICAgICAgIGlmKCBjaGlsZC5oYXNPd25Qcm9wZXJ0eSggJ3VpZCcgKSAmJiBjaGlsZC5oYXNPd25Qcm9wZXJ0eSggJ3R5cGUnICkgKSB7CiAgICAgICAgICAgICAgICBpZiggY2hpbGQudWlkICYmIGNoaWxkLnVpZCAhPT0gY2RtLk5VTExfVUlEICkgewogICAgICAgICAgICAgICAgICAgIGlmKCBtb2RlbE9ianMgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsT2Jqcy5wdXNoKCBjaGlsZCApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsT2JqID0gY2RtLmdldE9iamVjdCggY2hpbGQudWlkICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBtb2RlbE9iaiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFsga2V5IF0gPSBtb2RlbE9iajsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCB0eXBlTmFtZXMgJiYgY2hpbGQudHlwZSAmJiBjaGlsZC50eXBlICE9PSAndW5rbm93blR5cGUnICkgewogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lc1sgY2hpbGQudHlwZS50b1N0cmluZygpIF0gPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXh0cmFjdE1vZGVsT2JqQW5kVHlwZUZyb21SZXNwb25zZSggY2hpbGQsIG1vZGVsT2JqcywgdHlwZU5hbWVzICk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYoIF8uaXNBcnJheSggY2hpbGQgKSApIHsKICAgICAgICAgICAgZXh0cmFjdE1vZGVsT2JqQW5kVHlwZUZyb21SZXNwb25zZSggY2hpbGQsIG1vZGVsT2JqcywgdHlwZU5hbWVzICk7CiAgICAgICAgfQogICAgfSApOwp9CgovKioKICogQHByaXZhdGUKICogQHBhcmFtIHtPYmplY3R9IHJlc3BvbnNlIC0gUmVzcG9uc2UgZnJvbSBTT0Egc2VydmljZS4KICogQHBhcmFtIHtBcnJheX0gbW9kZWxPYmpzIC0gQXJyYXkgb2Yge01vZGVsT2JqZWN0fSBmcm9tIFNPQSBzZXJ2aWNlLgogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXNwb25zZSBmcm9tIFNPQSBzZXJ2aWNlLgogKi8KZnVuY3Rpb24gcHJvY2Vzc1Jlc3BvbnNlT2JqZWN0cyggcmVzcG9uc2UsIG1vZGVsT2JqcyApIHsKICAgIGNvbnN0IHNlcnZpY2VEYXRhID0gZ2V0U2VydmljZURhdGEoIHJlc3BvbnNlICk7CiAgICBsZXQgdXBkYXRlZE9ianMgPSBbXTsKICAgIGlmKCBtb2RlbE9ianMgJiYgbW9kZWxPYmpzLmxlbmd0aCA+IDAgKSB7CiAgICAgICAgLy8gQWRkIG9iamVjdHMgdG8gQ0RNCiAgICAgICAgY2RtLmNhY2hlT2JqZWN0cyggbW9kZWxPYmpzICk7CiAgICAgICAgdXBkYXRlZE9ianMgPSBtb2RlbE9ianM7CgogICAgICAgIC8vIFRvIHN1cHBvcnQgdGhlIGFudGktcGF0dGVybiBvZiBjb2RlIHB1bGxpbmcgdGhlIG1vZGVsT2JqZWN0IGZyb20gdGhlIHJlc3BvbnNlLCB3ZSBuZWVkIHRvIHVwZGF0ZSB0aGUgcmVzcG9uc2Ugc2VydmljZURhdGEuCiAgICAgICAgZXh0cmFjdE1vZGVsT2JqQW5kVHlwZUZyb21SZXNwb25zZSggcmVzcG9uc2UgKTsKICAgIH0KICAgIGlmKCBzZXJ2aWNlRGF0YSApIHsKICAgICAgICBpZiggc2VydmljZURhdGEuY3JlYXRlZCApIHsKICAgICAgICAgICAgY29uc3QgY3JlYXRlZE9iamVjdHMgPSBbXTsKICAgICAgICAgICAgXy5mb3JFYWNoKCBzZXJ2aWNlRGF0YS5jcmVhdGVkLCBmdW5jdGlvbiggdWlkICkgewogICAgICAgICAgICAgICAgY29uc3QgY3JlYXRlZE9iamVjdCA9IGNkbS5nZXRPYmplY3QoIHVpZCApOwogICAgICAgICAgICAgICAgaWYoIGNyZWF0ZWRPYmplY3QgKSB7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZE9iamVjdHMucHVzaCggY3JlYXRlZE9iamVjdCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIGlmKCBjcmVhdGVkT2JqZWN0cy5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICBldmVudEJ1cy5wdWJsaXNoKCAnY2RtLmNyZWF0ZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZE9iamVjdHM6IGNyZWF0ZWRPYmplY3RzCiAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoIHNlcnZpY2VEYXRhLnVwZGF0ZWQgKSB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRPYmplY3RzID0gW107CiAgICAgICAgICAgIF8uZm9yRWFjaCggc2VydmljZURhdGEudXBkYXRlZCwgZnVuY3Rpb24oIHVpZCApIHsKICAgICAgICAgICAgICAgIGlmKCAhY21tLmlzVHlwZVVpZCggdWlkICkgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZE9iamVjdCA9IGNkbS5nZXRPYmplY3QoIHVpZCApOwogICAgICAgICAgICAgICAgICAgIGlmKCB1cGRhdGVkT2JqZWN0ICkgewogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkT2JqZWN0cy5wdXNoKCB1cGRhdGVkT2JqZWN0ICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIGlmKCB1cGRhdGVkT2JqZWN0cy5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICBldmVudEJ1cy5wdWJsaXNoKCAnY2RtLnVwZGF0ZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZE9iamVjdHM6IHVwZGF0ZWRPYmplY3RzCiAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoIHNlcnZpY2VEYXRhLmRlbGV0ZWQgKSB7CiAgICAgICAgICAgIC8vIFJlbW92ZSBvYmplY3RzIGZyb20gQ0RNCiAgICAgICAgICAgIGNkbS5yZW1vdmVPYmplY3RzKCBzZXJ2aWNlRGF0YS5kZWxldGVkICk7CiAgICAgICAgfQogICAgfQogICAgY29uc3QgY3VycmVudFN0b3JlID0gYXBwQ3R4U3ZjLmdldEN0eCggJ3ZtbycgKSB8fCB7fTsKICAgIGxldCB0aW1lTm93ID0gRGF0ZS5ub3coKTsKICAgIGxldCB2YWx1ZXMgPSB7fTsKICAgIGlmKCB1cGRhdGVkT2Jqcy5sZW5ndGggKSB7CiAgICAgICAgZm9yKCBjb25zdCBtbyBvZiB1cGRhdGVkT2JqcyApIHsKICAgICAgICAgICAgbGV0IHJlZlVpZCA9IGdldFJlZlVpZCggbW8gKTsKICAgICAgICAgICAgbGV0IHVpZFZhbCA9IG1vLnVpZDsKICAgICAgICAgICAgY3VycmVudFN0b3JlWyB1aWRWYWwgXSA9IHsKICAgICAgICAgICAgICAgIHR5cGU6IG1vLnR5cGUsCiAgICAgICAgICAgICAgICB0aW1lOiB0aW1lTm93LAogICAgICAgICAgICAgICAgcmVmOiByZWZVaWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYoIHVpZFZhbCApIHsKICAgICAgICAgICAgICAgIHZhbHVlc1sgdWlkVmFsIF0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN0b3JlVmFsdWVzID0gT2JqZWN0LmVudHJpZXMoIGN1cnJlbnRTdG9yZSApOwogICAgICAgIGlmKCAhXy5pc0VtcHR5KCB2YWx1ZXMgKSApIHsKICAgICAgICAgICAgZm9yKCBjb25zdCBbIHVpZCwgeyB0eXBlLCByZWYgfSBdIG9mIHN0b3JlVmFsdWVzICkgewogICAgICAgICAgICAgICAgaWYoIHZhbHVlc1sgcmVmIF0gKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0b3JlWyB1aWQgXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogdGltZU5vdywKICAgICAgICAgICAgICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFwcEN0eFN2Yy5yZWdpc3RlckN0eCggJ3ZtbycsIGN1cnJlbnRTdG9yZSApOwogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlOwp9Cgpjb25zdCBnZXRSZWZVaWQgPSBtbyA9PiB7CiAgICBpZiggbW8udHlwZSA9PT0gJ0F3cDBYUlRPYmplY3RTZXRSb3cnICYmIG1vLnByb3BzICYmIG1vLnByb3BzLmF3cDBUYXJnZXQgKSB7CiAgICAgICAgcmV0dXJuIG1vLnByb3BzLmF3cDBUYXJnZXQuZGJWYWx1ZXNbIDAgXTsKICAgIH0KICAgIHJldHVybiBudWxsOwp9OwoKLyoqCiAqIFByb2Nlc3Mgc2VydmljZSBkYXRhIGluIEhUVFAgcmVzcG9uc2UuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSAtIEpTT04gcmVzcG9uc2UgZGF0YQogKiBAcGFyYW0ge1N0cmluZ30gb3BlcmF0aW9uTmFtZSAtIG9wZXJhdGlvbiBuYW1lCiAqIEByZXR1cm4ge1Byb21pc2V9IFByb21pc2UgcmVzb2x2ZWQgb25jZSB0eXBlcyBhcmUgbG9hZGVkCiAqLwpmdW5jdGlvbiBwcm9jZXNzUmVzcG9uc2VUeXBlcyggcmVzcG9uc2UsIG9wZXJhdGlvbk5hbWUgKSB7CiAgICBpZiggcmVzcG9uc2UgKSB7CiAgICAgICAgY29uc3QgbW9kZWxPYmpzID0gW107CiAgICAgICAgY29uc3QgdHlwZU5hbWVzT2JqID0ge307CgogICAgICAgIGNvbnN0IHFOYW1lID0gcmVzcG9uc2VbICcuUU5hbWUnIF07CiAgICAgICAgaWYoIHFOYW1lICE9PSAnaHR0cDovL3RlYW1jZW50ZXIuY29tL1NjaGVtYXMvU29hLzIwMTEtMDYvTWV0YU1vZGVsLlR5cGVTY2hlbWEnICkgewogICAgICAgICAgICBleHRyYWN0TW9kZWxPYmpBbmRUeXBlRnJvbVJlc3BvbnNlKCByZXNwb25zZSwgbW9kZWxPYmpzLCB0eXBlTmFtZXNPYmogKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHR5cGVOYW1lcyA9IE9iamVjdC5rZXlzKCB0eXBlTmFtZXNPYmogKTsKCiAgICAgICAgaWYoIG9wZXJhdGlvbk5hbWUgPT09IEdFVF9TRVNTSU9OX0lORk8ub3BlcmF0aW9uTmFtZSAmJiByZXNwb25zZS5leHRyYUluZm9PdXQgKSB7CiAgICAgICAgICAgIGlmKCByZXNwb25zZS5leHRyYUluZm9PdXQuQVdDX1N0YXJ0dXBUeXBlcyApIHsKICAgICAgICAgICAgICAgIF90eXBlQ2FjaGVMTUQgPSByZXNwb25zZS5leHRyYUluZm9PdXQudHlwZUNhY2hlTE1EOwogICAgICAgICAgICAgICAgX2F3U3RhcnR1cFByZWZlcmVuY2VzID0gcmVzcG9uc2UuZXh0cmFJbmZvT3V0LkFXQ19TdGFydHVwVHlwZXMuc3BsaXQoICcsJyApOwoKICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBpbmNsdWRlIFRDX1Byb2plY3QgZXZlbiBpZiBub3QgaW4gdGhlIHN0YXJ0IHVwIHByZWZlcmVuY2UKICAgICAgICAgICAgICAgIGlmKCAhXy5pbmNsdWRlcyggX2F3U3RhcnR1cFByZWZlcmVuY2VzLCAnVENfUHJvamVjdCcgKSApIHsKICAgICAgICAgICAgICAgICAgICBfYXdTdGFydHVwUHJlZmVyZW5jZXMucHVzaCggJ1RDX1Byb2plY3QnICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWx3YXlzIGluY2x1ZGUgTGlzdE9mVmFsdWVzU3RyaW5nIGV2ZW4gaWYgbm90IGluIHRoZSBzdGFydCB1cCBwcmVmZXJlbmNlCiAgICAgICAgICAgICAgICBpZiggIV8uaW5jbHVkZXMoIF9hd1N0YXJ0dXBQcmVmZXJlbmNlcywgJ0xpc3RPZlZhbHVlc1N0cmluZycgKSApIHsKICAgICAgICAgICAgICAgICAgICBfYXdTdGFydHVwUHJlZmVyZW5jZXMucHVzaCggJ0xpc3RPZlZhbHVlc1N0cmluZycgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBsb2FkZWRUeXBlcyA9IHR5cGVDYWNoZVN2Yy5nZXRMb2NhbFR5cGVzKCBfdHlwZUNhY2hlTE1EICk7CiAgICAgICAgICAgIGNtbS5jYWNoZVR5cGVzKCBsb2FkZWRUeXBlcyApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGV4cG9ydHMuZW5zdXJlTW9kZWxUeXBlc0xvYWRlZCggdHlwZU5hbWVzICkudGhlbiggZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vIEp1c3QgaW4gY2FzZSB3ZSBoYXZlIG1vcmUgdHlwZXMsIGxldCdzIGdvIGdldCB0aGVtLi4uCiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzUmVzcG9uc2VPYmplY3RzKCByZXNwb25zZSwgbW9kZWxPYmpzICk7CiAgICAgICAgfSApOwogICAgfQoKICAgIHJldHVybiBBd1Byb21pc2VTZXJ2aWNlLmluc3RhbmNlLnJlc29sdmUoKTsKfQoKLyoqCiAqCiAqIEdldHMgdGhlIGVmZmVjdGl2ZSBwcm9wZXJ0eSBwb2xpY3kKICoKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlIC0gU09BIHByb3BlcnR5IHBvbGljeSBvdmVycmlkZSAob3IgTlVMTCkKICogQHBhcmFtIHtib29sZWFufSBpc1NlbGVjdGVkUHJvcGVydHlQb2xpY3kgLSBib29sZWFuIHdoaWNoIGluZGljYXRlcyB3aGV0aGVyIHRoZSBzZWxlY3RlZCBwcm9wZXJ0eSBpcyByZXF1aXJlZAogKiAgICAgICAgICAgIG9yIG5vdC4KICogQHJldHVybnMge09iamVjdH0gcmVxdWVzdCBib2R5IHdpdGggZGVmYXVsdGluZyAmIHZhbGlkYXRpb24gY29tcGxldGUKICogQHByaXZhdGUKICovCmZ1bmN0aW9uIGdldEVmZmVjdGl2ZVByb3BlcnR5UG9saWN5KCBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlLCBpc1NlbGVjdGVkUHJvcGVydHlQb2xpY3kgKSB7CiAgICBpZiggXy5pc1N0cmluZyggcHJvcGVydHlQb2xpY3lPdmVycmlkZSApICkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKCBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlICk7CiAgICB9CiAgICBpZiggXy5pc09iamVjdCggcHJvcGVydHlQb2xpY3lPdmVycmlkZSApICkgewogICAgICAgIC8vIE5vIG5lZWQgdG8gcGFzcyBhIHByb3BlcnR5IHBvbGljeSBmb3IgdGhpcyBjYWxsLgogICAgICAgIHJldHVybiBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlOwogICAgfQogICAgcmV0dXJuIHByb3BQb2xpY3lTdmMuZ2V0RWZmZWN0aXZlUG9saWN5KCBleHBvcnRzLCBpc1NlbGVjdGVkUHJvcGVydHlQb2xpY3kgKTsKfQoKLyoqCiAqIEBwYXJhbSB7U3RyaW5nfSBjbGllbnRJZCAtIGNsaWVudCBJRCB1c2VkIGluIFNPQSBoZWFkZXIKICovCmV4cG9ydCBjb25zdCBzZXRDbGllbnRJZEhlYWRlciA9IGZ1bmN0aW9uKCBjbGllbnRJZCApIHsKICAgIF9jbGllbnRJZCA9IGNsaWVudElkOwp9OwoKLyoqCiAqIEByZXR1cm4ge1N0cmluZ30gY2xpZW50IElEIHVzZWQgaW4gU09BIGhlYWRlcgogKi8KZXhwb3J0IGNvbnN0IGdldENsaWVudElkSGVhZGVyID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gX2NsaWVudElkOwp9OwoKLyoqCiAqIEBwYXJhbSB7TnVtYmVyfSBwb2xsaW5nVGltZW91dCAtIHRpbWVvdXQgdG8gYWxsb3cgcG9sbGluZyBTT0EgY2FsbHMgdG8gYmUgbWFkZSBhZnRlciBsYXN0IG5vbi1wb2xsaW5nIGNhbGwgKG1pbnV0ZXMpCiAqLwpleHBvcnQgY29uc3Qgc2V0UG9sbGluZ1RpbWVvdXQgPSBmdW5jdGlvbiggcG9sbGluZ1RpbWVvdXQgKSB7CiAgICBpZiggcG9sbGluZ1RpbWVvdXQgKSB7CiAgICAgICAgX3BvbGxpbmdUaW1lb3V0ID0gcG9sbGluZ1RpbWVvdXQgKiA2MDsKICAgIH0KfTsKCi8qKgogKiBUZWFtY2VudGVyIFNPQSByZXF1ZXN0LgogKgogKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgLSBTT0Egc2VydmljZSBuYW1lCiAqIEBwYXJhbSB7U3RyaW5nfSBvcGVyYXRpb25OYW1lIC0gU09BIG9wZXJhdGlvbiBuYW1lCiAqIEBwYXJhbSB7U3RyaW5nfSBib2R5IC0gSlNPTiBib2R5CiAqCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gcHJvcGVydHlQb2xpY3lPdmVycmlkZSAtIFNPQSBwcm9wZXJ0eSBwb2xpY3kgb3ZlcnJpZGUgKG9yIE5VTEwpCiAqIEBwYXJhbSB7Qm9vbH0gaWdub3JlSG9zdCAtIEZsYWcgdG8gc2F5IGlnbm9yZSBob3N0aW5nIHdoZW4gbWFraW5nIHNvYSBjYWxsLgogKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9IGhlYWRlclN0YXRlT3ZlcnJpZGUgLSBTT0EgaGVhZGVyIHN0YXRlIG92ZXJyaWRlIChvciBOVUxMKQogKiBAcGFyYW0ge0Jvb2xlYW59IGNoZWNrUGFydGlhbEVycm9ycyAtIGNoZWNrIGZvciBwYXJ0aWFsIGVycm9ycyBpbiB0aGUgcmVzcG9uc2UKICogQHBhcmFtIHtCb29sZWFufSBwb2xsaW5nIC0gdHJ1ZSBpZiB0aGlzIGlzIGEgcG9sbGluZyBjYWxsCiAqCiAqIEByZXR1cm5zIHtQcm9taXNlfSBUaGlzIHByb21pc2Ugd2lsbCBiZSAncmVzb2x2ZWQnIG9yICdyZWplY3RlZCcgd2hlbiB0aGUgc2VydmljZSBpcyBpbnZva2VkIGFuZCBpdHMgcmVzcG9uc2UKICogICAgICAgICAgZGF0YSBpcyBhdmFpbGFibGUuCiAqLwpleHBvcnQgY29uc3QgcmVxdWVzdCA9IGZ1bmN0aW9uKCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwgYm9keSwgewogICAgcHJvcGVydHlQb2xpY3lPdmVycmlkZSwKICAgIGlnbm9yZUhvc3QgPSBmYWxzZSwKICAgIGhlYWRlclN0YXRlT3ZlcnJpZGUgPSBmYWxzZSwKICAgIGNoZWNrUGFydGlhbEVycm9ycyA9IGZhbHNlLAogICAgcG9sbGluZyA9IGZhbHNlCn0gPSB7fSApIHsKICAgIGFzc2VydCggc2VydmljZU5hbWUsICdTZXJ2aWNlIG5hbWUgbm90IHByb3ZpZGVkIScgKTsKICAgIGFzc2VydCggb3BlcmF0aW9uTmFtZSwgJ09wZXJhdGlvbiBuYW1lIG5vdCBwcm92aWRlZCEnICk7CgogICAgLy8gU3VwcG9ydCBwb2xsaW5nIFNPQSBjYWxscyB0byBoYXZlIGEgdGltZW91dC4gVGhpcyBzdG9wcyBhbiBpZGxlIGNsaWVudAogICAgLy8gYnJvd3NlciBmcm9tIG1ha2luZyBwb2xsaW5nIGNhbGxzLlRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSB0aGUgVEMgd2ViCiAgICAvLyB0aWVyIG5lZWRzIHRvIGJlIGFibGUgdG8gYWxsb3cgaXQncyBzZXNzaW9uIHRvIHRpbWVvdXQuCiAgICBpZiggX3BvbGxpbmdUaW1lb3V0ID4gMCApIHsKICAgICAgICBpZiggcG9sbGluZyApIHsKICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHdoZW4gbGFzdCBjYWxsIHdhcyBtYWRlLgogICAgICAgICAgICBjb25zdCB0aW1lT2ZMYXN0Q2FsbCA9IF8udG9OdW1iZXIoIGxvY2FsU3RyZy5nZXQoICdzb2FTZXJ2aWNlLnRpbWVPZkxhc3RDYWxsJyApICk7CiAgICAgICAgICAgIGlmKCB0aW1lT2ZMYXN0Q2FsbCApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNlY3NTaW5jZUxhc3RDYWxsID0gKCBEYXRlLm5vdygpIC0gdGltZU9mTGFzdENhbGwgKSAvIDEwMDA7CiAgICAgICAgICAgICAgICAvLyBJZiBsb25nZXIgdGhhbiBwb2xsaW5nIHRpbWVvdXQsIGF2b2lkIGNhbGwuCiAgICAgICAgICAgICAgICBpZiggc2Vjc1NpbmNlTGFzdENhbGwgPiBfcG9sbGluZ1RpbWVvdXQgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEF3UHJvbWlzZVNlcnZpY2UuaW5zdGFuY2UucmVqZWN0KCBuZXcgRXJyb3IoICdQb2xsaW5nIGNhbGwgc2tpcHBlZCBkdWUgdG8gY2xpZW50IGluYWN0aXZpdHkuJyApICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2UgaXMgYmVpbmcgdXNlZCBiZWNhdXNlIFNPQSBjYWxscyBmcm9tIG90aGVyCiAgICAgICAgICAgIC8vIGJyb3dzZXJzIHRhYnMgYWxsb3cgdGhpcyB0YWIgdG8gbWFrZSB0aGUgcG9sbGluZyBjYWxsLgogICAgICAgICAgICBsb2NhbFN0cmcucHVibGlzaCggJ3NvYVNlcnZpY2UudGltZU9mTGFzdENhbGwnLCBEYXRlLm5vdygpICk7CiAgICAgICAgfQogICAgfQoKICAgIGxldCBpc1NlbGVjdGVkUHJvcGVydHlQb2xpY3kgPSBmYWxzZTsKCiAgICBsZXQgZW5kUHQ7CgogICAgbGV0IHByb21pc2U7CiAgICBpZiggR0VUX1NFU1NJT05fSU5GTy5zZXJ2aWNlTmFtZSA9PT0gc2VydmljZU5hbWUgJiYgR0VUX1NFU1NJT05fSU5GTy5vcGVyYXRpb25OYW1lID09PSBvcGVyYXRpb25OYW1lICkgewogICAgICAgIC8vIGF2b2lkIGxvYWRpbmcgc2NoZW1hIGZvciBnZXQgc2Vzc2lvbiBpbmZvIGNhbGwKICAgICAgICBjb25zdCBzY2hlbWFTZXJ2aWNlID0ge307CiAgICAgICAgc2NoZW1hU2VydmljZVsgR0VUX1NFU1NJT05fSU5GTy5vcGVyYXRpb25OYW1lIF0gPSB7fTsgLy8gZXh0cmFJbmZvSW46ICJTdHJpbmdbXSIKICAgICAgICBwcm9taXNlID0gQXdQcm9taXNlU2VydmljZS5pbnN0YW5jZS5yZXNvbHZlKCBzY2hlbWFTZXJ2aWNlICk7CiAgICB9IGVsc2UgewogICAgICAgIHByb21pc2UgPSBjb25maWdTdmMuZ2V0Q2ZnKCAnc2NoZW1hLicgKyBzZXJ2aWNlTmFtZSApLnRoZW4oIGZ1bmN0aW9uKCBzY2hlbWFTZXJ2aWNlICkgewogICAgICAgICAgICByZXR1cm4gc2NoZW1hU2VydmljZTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gbm9uZSBmb3VuZAogICAgICAgICAgICBsb2dnZXIud2FybiggJ05vIFNPQSBzY2hlbWEgZGVmaW5pdGlvbiBmb3VuZCEnICk7CiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICB9ICk7CiAgICB9CgogICAgcmV0dXJuIHByb21pc2UudGhlbiggZnVuY3Rpb24oIHNjaGVtYVNlcnZpY2UgKSB7CiAgICAgICAgaWYoIGFwcEN0eFN2Yy5jdHguYXdfaG9zdGluZ19lbmFibGVkICYmICFhcHBDdHhTdmMuY3R4LmF3X2hvc3Rpbmdfc29hX3N1cHBvcnRfY2hlY2tlZCApIHsKICAgICAgICAgICAgYXBwQ3R4U3ZjLmN0eC5hd19ob3N0aW5nX3NvYV9zdXBwb3J0X2NoZWNrZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYoIGJvZHkgKSB7CiAgICAgICAgICAgIGlzU2VsZWN0ZWRQcm9wZXJ0eVBvbGljeSA9IHByb3BQb2xpY3lTdmMuY2hlY2tGb3JTZWxlY3RlZE9iamVjdCggYm9keSApOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganNvbkRhdGEgPSB7CiAgICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICAgICAgc3RhdGU6IHsKICAgICAgICAgICAgICAgICAgICBjbGllbnRWZXJzaW9uOiAnMTAwMDAuMS4yJywKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBDb3JyZWxhdGlvbiBJRCBmb3IgbG9nZ2luZyBwdXJwb3NlcyAoZGVidWcpLgogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIGxvZ0NvcnJlbGF0aW9uSUQ6IGxvZ2dlci5nZXRDb3JyZWxhdGlvbklEKCksCiAgICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAgICogUGVybWFuZW50IElEL3JlY2lwZXMgYXJlIHVzZWQgZm9yIHRoZSBydW50aW1lIGJ1c2luZXNzIG9iamVjdOKAmXMgKEJPTUxpbmUgb2JqZWN0cykgb3BhcXVlIFVJRHMKICAgICAgICAgICAgICAgICAgICAgKiBpbiByZXF1ZXN0cy9yZXNwb25zZXMuCiAgICAgICAgICAgICAgICAgICAgICogPHA+CiAgICAgICAgICAgICAgICAgICAgICogSWYgdGhlIHVubG9hZE9iamVjdHMga2V5IGlzIG5vdCBpbiB0aGUgcmVxdWVzdCBoZWFkZXJzLCBhbGwgYnVzaW5lc3Mgb2JqZWN0cyBhcmUgdW5sb2FkZWQgYXQKICAgICAgICAgICAgICAgICAgICAgKiB0aGUgdG9wIG9mIGVhY2ggcmVxdWVzdDsgc2VlIHRoZSBwcm9jZXNzVGFnTWFuYWdlciBJVEsgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgc3RhdGVsZXNzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqIElmIHRydWUsIEFsbCBidXNpbmVzcyBvYmplY3RzIGFyZSB1bmxvYWRlZCBhdCB0aGUgdG9wIG9mIGVhY2ggcmVxdWVzdDsgc2VlIHRoZQogICAgICAgICAgICAgICAgICAgICAqIHByb2Nlc3NUYWdNYW5hZ2VyIElUSyBmb3IgbW9yZSBpbmZvcm1hdGlvbi4gUHJldmlvdXNseSBjb250cm9sbGVkIHRocm91Z2ggdGhlIHN0YXRlbGVzcyBmbGFnLgogICAgICAgICAgICAgICAgICAgICAqIDxwPgogICAgICAgICAgICAgICAgICAgICAqIFdoZW4gaXMgc3RhdGVsZXNzPXRydWUgbW9kZSB0aGlzIHZhbHVlIG11c3QgYmUgZXhwbGljaXRseSBzZXQgdG8gZmFsc2UgdG8ga2VlcCBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgICogbG9hZGVkLgogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIHVubG9hZE9iamVjdHM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAgICogSWYgdHJ1ZSwgcHJvY2VzcyBzZXJ2ZXItc2Vzc2lvbiBzdGF0ZSBrZXkvdmFsdWUgcGFpcnMgZm91bmQgaW4gdGhlIHJlcXVlc3QgaGVhZGVycy4gVGhpcwogICAgICAgICAgICAgICAgICAgICAqIHR1cm5zIGFsbCBzZXNzaW9uIHN0YXRlIGludG8gY2xpZW50LXNlc3Npb24gZGF0YS4gVGhlIHN0YW5kYWxvbmUgQVcgY2xpZW50IHNob3VsZCBzZXQgdGhpcyB0bwogICAgICAgICAgICAgICAgICAgICAqIHRydWUsIHdoaWxlIHRoZSBob3N0ZWQgQVcgY2xpZW50IHNob3VsZCBzZXQgaXQgZmFsc2UgKG9yIG5vdCBzZW5kIGl0IGF0IGFsbCkuCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2VydmVyU3RhdGVIZWFkZXJzOiAhX3JlZGlyZWN0U29hU3ZjLAogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIGZvcm1hdFByb3BlcnRpZXM6IHRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwb2xpY3k6IGdldEVmZmVjdGl2ZVByb3BlcnR5UG9saWN5KCBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlLCBpc1NlbGVjdGVkUHJvcGVydHlQb2xpY3kgKQogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBkZWZhdWx0QW5kVmFsaWRhdGVFbGVtZW50KCBzY2hlbWFTZXJ2aWNlLCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwgYm9keSApCiAgICAgICAgfTsKCiAgICAgICAgbWVyZ2VIZWFkZXJTdGF0ZSgganNvbkRhdGEuaGVhZGVyLnN0YXRlLCBoZWFkZXJTdGF0ZU92ZXJyaWRlICk7CgogICAgICAgIGlmKCBhcHBDdHhTdmMgJiYgYXBwQ3R4U3ZjLmdldEN0eCggJ29iamVjdFF1b3RhQ29udGV4dC51c2VPYmplY3RRdW90YScgKSApIHsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIElmIHRydWUsIEFsbCBidXNpbmVzcyBvYmplY3RzIGFyZSB1bmxvYWRlZCBhdCB0aGUgdG9wIG9mIGVhY2ggcmVxdWVzdC4gQXBwbGljYXRpb25zIG1pZ2h0IHdhbnQgdG8KICAgICAgICAgICAgICogcmVseSBvbiBvYmplY3QgcXVvdGEgYmFzZWQgdW5sb2FkLiBJbiBzdWNoIGNhc2VzIHRoZXkgY2FuIHVzZSAib2JqZWN0UXVvdGFDb250ZXh0IiB0byBvdmVycmlkZSB0aGlzCiAgICAgICAgICAgICAqIGJlaGF2aW9yIGFuZCByZXNldCB0aGlzIGZsYWcgdG8gYXZhaWwgdGhpcyBmZWF0dXJlCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBqc29uRGF0YS5oZWFkZXIuc3RhdGUudW5sb2FkT2JqZWN0cyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYoICFfcmVkaXJlY3RTb2FTdmMgJiYgX2NsaWVudElkICE9PSAnJyApIHsKICAgICAgICAgICAganNvbkRhdGEuaGVhZGVyLnN0YXRlLmNsaWVudElEID0gX2NsaWVudElkOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaGVhZGVycyA9IHsKICAgICAgICAgICAgLy8gT25seSBVUy1BU0NJSSBjaGFyYWN0ZXJzIGFyZSBhbGxvd2VkIGluIEhUVFAgaGVhZGVycwogICAgICAgICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzM0NjcwNDEzL3JlZ2V4cC10by12YWxpZGF0ZS1hLWh0dHAtaGVhZGVyLXZhbHVlLzM0NzEwODgyIzM0NzEwODgyCiAgICAgICAgICAgICdMb2ctQ29ycmVsYXRpb24tSUQnOiBqc29uRGF0YS5oZWFkZXIuc3RhdGUubG9nQ29ycmVsYXRpb25JRC5yZXBsYWNlKCAvW15ceDIwLVx4N0VdKy9nLCAnJyApCiAgICAgICAgfTsKCiAgICAgICAgaWYoIEdFVF9TRVNTSU9OX0lORk8uc2VydmljZU5hbWUgPT09IHNlcnZpY2VOYW1lICYmIEdFVF9TRVNTSU9OX0lORk8ub3BlcmF0aW9uTmFtZSA9PT0gb3BlcmF0aW9uTmFtZSApIHsKICAgICAgICAgICAgaGVhZGVycy5jbGllbnRJUCA9ICdicm93c2VyLWNsaWVudCc7CiAgICAgICAgfQoKICAgICAgICBsZXQgYXdTZXNzaW9uID0gbG9jYWxTdHJnLmdldCggJ2F3U2Vzc2lvbicgKTsKICAgICAgICBpZiggYXdTZXNzaW9uICkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdTZXNzaW9uID0gSlNPTi5wYXJzZSggYXdTZXNzaW9uICk7CiAgICAgICAgICAgICAgICBpZiggIWFwcEN0eFN2Yy5jdHguYXdfaG9zdGluZ19lbmFibGVkICkgewogICAgICAgICAgICAgICAgICAgIGlmKCBhd1Nlc3Npb24uZ3JvdXBNZW1iZXJVSUQgKSB7IGpzb25EYXRhLmhlYWRlci5zdGF0ZS5ncm91cE1lbWJlciA9IGF3U2Vzc2lvbi5ncm91cE1lbWJlclVJRDsgfQogICAgICAgICAgICAgICAgICAgIGlmKCBhd1Nlc3Npb24ucm9sZU5hbWUgKSB7IGpzb25EYXRhLmhlYWRlci5zdGF0ZS5yb2xlID0gYXdTZXNzaW9uLnJvbGVOYW1lOyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggYXdTZXNzaW9uLmxvY2FsZSApIHsganNvbkRhdGEuaGVhZGVyLnN0YXRlLmxvY2FsZSA9IGF3U2Vzc2lvbi5sb2NhbGU7IH0KICAgICAgICAgICAgfSBjYXRjaCAoIGVyciApIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyggZXJyICk7CiAgICAgICAgICAgICAgICBsb2NhbFN0cmcucmVtb3ZlSXRlbSggJ2F3U2Vzc2lvbicgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZW5kUHQgPSBzZXJ2aWNlTmFtZSArICcvJyArIG9wZXJhdGlvbk5hbWU7CgogICAgICAgIGlmKCBsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSApIHsKICAgICAgICAgICAgbG9nZ2VyLnRyYWNlKCAnXG4nICsgJ3NvYVNlcnZpY2UucG9zdCB0byAnICsgZW5kUHQsIGpzb25EYXRhICk7CiAgICAgICAgfQoKICAgICAgICBwZW5kaW5nUmVxdWVzdHMrKzsKICAgICAgICBldmVudEJ1cy5wdWJsaXNoKCAncHJvZ3Jlc3Muc3RhcnQnLCB7CiAgICAgICAgICAgIGVuZFBvaW50OiBlbmRQdAogICAgICAgIH0gKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgaXMgYSAnaG9zdCcgcHJvY2VzcyB0aGF0IGlzIGhhbmRsaW5nIFNPQSBwcm9jZXNzaW5nPEJSPgogICAgICAgICAqIElmIHNvOiBTZW5kIHRoZSAnZW5kUHQnIGFuZCBkYXRhIHRvIHRoYXQgc2VydmljZS4KICAgICAgICAgKi8KCiAgICAgICAgLy8gVGhlIG9ubHkgY2FzZSB0aGUgY2xpZW50IHdpbGwgbWFrZSBpdHMgb3duIGxvZ2luIGNhbGwgd2hlbiBob3N0ZWQgd291bGQgYmUgd2hlbiBpdCBuZWVkcyBjcmVkZW50aWFscy4KICAgICAgICAvLyBJZiBzdWNoIGEgY2FsbCBpcyBtYWRlLCB3ZSBzaG91bGQgbm90IG1ha2UgaXQgdGhyb3VnaCB0aGUgaG9zdC4gVGhpcyBpcyB0aGUgb25seSBjYXNlIHdoZW4gQVcgdGFsa3MgZGlyZWN0bHkgdG8gdGhlIHNlcnZlci4KICAgICAgICAvLyBUaGlzIHdpbGwgYWxsb3cgVmlld2VyIHRvIHNob3cgdXAgaW4gaG9zdHMuCiAgICAgICAgaWYoIF9yZWRpcmVjdFNvYVN2YyAmJiAhaWdub3JlSG9zdCApIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWRpcmVjdFNvYVN2Yy5wb3N0KCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwganNvbkRhdGEgKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0ICRodHRwID0gQXdIdHRwU2VydmljZS5pbnN0YW5jZTsKCiAgICAgICAgdHJhY2UoICdIVFRQIGNhbGwgc3RhcnQnLCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSApOwogICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCBicm93c2VyVXRpbHMuZ2V0QmFzZVVSTCgpICsgJ3RjL0pzb25SZXN0U2VydmljZXMvJyArIGVuZFB0LCBqc29uRGF0YSwgewogICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzCiAgICAgICAgfSApLnRoZW4oIGZ1bmN0aW9uKCByZXNwb25zZSApIHsKICAgICAgICAgICAgdHJhY2UoICdIVFRQIGNhbGwgY29tcGxldGUnLCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSApOwogICAgICAgICAgICBhc3NlcnQoIHJlc3BvbnNlLCAnTm8gcmVzcG9uc2UgZ2l2ZW4gZm9yICcgKyBlbmRQdCApOwoKICAgICAgICAgICAgY29uc3QgYm9keTIgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgYXNzZXJ0KCB0eXBlb2YgYm9keTIgIT09ICdzdHJpbmcnIHx8IGJvZHkyLmluZGV4T2YoICc8P3htbCB2ZXJzaW9uJyApID09PSAtMSwKICAgICAgICAgICAgICAgICdVbmV4cGVjdGVkIHJlc3BvbnNlIGJvZHkgZm9yOiAnICsgZW5kUHQgKTsKCiAgICAgICAgICAgIHJldHVybiBib2R5MjsKICAgICAgICB9ICk7CiAgICB9ICkudGhlbiggZnVuY3Rpb24oIHJlc3BvbnNlICkgewogICAgICAgIHBlbmRpbmdSZXF1ZXN0cy0tOwogICAgICAgIGV2ZW50QnVzLnB1Ymxpc2goICdwcm9ncmVzcy5lbmQnLCB7CiAgICAgICAgICAgIGVuZFBvaW50OiBlbmRQdAogICAgICAgIH0gKTsKICAgICAgICBpZiggbG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkgKSB7CiAgICAgICAgICAgIGxvZ2dlci50cmFjZSggJ2VuZFB0PScgKyBlbmRQdCwgcmVzcG9uc2UgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb2Nlc3NFeGNlcHRpb25zKCByZXNwb25zZSwgc2VydmljZU5hbWUsIG9wZXJhdGlvbk5hbWUgKTsKICAgIH0sIGZ1bmN0aW9uKCBlcnIgKSB7CiAgICAgICAgcGVuZGluZ1JlcXVlc3RzLS07CiAgICAgICAgZXZlbnRCdXMucHVibGlzaCggJ3Byb2dyZXNzLmVuZCcsIHsKICAgICAgICAgICAgZW5kUG9pbnQ6IGVuZFB0CiAgICAgICAgfSApOwogICAgICAgIHRocm93IGV4cG9ydHMuY3JlYXRlRXJyb3IoIGVyciApOwogICAgfSApLnRoZW4oIGZ1bmN0aW9uKCByZXNwb25zZSApIHsKICAgICAgICBpZiggIXByb3BlcnR5UG9saWN5T3ZlcnJpZGUgJiYgIWlzU2VsZWN0ZWRQcm9wZXJ0eVBvbGljeSApIHsKICAgICAgICAgICAgbG9hZFByb3BlcnRpZXNJZlJlcXVpcmVkKCByZXNwb25zZSApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJvY2Vzc1Jlc3BvbnNlVHlwZXMoIHJlc3BvbnNlLCBvcGVyYXRpb25OYW1lICk7CiAgICB9ICkudGhlbiggZnVuY3Rpb24oIHJlc3BvbnNlICkgewogICAgICAgIGlmKCBjaGVja1BhcnRpYWxFcnJvcnMgJiYgcmVzcG9uc2UgKSB7CiAgICAgICAgICAgIGlmKCByZXNwb25zZS5QYXJ0aWFsRXJyb3JzICkgewogICAgICAgICAgICAgICAgdGhyb3cgZXhwb3J0cy5jcmVhdGVFcnJvciggcmVzcG9uc2UuUGFydGlhbEVycm9ycyApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNlcnZpY2VEYXRhID0gZ2V0U2VydmljZURhdGEoIHJlc3BvbnNlICk7CiAgICAgICAgICAgIGlmKCBzZXJ2aWNlRGF0YSAmJiBzZXJ2aWNlRGF0YS5wYXJ0aWFsRXJyb3JzICkgewogICAgICAgICAgICAgICAgdGhyb3cgZXhwb3J0cy5jcmVhdGVFcnJvciggc2VydmljZURhdGEgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9ICk7Cn07CgovKioKICogTWVyZ2UgZGVmYXVsdCBoZWFkZXIgc3RhdGUgd2l0aCB0aGUgZ2l2ZW4gb3ZlcnJpZGVzCiAqCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gZGVmYXVsdEhlYWRlclN0YXRlIC0gU09BIGhlYWRlciBzdGF0ZSBkZWZhdWx0IChvciBOVUxMKQogKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9IGhlYWRlclN0YXRlT3ZlcnJpZGUgLSBTT0EgaGVhZGVyIHN0YXRlIG92ZXJyaWRlIChvciBOVUxMKQogKi8KZnVuY3Rpb24gbWVyZ2VIZWFkZXJTdGF0ZSggZGVmYXVsdEhlYWRlclN0YXRlLCBoZWFkZXJTdGF0ZU92ZXJyaWRlICkgewogICAgY29uc3Qga2V5cyA9IGhlYWRlclN0YXRlT3ZlcnJpZGUgPyBPYmplY3Qua2V5cyggaGVhZGVyU3RhdGVPdmVycmlkZSApIDogW107CiAgICBmb3IoIGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyArK2kgKSB7CiAgICAgICAgZGVmYXVsdEhlYWRlclN0YXRlWyBrZXlzWyBpIF0gXSA9IGhlYWRlclN0YXRlT3ZlcnJpZGVbIGtleXNbIGkgXSBdOwogICAgfQp9CgovKioKICogQ2FsbHMgZ2V0UHJvcGVydGllcyBTb2EgdG8gbG9hZCBhZGRpdGlvbmFsIHByb3BlcnRpZXMgaWYgcmVxdWlyZWQuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSAtIEpTT04gcmVzcG9uc2UgZGF0YQogKi8KZnVuY3Rpb24gbG9hZFByb3BlcnRpZXNJZlJlcXVpcmVkKCByZXNwb25zZSApIHsKICAgIGlmKCByZXNwb25zZSApIHsKICAgICAgICBjb25zdCBzZXJ2aWNlRGF0YSA9IGdldFNlcnZpY2VEYXRhKCByZXNwb25zZSApOwogICAgICAgIGlmKCBzZXJ2aWNlRGF0YSApIHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VPYmplY3RzID0gW107CiAgICAgICAgICAgIGlmKCBzZXJ2aWNlRGF0YS51cGRhdGVkICkgewogICAgICAgICAgICAgICAgZm9yKCBsZXQgaWkyID0gMDsgaWkyIDwgc2VydmljZURhdGEudXBkYXRlZC5sZW5ndGg7IGlpMisrICkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRVaWQgPSBzZXJ2aWNlRGF0YS51cGRhdGVkWyBpaTIgXTsKICAgICAgICAgICAgICAgICAgICBpZiggIWNtbS5pc1R5cGVVaWQoIHVwZGF0ZWRVaWQgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZE9iamVjdCA9IGNkbS5nZXRPYmplY3QoIHVwZGF0ZWRVaWQgKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIHVwZGF0ZWRPYmplY3QgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZU9iamVjdHMucHVzaCggdXBkYXRlZE9iamVjdCApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCBzZXJ2aWNlRGF0YS5jcmVhdGVkICkgewogICAgICAgICAgICAgICAgZm9yKCBsZXQgaWkgPSAwOyBpaSA8IHNlcnZpY2VEYXRhLmNyZWF0ZWQubGVuZ3RoOyBpaSsrICkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNyZWF0ZWRPYmplY3QgPSBjZG0uZ2V0T2JqZWN0KCBzZXJ2aWNlRGF0YS5jcmVhdGVkWyBpaSBdICk7CiAgICAgICAgICAgICAgICAgICAgaWYoIGNyZWF0ZWRPYmplY3QgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlT2JqZWN0cy5wdXNoKCBjcmVhdGVkT2JqZWN0ICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggcmVzcG9uc2VPYmplY3RzLmxlbmd0aCA+IDAgJiYKICAgICAgICAgICAgICAgIHByb3BQb2xpY3lTdmMuY2hlY2tGb3JTZWxlY3RlZE9iamVjdCggbnVsbCwgcmVzcG9uc2VPYmplY3RzICkgKSB7CiAgICAgICAgICAgICAgICBleHBvcnRzLnJlcXVlc3QoICdDb3JlLTIwMDYtMDMtRGF0YU1hbmFnZW1lbnQnLCAnZ2V0UHJvcGVydGllcycsIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3RzOiByZXNwb25zZU9iamVjdHMsCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogW10KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlOiBwcm9wUG9saWN5U3ZjLmdldEVmZmVjdGl2ZVBvbGljeSggbnVsbCwgdHJ1ZSApCiAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBTT0EgcG9zdCB1bmNoZWNrZWQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSAtIFNPQSBzZXJ2aWNlIG5hbWUKICogQHBhcmFtIHtTdHJpbmd9IG9wZXJhdGlvbk5hbWUgLSBTT0Egb3BlcmF0aW9uIG5hbWUKICogQHBhcmFtIHtTdHJpbmd9IGJvZHkgLSBKU09OIGJvZHkKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBwcm9wZXJ0eVBvbGljeU92ZXJyaWRlIC0gU09BIHByb3BlcnR5IHBvbGljeSBvdmVycmlkZSAob3IgTlVMTCkKICogQHBhcmFtIHtCb29sfSBpZ25vcmVIb3N0IC0gRmxhZyB0byBzYXkgaWdub3JlIGhvc3Rpbmcgd2hlbiBtYWtpbmcgc29hIGNhbGwuCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gaGVhZGVyU3RhdGVPdmVycmlkZSAtIFNPQSBoZWFkZXIgc3RhdGUgb3ZlcnJpZGUgKG9yIE5VTEwpCiAqIEByZXR1cm5zIHtQcm9taXNlfSBUaGlzIHByb21pc2Ugd2lsbCBiZSAncmVzb2x2ZWQnIG9yICdyZWplY3RlZCcgd2hlbiB0aGUgc2VydmljZSBpcyBpbnZva2VkIGFuZCBpdHMgcmVzcG9uc2UKICogICAgICAgICAgZGF0YSBpcyBhdmFpbGFibGUuCiAqLwpleHBvcnQgY29uc3QgcG9zdFVuY2hlY2tlZCA9IGZ1bmN0aW9uKCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwgYm9keSwgcHJvcGVydHlQb2xpY3lPdmVycmlkZSwgaWdub3JlSG9zdCwgaGVhZGVyU3RhdGVPdmVycmlkZSApIHsKICAgIHJldHVybiBleHBvcnRzLnJlcXVlc3QoIHNlcnZpY2VOYW1lLCBvcGVyYXRpb25OYW1lLCBib2R5LCB7CiAgICAgICAgcHJvcGVydHlQb2xpY3lPdmVycmlkZSwKICAgICAgICBpZ25vcmVIb3N0LAogICAgICAgIGhlYWRlclN0YXRlT3ZlcnJpZGUKICAgIH0gKTsKfTsKCi8qKgogKiBTT0EgcG9zdC4KICoKICogSWYgdGhlIHJlc3BvbnNlIGNvbnRhaW5zIHBhcnRpYWwgZXJyb3JzLCBpdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYW4gZXhjZXB0aW9uICYgdGhyb3duLiBJZiB0aGlzIGlzbid0IGRlc2lyZWQsCiAqIHVzZSBwb3N0VW5jaGVja2VkLgogKgogKiBAcGFyYW0ge1N0cmluZ30gc2VydmljZU5hbWUgLSBTT0Egc2VydmljZSBuYW1lCiAqIEBwYXJhbSB7U3RyaW5nfSBvcGVyYXRpb25OYW1lIC0gU09BIG9wZXJhdGlvbiBuYW1lCiAqIEBwYXJhbSB7U3RyaW5nfSBib2R5IC0gSlNPTiBib2R5CiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gcHJvcGVydHlQb2xpY3lPdmVycmlkZSAtIFNPQSBwcm9wZXJ0eSBwb2xpY3kgb3ZlcnJpZGUgKG9yIE5VTEwpCiAqIEBwYXJhbSB7Qm9vbGVhbn0gaWdub3JlSG9zdCAtIGlnbm9yZSBTT0EgdHVubmVsIGJ5IGhvc3Q/CiAqIEByZXR1cm5zIHtQcm9taXNlfSBUaGlzIHByb21pc2Ugd2lsbCBiZSAncmVzb2x2ZWQnIG9yICdyZWplY3RlZCcgd2hlbiB0aGUgc2VydmljZSBpcyBpbnZva2VkIGFuZCBpdHMgcmVzcG9uc2UKICogICAgICAgICAgZGF0YSBpcyBhdmFpbGFibGUuCiAqLwpleHBvcnQgY29uc3QgcG9zdCA9IGZ1bmN0aW9uKCBzZXJ2aWNlTmFtZSwgb3BlcmF0aW9uTmFtZSwgYm9keSwgcHJvcGVydHlQb2xpY3lPdmVycmlkZSwgaWdub3JlSG9zdCApIHsKICAgIHJldHVybiBleHBvcnRzLnJlcXVlc3QoIHNlcnZpY2VOYW1lLCBvcGVyYXRpb25OYW1lLCBib2R5LCB7CiAgICAgICAgcHJvcGVydHlQb2xpY3lPdmVycmlkZSwKICAgICAgICBpZ25vcmVIb3N0LAogICAgICAgIGNoZWNrUGFydGlhbEVycm9yczogdHJ1ZQogICAgfSApOwp9OwoKCi8qKgogKiBTZXQgc2Vzc2lvbiBpbmZvcm1hdGlvbiBpbnRvIGxvY2FsIHN0b3JhZ2UgKGlmIG5lZWRlZCkKICoKICogQHBhcmFtIHtCb29sZWFufSBzaWduT3V0IC0gc2lnbiBvdXQKICovCmV4cG9ydCBjb25zdCBzZXRTZXNzaW9uSW5mbyA9IGZ1bmN0aW9uKCBzaWduT3V0ICkgewogICAgaWYoICFzaWduT3V0ICkgewogICAgICAgIGNvbnN0IHVzZXJTZXNzaW9uID0gY2RtLmdldFVzZXJTZXNzaW9uKCk7CiAgICAgICAgaWYoIHVzZXJTZXNzaW9uICkgewogICAgICAgICAgICAvLyBTdG9yZSBhbGwgdGhlIHJlcXVpcmVkIGZpZWxkcyB0byBzdXBwb3J0IHRoZSBTT0EgaGVhZGVyCiAgICAgICAgICAgIGNvbnN0IGF3U2Vzc2lvbiA9IHsKICAgICAgICAgICAgICAgIGdyb3VwTWVtYmVyVUlEOiBfLmdldCggdXNlclNlc3Npb24sICdwcm9wcy5mbmQwZ3JvdXBtZW1iZXIuZGJWYWx1ZXMuMCcgKSwKICAgICAgICAgICAgICAgIGxvY2FsZTogXy5nZXQoIHVzZXJTZXNzaW9uLCAncHJvcHMuZm5kMGxvY2FsZS5kYlZhbHVlcy4wJyApLAogICAgICAgICAgICAgICAgcm9sZU5hbWU6IF8uZ2V0KCB1c2VyU2Vzc2lvbiwgJ3Byb3BzLnJvbGVfbmFtZS5kYlZhbHVlcy4wJyApCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxvY2FsU3RyZy5wdWJsaXNoKCAnYXdTZXNzaW9uJywgSlNPTi5zdHJpbmdpZnkoIGF3U2Vzc2lvbiApICk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBsb2NhbFN0cmcucmVtb3ZlSXRlbSggJ2F3U2Vzc2lvbicgKTsKICAgIH0KfTsKCi8qKgogKiBQZXJmb3JtIGFuIGFzeW5jIGdldCBvZiBjdXJyZW50IFRlYW1jZW50ZXIgc2Vzc2lvbiBpbmZvcm1hdGlvbi4KICoKICogQHBhcmFtIHtCb29sZWFufSBpZ25vcmVIb3N0IC0gaWdub3JlIFNPQSB0dW5uZWwgYnkgaG9zdD8KICogQHJldHVybnMge1Byb21pc2V9IFRoaXMgcHJvbWlzZSB3aWxsIGJlICdyZXNvbHZlZCcgb3IgJ3JlamVjdGVkJyB3aGVuIHRoZSBzZXJ2aWNlIGlzIGludm9rZWQgYW5kIGl0cyByZXNwb25zZQogKiAgICAgICAgICBkYXRhIGlzIGF2YWlsYWJsZS4KICovCmV4cG9ydCBjb25zdCBnZXRUQ1Nlc3Npb25JbmZvID0gZnVuY3Rpb24oIGlnbm9yZUhvc3QgKSB7CiAgICAvLyBFbnN1cmUgd2UgaGF2ZSB0aGUgcmVxdWlyZWQgcHJvcGVydGllcyBmb3IgdGhlIFVzZXJTZXNzaW9uLgogICAgY29uc3QgcG9saWN5SWQgPSBwcm9wUG9saWN5U3ZjLnJlZ2lzdGVyKCB7CiAgICAgICAgdHlwZXM6IFsgewogICAgICAgICAgICBuYW1lOiAnVXNlclNlc3Npb24nLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdhd3AwUmV2UnVsZScsCiAgICAgICAgICAgICAgICBtb2RpZmllcnM6IFsgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdpbmNsdWRlSXNNb2RpZmlhYmxlJywKICAgICAgICAgICAgICAgICAgICBWYWx1ZTogJ3RydWUnCiAgICAgICAgICAgICAgICB9IF0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogJ3VzZXInLAogICAgICAgICAgICAgICAgbW9kaWZpZXJzOiBbIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnd2l0aFByb3BlcnRpZXMnLAogICAgICAgICAgICAgICAgICAgIFZhbHVlOiAndHJ1ZScKICAgICAgICAgICAgICAgIH0gXQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAndXNlcl9pZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogJ2dyb3VwJywKICAgICAgICAgICAgICAgIG1vZGlmaWVyczogWyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3dpdGhQcm9wZXJ0aWVzJywKICAgICAgICAgICAgICAgICAgICBWYWx1ZTogJ3RydWUnCiAgICAgICAgICAgICAgICB9IF0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogJ2dyb3VwX25hbWUnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdwcm9qZWN0JwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAncm9sZScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogJ3JvbGVfbmFtZScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogJ2ZuZDBsb2NhbGUnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICdmbmQwTG9jYXRpb25Db2RlJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAnZm5kMGdyb3VwbWVtYmVyJwogICAgICAgICAgICB9IF0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICdHcm91cCcsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFsgewogICAgICAgICAgICAgICAgbmFtZTogJ3ByaXZpbGVnZScKICAgICAgICAgICAgfSBdCiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAnVXNlcicsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFsgewogICAgICAgICAgICAgICAgbmFtZTogJ2hvbWVfZm9sZGVyJwogICAgICAgICAgICB9IF0KICAgICAgICB9IF0KICAgIH0gKTsKICAgIHJldHVybiBleHBvcnRzLnJlcXVlc3QoIEdFVF9TRVNTSU9OX0lORk8uc2VydmljZU5hbWUsIEdFVF9TRVNTSU9OX0lORk8ub3BlcmF0aW9uTmFtZSwge30sIHsKICAgICAgICBpZ25vcmVIb3N0LAogICAgICAgIGNoZWNrUGFydGlhbEVycm9yczogdHJ1ZQogICAgfSApLnRoZW4oIGZ1bmN0aW9uKCByZXNwb25zZSApIHsKICAgICAgICBwcm9wUG9saWN5U3ZjLnVucmVnaXN0ZXIoIHBvbGljeUlkICk7CiAgICAgICAgZXhwb3J0cy5zZXRTZXNzaW9uSW5mbygpOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0gKS5jYXRjaCggZnVuY3Rpb24oIGVyciApIHsKICAgICAgICBwcm9wUG9saWN5U3ZjLnVucmVnaXN0ZXIoIHBvbGljeUlkICk7CgogICAgICAgIC8vIFNpbmNlIHdlIGhhdmUgbm8gc2Vzc2lvbiwgY2xlYXIgdGhlIHNlc3Npb24gZnJvbSBsb2NhbFN0b3JhZ2UgdG8gZW5zdXJlIHdlIGRvbid0IHRyeSB0byB1c2UgaXQuCiAgICAgICAgbG9jYWxTdHJnLnJlbW92ZUl0ZW0oICdhd1Nlc3Npb24nICk7CgogICAgICAgIHRocm93IGVycjsKICAgIH0gKTsKfTsKCi8qKgogKiBHZXQgVHlwZSBEZXNjcmlwdGlvbnMgZnJvbSBzZXJ2ZXIuCiAqCiAqIE5vdGUsIHRoaXMgaXMgaGlkZGVuIGluIHRoaXMgZmlsZSB0byBhdm9pZCBhbnlvbmUgZWxzZSBkaXJlY3RseSBjYWxsaW5nIHRoaXMuCiAqCiAqIEBwcml2YXRlCiAqCiAqIEBwYXJhbSB7U3RyaW5nQXJyYXl9IHR5cGVOYW1lcyAtIEFycmF5IG9mIHR5cGUgbmFtZXMKICoKICogQHJldHVybiB7UHJvbWlzZX0gUHJvbWlzZSB3aG8ncyByZXNvbHV0aW9uIGlzIHRoZSByZXN1bHQgb2YgdGhlIFNPQSAnZ2V0VHlwZURlc2NyaXB0aW9uczInIG9wZXJhdGlvbi4KICovCmFzeW5jIGZ1bmN0aW9uIGdldFR5cGVEZXNjcmlwdGlvbnMoIHR5cGVOYW1lcyApIHsKICAgIGFzc2VydCggdHlwZU5hbWVzICYmIHR5cGVOYW1lcy5sZW5ndGggPiAwLCAnTm8gdHlwZSBuYW1lcyBwcm92aWRlZCEnICk7CiAgICB0eXBlTmFtZXMuc29ydCgpOwogICAgY29uc3QgdHlwZU5hbWVzRmluYWwgPSBfLnVuaXEoIHR5cGVOYW1lcywgdHJ1ZSApOwoKICAgIGNvbnN0IHR5cGVzVG9Mb2FkID0gdHlwZU5hbWVzRmluYWwuZmlsdGVyKCB0eXBlID0+IHsKICAgICAgICBpZiggIV90eXBlTG9hZEluUHJvZ3Jlc3NbIHR5cGUgXSApIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgICAgfQogICAgfSApOwoKICAgIGNvbnN0IGN1cnJlbnRUeXBlc0JlaW5nTG9hZGVkUHJvbWlzZXMgPSB0eXBlTmFtZXNGaW5hbC5maWx0ZXIoIHR5cGUgPT4gIXR5cGVzVG9Mb2FkLmluY2x1ZGVzKCB0eXBlICkgKS5tYXAoIHR5cGUgPT4gewogICAgICAgIGlmKCBfdHlwZUxvYWRJblByb2dyZXNzWyB0eXBlIF0gKSB7CiAgICAgICAgICAgIHJldHVybiBfdHlwZUxvYWRJblByb2dyZXNzWyB0eXBlIF07CiAgICAgICAgfQogICAgfSApOwoKICAgIGNvbnN0IG5ld0xvYWRQcm9taXNlcyA9IFtdOwoKICAgIGlmKCB0eXBlc1RvTG9hZC5sZW5ndGggPiAwICkgewogICAgICAgIGNvbnN0IGxvYWRUeXBlc1Byb21pc2UgPSBleHBvcnRzLnJlcXVlc3QoICdDb3JlLTIwMTUtMTAtU2Vzc2lvbicsICdnZXRUeXBlRGVzY3JpcHRpb25zMicsIHsKICAgICAgICAgICAgdHlwZU5hbWVzOiB0eXBlc1RvTG9hZCwKICAgICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICAgICAgUHJvcGVydHlFeGNsdXNpb25zOiBbCiAgICAgICAgICAgICAgICAgICAgJ0xvdlJlZmVyZW5jZXMnLAogICAgICAgICAgICAgICAgICAgICdOYW1pbmdSdWxlcycsCiAgICAgICAgICAgICAgICAgICAgJ1JlbmRlcmVyUmVmZXJlbmNlcycKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBUeXBlRXhjbHVzaW9uczogWwogICAgICAgICAgICAgICAgICAgICdEaXJlY3RDaGlsZFR5cGVzSW5mbycsCiAgICAgICAgICAgICAgICAgICAgJ1JldmlzaW9uTmFtaW5nUnVsZXMnLAogICAgICAgICAgICAgICAgICAgICdUb29sSW5mbycKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgcHJvcGVydHlQb2xpY3lPdmVycmlkZToge30KICAgICAgICB9ICk7CgogICAgICAgIGZvciggY29uc3QgdHlwZSBvZiB0eXBlc1RvTG9hZCApIHsKICAgICAgICAgICAgX3R5cGVMb2FkSW5Qcm9ncmVzc1sgdHlwZSBdID0gbG9hZFR5cGVzUHJvbWlzZTsKICAgICAgICB9CgogICAgICAgIG5ld0xvYWRQcm9taXNlcy5wdXNoKCBsb2FkVHlwZXNQcm9taXNlICk7CiAgICB9CgogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQcm9taXNlLmFsbCggWyAuLi5jdXJyZW50VHlwZXNCZWluZ0xvYWRlZFByb21pc2VzLCAuLi5uZXdMb2FkUHJvbWlzZXMgXSApOwoKICAgIGZvciggY29uc3QgdHlwZSBvZiB0eXBlc1RvTG9hZCApIHsKICAgICAgICBkZWxldGUgX3R5cGVMb2FkSW5Qcm9ncmVzc1sgdHlwZSBdOwogICAgfQoKICAgIHJldHVybiByZXNwb25zZTsKfQoKLyoqCiAqIFZlcmlmeSBhc3luYyB0aGF0IHRoZSBnaXZlbiBtb2RlbCB0eXBlcyBhcmUgbG9hZGVkIGludG8gdGhlIGNsaWVudCdzIG1ldGEgbW9kZWwuCiAqCiAqIEBwYXJhbSB7U3RyaW5nQXJyYXl9IHR5cGVOYW1lcyAtIEFuIGFycmF5IG9mIHR5cGUgbmFtZXMgdG8gZW5zdXJlIGFyZSBjYWNoZWQuCiAqCiAqIEByZXR1cm4ge1Byb21pc2V9IFByb21pc2Ugd2hvJ3MgcmVzb2x1dGlvbiBpcyBhICdudWxsJyB2YWx1ZSBzaW5jZSB0aGUgdHlwZXMgYXJlIG5vdyBsb2FkZWQgaW50byB0aGUgY2FjaGUuCiAqICAgICAgICAgVGhpcyAnbnVsbCcgcmVzdWx0IGlzIHJlcXVpcmVkIGJlY2F1c2UgdGhlIEdXVC1zaWRlIHdyYXBwZXIgcmVxdWlyZXMgYW4gQXN5bmNDYWxsYmFjazxWb2lkPiBjYWxsYmFjawogKiAgICAgICAgIChub3QgQXN5bmNDYWxsYmFjazxJSnNBYXJyYXk+KS4KICovCmV4cG9ydCBjb25zdCBlbnN1cmVNb2RlbFR5cGVzTG9hZGVkID0gZnVuY3Rpb24oIHR5cGVOYW1lcyApIHsKICAgIC8qKgogICAgICogSGFuZGxlIHRyaXZpYWwgY2FzZQogICAgICovCiAgICBpZiggIXR5cGVOYW1lcyApIHsKICAgICAgICByZXR1cm4gQXdQcm9taXNlU2VydmljZS5pbnN0YW5jZS5yZWplY3QoICdJbnZhbGlkIHR5cGUgbmFtZSBhcnJheSBzcGVjaWZpZWQnICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGcm9tIHRoZSBpbnB1dCBsaXN0IG9mIHR5cGUgbmFtZXMsIGdldCBhIGxpc3Qgb2YgdW5pcXVlIHR5cGUgbmFtZXMgbm90IGluIHRoZSBDTU0gYWxyZWFkeS4KICAgICAqLwogICAgY29uc3QgbWlzc2luZ1R5cGVOYW1lcyA9IFtdOwoKICAgIF8uZm9yRWFjaCggdHlwZU5hbWVzLCBmdW5jdGlvbiggdHlwZU5hbWUgKSB7CiAgICAgICAgaWYoICFjbW0uY29udGFpbnNUeXBlKCB0eXBlTmFtZSApICYmIF9pbnZhbGlkVHlwZU5hbWVzLmluZGV4T2YoIHR5cGVOYW1lICkgPT09IC0xICkgewogICAgICAgICAgICBtaXNzaW5nVHlwZU5hbWVzLnB1c2goIHR5cGVOYW1lICk7CiAgICAgICAgfQogICAgfSApOwoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgd2UgaGF2ZSBhbnkgbWlzc2luZy4KICAgICAqLwogICAgaWYoIG1pc3NpbmdUeXBlTmFtZXMubGVuZ3RoID4gMCApIHsKICAgICAgICAvLyBsb2dnZXIuaW5mbyggIk1pc3NpbmcgVHlwZXM6ICIgKyBKU09OLnN0cmluZ2lmeSggbWlzc2luZ1R5cGVOYW1lcyApICk7CgogICAgICAgIHJldHVybiBnZXRUeXBlRGVzY3JpcHRpb25zKCBtaXNzaW5nVHlwZU5hbWVzICkudGhlbiggZnVuY3Rpb24oIHJlc3BvbnNlR2V0VHlwZURlc2NyaXB0aW9ucyApIHsKICAgICAgICAgICAgZm9yKCBjb25zdCByZXNwb25zZSBvZiByZXNwb25zZUdldFR5cGVEZXNjcmlwdGlvbnMgKSB7CiAgICAgICAgICAgICAgICBpZiggcmVzcG9uc2UgJiYgcmVzcG9uc2UudHlwZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9kZWxUeXBlcyA9IHJlc3BvbnNlLnR5cGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsVHlwZXMyID0gW107CgogICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCggbW9kZWxUeXBlcywgZnVuY3Rpb24oIHR5cGVOYW1lICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiggIWNtbS5jb250YWluc1R5cGUoIHR5cGVOYW1lICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbFR5cGVzMi5wdXNoKCB0eXBlTmFtZSApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSApOwoKICAgICAgICAgICAgICAgICAgICBpZiggbW9kZWxUeXBlczIubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY21tLmNhY2hlVHlwZXMoIG1vZGVsVHlwZXMyICk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhY2hlIHRoZSB0eXBlcyBpbiBsb2NhbFN0b3JhZ2UuCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVDYWNoZVN2Yy5zZXRMb2NhbFR5cGVzKCBtb2RlbFR5cGVzMiwgX2F3U3RhcnR1cFByZWZlcmVuY2VzLCBfdHlwZUNhY2hlTE1ELCB0cnVlICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENhcHR1cmUgaW52YWxpZCB0eXBlIG5hbWVzCiAgICAgICAgICAgICAgICBfLmZvckVhY2goIG1pc3NpbmdUeXBlTmFtZXMsIGZ1bmN0aW9uKCB0eXBlTmFtZSApIHsKICAgICAgICAgICAgICAgICAgICBpZiggIWNtbS5jb250YWluc1R5cGUoIHR5cGVOYW1lICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBlbXB0eSB0eXBlIHRvIGF2b2lkIGZ1dHVyZSBzZXJ2ZXIgY2FsbHMKICAgICAgICAgICAgICAgICAgICAgICAgX2ludmFsaWRUeXBlTmFtZXMucHVzaCggdHlwZU5hbWUgKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2ludmFsaWRUeXBlTmFtZXMuc29ydCgpOwogICAgICAgICAgICAgICAgICAgICAgICBfaW52YWxpZFR5cGVOYW1lcyA9IF8udW5pcSggX2ludmFsaWRUeXBlTmFtZXMsIHRydWUgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSApOwogICAgfQoKICAgIHJldHVybiBBd1Byb21pc2VTZXJ2aWNlLmluc3RhbmNlLnJlc29sdmUoKTsKfTsKCi8qKgogKiBTZXR1cCB0byBsb2cgYWxsIGV2ZW50cyBmaXJlZCBvbiB0aGUgJ3NvYWpzJyBldmVudEJ1cyBldmVudCBjaGFubmVsLgogKi8KaWYoIGxvZ2dlciAmJiBsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSApIHsKICAgIGV2ZW50QnVzLnN1YnNjcmliZSggJyMnLCBmdW5jdGlvbiggZGF0YSwgZW52ZWxvcGUgKSB7CiAgICAgICAgbGV0IG1zZyA9ICdldmVudEJ1czogJyArIGVudmVsb3BlLnRvcGljICsgJyBAICcgKyBlbnZlbG9wZS50aW1lU3RhbXA7CgogICAgICAgIGlmKCBkYXRhICYmIGRhdGEuZW5kUG9pbnQgKSB7CiAgICAgICAgICAgIGlmKCBlbnZlbG9wZS50b3BpYyA9PT0gJ3Byb2dyZXNzLnN0YXJ0JyApIHsKICAgICAgICAgICAgICAgIF9sYXN0U3RhcnREYXRlWyBkYXRhLmVuZFBvaW50IF0gPSBlbnZlbG9wZS50aW1lU3RhbXA7CiAgICAgICAgICAgIH0gZWxzZSBpZiggZW52ZWxvcGUudG9waWMgPT09ICdwcm9ncmVzcy5lbmQnICYmIF9sYXN0U3RhcnREYXRlWyBkYXRhLmVuZFBvaW50IF0gKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtc0RlbHRhID0gZW52ZWxvcGUudGltZVN0YW1wLmdldFRpbWUoKSAtIF9sYXN0U3RhcnREYXRlWyBkYXRhLmVuZFBvaW50IF0uZ2V0VGltZSgpOwoKICAgICAgICAgICAgICAgIG1zZyA9IG1zZyArICdcbicgKyAnICAgICAgICAgIFRpbWU6ICcgKyBtc0RlbHRhICsgJ21zJyArICcgICAgJyArIGRhdGEuZW5kUG9pbnQ7CgogICAgICAgICAgICAgICAgX2xhc3RTdGFydERhdGVbIGRhdGEuZW5kUG9pbnQgXSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCBsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSApIHsKICAgICAgICAgICAgLy8gSnVzdCBwcmludCwgdXNpbmcgbG9nZ2VyLnRyYWNlIGNhdXNlcyBpbmZpbml0ZSByZWN1cnNpb24KICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyggbXNnLCBlbnZlbG9wZSApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGUKICAgICAgICB9CiAgICB9LCAnc29hX2tlcm5lbF9zb2FTZXJ2aWNlJyApOwp9CgovKioKICogRGV0ZXJtaW5lIGlmIHRoZSB1c2VyIGlzIGN1cnJlbnRseSBzaWduZWQgaW4uCiAqCiAqIEByZXR1cm4ge2Jvb2xlYW59IGlzIHNpZ25lZCBpbj8KICovCmV4cG9ydCBjb25zdCBpc1NpZ25lZEluID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gX3NpZ25lZEluOwp9OwoKZXhwb3J0IGNvbnN0IGdldFBlbmRpbmdSZXF1ZXN0c0NvdW50ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gcGVuZGluZ1JlcXVlc3RzOwp9OwoKLyoqCiAqIFN1YnNjcmliZSB0byBsaXN0ZW4gd2hlbiB3ZSBhcmUgc2lnbmVkIGluL291dC4gSnVzdCB0cmFja2luZyBzdGF0ZSBsb2NhbGx5LiBOT1RFIC0gZm9yIG5vbiBVc2VyL1BXCiAqIGF1dGhlbnRpY2F0aW9uLCB0aGlzIHN0YXRlIG1heSBub3QgYmUgMTAwJSBhY2N1cmF0ZS4KICovCmV2ZW50QnVzLnN1YnNjcmliZSggJ3Nlc3Npb24uc2lnbkluJywgZnVuY3Rpb24oKSB7CiAgICBfc2lnbmVkSW4gPSB0cnVlOwp9LCAnc29hX2tlcm5lbF9zb2FTZXJ2aWNlJyApOwoKZXZlbnRCdXMuc3Vic2NyaWJlKCAnc2Vzc2lvbi5zaWduT3V0JywgZnVuY3Rpb24oKSB7CiAgICBfc2lnbmVkSW4gPSBmYWxzZTsKfSwgJ3NvYV9rZXJuZWxfc29hU2VydmljZScgKTsKCmNvbnN0IGV4cG9ydHMgPSB7CiAgICBjcmVhdGVFcnJvciwKICAgIHBvc3RVbmNoZWNrZWQsCiAgICBwb3N0LAogICAgcmVxdWVzdCwKICAgIHNldFNlc3Npb25JbmZvLAogICAgZ2V0VENTZXNzaW9uSW5mbywKICAgIGVuc3VyZU1vZGVsVHlwZXNMb2FkZWQsCiAgICBpc1NpZ25lZEluLAogICAgc2V0Q2xpZW50SWRIZWFkZXIsCiAgICBnZXRDbGllbnRJZEhlYWRlciwKICAgIHNldFBvbGxpbmdUaW1lb3V0LAogICAgc2V0U29hUmVkaXJlY3QsCiAgICBnZXRQZW5kaW5nUmVxdWVzdHNDb3VudAp9OwpleHBvcnQgZGVmYXVsdCBleHBvcnRzOwo="}]}