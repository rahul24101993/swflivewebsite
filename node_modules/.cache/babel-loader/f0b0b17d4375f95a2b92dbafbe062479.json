{"ast":null,"code":"// Copyright (c) 2021 Siemens\n/* eslint-disable react-hooks/rules-of-hooks */import AwIcon from'viewmodel/AwIconViewModel';import AwPropertyArrayEditVal from'viewmodel/AwPropertyArrayEditValViewModel';import AwDateTimeVal from'viewmodel/AwDateTimeValViewModel';import AwToggleButtonVal from'viewmodel/AwToggleButtonValViewModel';import AwRadioButtonVal from'viewmodel/AwRadiobuttonValViewModel';import AwCheckboxVal from'viewmodel/AwCheckboxValViewModel';import{getValClass}from'js/componentUtils';import{useState}from'react';import ariaList from'js/ariaList';import wcagSvc from'js/wcagService';import _ from'lodash';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const onMount=elementRefList=>{//WCAG keyboard handling\nconst list=new ariaList();let ul=elementRefList.get('arrayVal').current;if(!ul){return;}var obj={setAriaAttributes:false,autoScroll:false,listSelector:'.aw-jswidgets-arrayValueCellListItem'};let childSelector='option';list.init(ul,obj,childSelector);};const focusOnSiblingLi=action=>{//manage focus & tabindex on moveUp/moveDown Command.\nlet li=document.querySelector('li.aw-state-selected');if(li){li.setAttribute('tabindex',-1);let siblingToFocus;if(action==='Move Up'){siblingToFocus=li.previousElementSibling;}else if(action==='Move Down'){siblingToFocus=li.nextElementSibling;}if(siblingToFocus){siblingToFocus.focus();siblingToFocus.setAttribute('tabindex',0);}else{//if no focusable sibling focus on current selected\nli.focus();li.setAttribute('tabindex',0);}}};const focusRequiredElement=(prop,event)=>{if((event.target.type==='button'||event.currentTarget.type==='button')&&event.currentTarget.attributes.title){let operation=event.currentTarget.attributes.title.value;switch(operation){case'Move Up':case'Move Down':focusOnSiblingLi(operation);break;case'Remove':{//set tabIndex of parent ul to 0 since no active tabIndex left after removal\nlet locator=\"[data-locator='\".concat(prop.label,\"']\");let inputEle=document.querySelector(\"input\".concat(locator,\",textarea\").concat(locator));if(inputEle&&inputEle.previousElementSibling!==null){let ulEle=inputEle.previousElementSibling.firstElementChild;if(ulEle!==null){propArrayLength(prop)>0?ulEle.setAttribute('tabIndex','0'):ulEle.setAttribute('tabIndex','-1');}}// focus on input box once li element removed\ninputEle&&inputEle.focus();break;}}}};const isLiItemSelected=event=>{return event.currentTarget.classList.contains('aw-state-selected');};const propArrayLength=prop=>prop.fielddata.displayValsModel.length;const handleClick=(prop,event)=>{let isAnyValueSelected=false;if(prop.fielddata.displayValsModel){for(var j=0;j<propArrayLength(prop);j++){if(prop.fielddata.displayValsModel[j].selected&&prop.fielddata.displayValsModel[j].isInEditMode){isAnyValueSelected=true;break;}}}if(!isAnyValueSelected){event.preventDefault();prop.onClick(event);}focusRequiredElement(prop,event);};const handleKeyDown=(prop,event)=>{if(wcagSvc.isValidKeyPress(event,true)){handleClick(prop,event);}};const handleBlur=(prop,event)=>{event.isBlurFromInput=true;prop.onBlur(event);};const handleKeyPress=(prop,event)=>{if(event.key==='Enter'){event.updateArray=true;event.preventDefault();prop.onChange(event);// revisitme: what is the bext way to clear widget\nevent.target.value='';}};const renderPropertyEditMode=(prop,displayValue,index)=>{if(prop.fielddata.displayValsModel[index].isInEditMode&&prop.typex!=='DATEARRAY'&&prop.typex!=='BOOLEANARRAY'){// eslint-disable-next-line jsx-a11y/no-autofocus\nreturn/*#__PURE__*/_jsx(\"input\",{type:\"text\",onKeyPress:event=>handleKeyPress(prop,event),onBlur:event=>handleBlur(prop,event),id:index,defaultValue:displayValue,autoFocus:true,className:\"aw-jswidgets-arrayValue\"});}else if(prop.fielddata.displayValsModel[index].isInEditMode&&prop.typex==='DATEARRAY'){return/*#__PURE__*/_jsx(AwDateTimeVal,{...prop,className:getValClass(prop)});}else if(prop.fielddata.displayValsModel[index].isInEditMode&&prop.typex==='BOOLEANARRAY'&&prop.fielddata.renderingHint==='radiobutton'){return/*#__PURE__*/_jsx(AwRadioButtonVal,{prop:prop,className:getValClass(prop)});}else if(prop.fielddata.displayValsModel[index].isInEditMode&&prop.typex==='BOOLEANARRAY'&&prop.fielddata.renderingHint==='togglebutton'){return/*#__PURE__*/_jsx(AwToggleButtonVal,{...prop,className:getValClass(prop)});}else if(prop.fielddata.displayValsModel[index].isInEditMode&&prop.typex==='BOOLEANARRAY'){return/*#__PURE__*/_jsx(AwCheckboxVal,{...prop,className:getValClass(prop)});}return/*#__PURE__*/_jsx(\"div\",{role:\"button\",tabIndex:\"-1\",id:index,onKeyDown:event=>handleKeyDown(prop,event),onClick:event=>handleClick(prop,event),className:\"aw-jswidgets-arrayValue\",children:displayValue});};const renderProperty=(prop,displayNode,index,setIsShown,isShown)=>{let displayValue=displayNode.displayValue;let isAnyValueSelected=false;let focusAndHoverEvents={onFocus:()=>{if(wcagSvc.areWeInKeyboardMode()){setIsShown(true);}},onBlur:event=>{if(wcagSvc.areWeInKeyboardMode()&&!isLiItemSelected(event)){setIsShown(false);}},onMouseEnter:()=>{setIsShown(true);},onMouseLeave:()=>{setIsShown(false);}};if(prop.fielddata.displayValsModel){for(var i=0;i<propArrayLength(prop);i++){if(prop.fielddata.displayValsModel[i].selected&&prop.fielddata.displayValsModel[i].isInEditMode){isAnyValueSelected=true;break;}}}const getCellListItemClass=()=>{const selectedClass=propArrayLength(prop)>0&&prop.fielddata.displayValsModel[index].selected?' aw-state-selected':'';return'sw-aria-border aw-jswidgets-arrayValueCellListItem'+selectedClass;};return/*#__PURE__*/_jsx(\"li\",{role:\"option\",\"aria-selected\":isAnyValueSelected,tabIndex:\"-1\",id:index,onKeyDown:event=>handleKeyDown(prop,event),className:getCellListItemClass(),...focusAndHoverEvents,children:/*#__PURE__*/_jsxs(\"div\",{className:\"aw-jswidgets-arrayValueContainer\",children:[renderPropertyEditMode(prop,displayValue,index),(isShown||displayNode.selected)&&!isAnyValueSelected&&!prop.disabled?/*#__PURE__*/_jsx(\"div\",{className:\"aw-layout-flexColumnContainer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"aw-jswidgets-arrayIcons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:event=>handleClick(prop,event),id:index,onKeyDown:event=>handleKeyDown(prop,event),type:\"button\",className:\"aw-commands-commandIconButton aw-widgets-defaultPropertyValueButton\",disabled:prop.fielddata.displayValsModel[index].isInEditMode,title:'Move Up',children:/*#__PURE__*/_jsx(AwIcon,{iconId:\"cmdMoveUp\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:event=>handleClick(prop,event),id:index+1,onKeyDown:event=>handleKeyDown(prop,event),type:\"button\",className:\"aw-commands-commandIconButton aw-widgets-defaultPropertyValueButton\",disabled:prop.fielddata.displayValsModel[index].isInEditMode,title:'Move Down',children:/*#__PURE__*/_jsx(AwIcon,{iconId:\"cmdMoveDown\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:event=>handleClick(prop,event),id:index+2,onKeyDown:event=>handleKeyDown(prop,event),type:\"button\",className:\"aw-commands-commandIconButton aw-widgets-defaultPropertyValueButton\",disabled:prop.fielddata.displayValsModel[index].isInEditMode,title:'Remove',children:/*#__PURE__*/_jsx(AwIcon,{iconId:\"cmdRemove\"})})]})}):'']})},index);};export const awPropertyArrayValRenderFunction=props=>{const{viewModel,ctxMin,actions,i18n,fields,grids,formProp,messages,elementRefList,...prop}=props;const getContainerClass=()=>{let borderClass='';if(prop.fielddata.displayValsModel&&propArrayLength(prop)>0){borderClass=' sw-border';}return'aw-jswidgets-arrayWidgetContainer'+borderClass;};const getPropContainerClass=()=>{let classVal='sw-array-val sw-property-val sw-column';const changedClass=!prop.disabled&&(prop.dirty==='true'||prop.dirty===true)?' sw-changed':'';return classVal+changedClass;};const[isShown,setIsShown]=useState(false);let ariaProp={};_.each(prop,(v,k)=>{k.startsWith('aria-')&&(ariaProp[k]=v);});return/*#__PURE__*/_jsxs(\"div\",{className:getPropContainerClass(),children:[/*#__PURE__*/_jsx(\"div\",{className:getContainerClass(),children:/*#__PURE__*/_jsx(\"ul\",{role:\"listbox\",...ariaProp,className:\"aw-jswidgets-arrayEditValueCellList\",tabIndex:propArrayLength(prop)>0?'0':'-1',ref:elementRefList.get('arrayVal'),children:prop.fielddata.displayValsModel&&prop.fielddata.displayValsModel.map((displayNode,index)=>renderProperty(prop,displayNode,index,setIsShown,isShown))})}),!prop.disabled?/*#__PURE__*/_jsx(AwPropertyArrayEditVal,{...prop}):'']});};","map":null,"metadata":{},"sourceType":"module"}