{"ast":null,"code":"/* eslint-disable complexity */\n// Copyright (c) 2021 Siemens\nimport _ from 'lodash';\nimport moduleLoader from 'js/moduleLoader';\nimport cfgSvc from 'js/configurationService';\nimport localeService from 'js/localeService';\nimport editHandlerService from 'js/editHandlerService';\nimport appCtxService from 'js/appCtxService';\nimport conditionService from 'js/conditionService';\nimport AwPromiseService from 'js/awPromiseService';\nimport localStorage from 'js/localStorage';\nimport Debug from 'debug';\nimport { DerivedStateResult } from 'js/derivedContextService';\nimport { parseCondition } from 'js/conditionParser.service';\nimport { concat, flatten } from 'lodash';\nconst trace = new Debug('selection');\n\nconst loadTabTitle = tab => {\n  if (typeof tab.name !== 'string') {\n    localeService.getLocalizedText(tab.name.source, tab.name.key).then(function (result) {\n      tab.name = result;\n    });\n  }\n};\n\nconst loadSecondaryWorkareaTabs = async () => {\n  return await cfgSvc.getCfg('secondaryWorkareaTabs').then(tabsConfig => {\n    tabsConfig.tabs.forEach(function (tab, idx) {\n      tab.pageId = tab.pageId ? tab.pageId : idx;\n    });\n    tabsConfig.tabs.forEach(loadTabTitle);\n    return tabsConfig;\n  });\n};\n\nexport const initialize = () => {\n  return loadSecondaryWorkareaTabs().then(tabsConfig => {\n    const {\n      ctxParameters,\n      additionalParameters\n    } = getTabsState(tabsConfig);\n    return {\n      tabsConfig,\n      ctxParameters,\n      additionalParameters\n    };\n  });\n};\n\nconst conditionFilter = (tab, tabsConfig, selection, context) => {\n  var conditionExpression = tab.visibleWhen;\n\n  if (tab.visibleWhen && tab.visibleWhen.condition) {\n    var conditionExpressionObj = _.get(tabsConfig, tab.visibleWhen.condition);\n\n    conditionExpression = conditionExpressionObj.expression;\n  }\n\n  tab.displayTab = true;\n\n  if (conditionExpression) {\n    tab.displayTab = conditionService.evaluateCondition({\n      ctx: appCtxService.ctx,\n      selection: selection,\n      context: { ...context,\n        isXrtApplicable: context && context.hasOwnProperty('isXrtApplicable') ? context.isXrtApplicable : !_.isUndefined(appCtxService.ctx.tcSessionData)\n      }\n    }, conditionExpression);\n  }\n\n  return tab.displayTab;\n};\n\nconst isActiveTabStillVisible = (visibleTabs, activeTab) => {\n  return visibleTabs.filter(tab => tab.tabContent ? tab.pageId === activeTab.pageId && _.isEqual(tab.tabContent, activeTab.tabContent) : tab.pageId === activeTab.pageId).length > 0;\n};\n\nconst updateTabsToShow = (tabsToShow, activeTab) => {\n  let index = _.findIndex(tabsToShow, tab => {\n    return tab.pageId === activeTab.pageId || tab.name === activeTab.name;\n  }, 0);\n\n  tabsToShow = _.map(tabsToShow, (tab, idx) => {\n    if (idx === index) {\n      tab.selectedTab = true;\n    } else {\n      tab.selectedTab = undefined;\n    }\n\n    return tab;\n  });\n  return tabsToShow;\n};\n\nconst isContributedTabActive = (swaContributedTabs, activeTab) => {\n  if (activeTab && swaContributedTabs && swaContributedTabs.length > 0) {\n    let ndx = -1;\n\n    if (typeof activeTab === 'object') {\n      ndx = _.findIndex(swaContributedTabs, tab => {\n        return tab.pageId === activeTab.pageId || tab.name === activeTab.name;\n      }, 0);\n    } else if (typeof activeTab === 'string') {\n      ndx = _.findIndex(swaContributedTabs, tab => {\n        return tab.name === activeTab || tab.view === activeTab;\n      }, 0);\n    }\n\n    return ndx > -1;\n  }\n\n  return false;\n};\n\nconst fetchChildTabs = (containerTab, selection, activeTab, swaContributedTabs, context) => {\n  let isContributedTab = isContributedTabActive(swaContributedTabs, activeTab);\n  activeTab = isContributedTab === false ? activeTab : undefined;\n  var deferred = AwPromiseService.instance.defer();\n\n  if (containerTab.deps) {\n    const doAction = depModuleObj => {\n      return depModuleObj[containerTab.method](selection, activeTab, context, isContributedTab);\n    };\n\n    return moduleLoader.loadDependentModule(containerTab.deps).then(doAction);\n  }\n\n  return deferred.Promise;\n};\n\nexport const syncSublocationState = (activeTab, sublocationState) => {\n  let newSublocationState;\n\n  if (sublocationState) {\n    newSublocationState = { ...sublocationState.value\n    };\n  } else {\n    newSublocationState = {};\n  }\n\n  newSublocationState.secondaryActiveTabId = activeTab.tabKey ? activeTab.tabKey : activeTab.view;\n\n  if (sublocationState.secondaryActiveTabId !== newSublocationState.secondaryActiveTabId) {\n    sublocationState.update(newSublocationState);\n  }\n};\nexport const clearSublocationState = sublocationState => {\n  let newSublocationState = { ...sublocationState.value\n  };\n  newSublocationState.secondaryActiveTabId = undefined;\n  sublocationState.update(newSublocationState);\n};\n\nconst processFetchedData = (data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, activeTab, output, containerPriority, updatedTabsToShow, containerTab) => {\n  let tabToActivate = {};\n  let tabsToShow = [];\n  let childTabs = [];\n\n  if (output) {\n    let allVisibleTabs = data.getData().changedAllVisibleTabs;\n    let allVisibleContributedTabs = [];\n\n    if (allVisibleTabs) {\n      allVisibleTabs.map(tab => {\n        let tabClone = { ...tab\n        };\n\n        if (!tabClone.hasChildTabs) {\n          allVisibleContributedTabs.push(tabClone);\n        }\n      });\n\n      if (allVisibleContributedTabs.length === 0) {\n        allVisibleContributedTabs = swaContributedTabs;\n      }\n    } else {\n      allVisibleContributedTabs = swaContributedTabs;\n    }\n\n    childTabs = output.childTabs;\n\n    _.forEach(childTabs, childTab => {\n      childTab.priority = containerPriority;\n    });\n\n    tabsToShow = tabsToShow.concat(childTabs, allVisibleContributedTabs);\n  } else {\n    tabsToShow = updatedTabsToShow ? updatedTabsToShow : swaContributedTabs;\n  } // sort the contributed and container tabs based on priority\n\n\n  tabsToShow.sort(function (t1, t2) {\n    return t1.priority - t2.priority;\n  });\n  let requestedActiveTab = activeTab;\n  activeTab = evalTabObj(tabsToShow, activeTab);\n\n  if (!_.isEmpty(activeTab) && isActiveTabStillVisible(tabsToShow, activeTab)) {\n    tabToActivate = activeTab;\n    tabsToShow = updateTabsToShow(tabsToShow, activeTab);\n  } else if (_.isEmpty(activeTab)) {\n    requestedActiveTab = localStorage.get('lastActiveTab');\n    let activeTab1 = evalTabObj(tabsToShow, requestedActiveTab);\n\n    if (!_.isEmpty(activeTab1) && isActiveTabStillVisible(tabsToShow, activeTab1) && requestedActiveTab !== '') {\n      return fetchTabsData(selectionData, tabsConfig, containerTab, selection, requestedActiveTab, swaContributedTabs, data, context, dispatch, tabsToShow);\n    }\n\n    tabToActivate = tabsToShow[0];\n    tabsToShow = updateTabsToShow(tabsToShow, tabToActivate);\n  } else {\n    tabToActivate = tabsToShow[0];\n    tabsToShow = updateTabsToShow(tabsToShow, tabToActivate);\n  }\n\n  if (tabToActivate) {\n    tabToActivate.tabContent = output ? output.activeTabContent : undefined;\n    tabToActivate.extraInfo = output ? output.extraInfo : null;\n  }\n\n  const tabChangeCallback = (pageId, tabTitle, refresh) => {\n    localStorage.publish('lastActiveTab', pageId);\n    clearSelectionData(selectionData);\n    activateTab(data, selectionData, tabsConfig, pageId, tabTitle, tabsToShow, swaContributedTabs, dispatch, selection, context, refresh, containerPriority);\n  };\n\n  const activeTabKey = tabToActivate && tabToActivate.tabKey ? tabToActivate.tabKey : tabToActivate ? tabToActivate.view : '';\n  let unExpandedVisibleTabs = data && data.ctx && data.ctx.visibleTabs ? data.ctx.visibleTabs : undefined;\n\n  if (!unExpandedVisibleTabs || unExpandedVisibleTabs.length === 0) {\n    unExpandedVisibleTabs = data && data.getData() && data.getData().summaryContext && data.getData().summaryContext.unExpandedVisibleTabs;\n  }\n\n  return {\n    summaryContext: {\n      activeTab: tabToActivate,\n      visibleTabs: tabsToShow,\n      api: tabChangeCallback,\n      selection: selection,\n      allVisibleTabs: updatedTabsToShow,\n      activeTabKey: activeTabKey,\n      childTabs: childTabs,\n      unExpandedVisibleTabs\n    }\n  };\n};\n\nconst fetchTabsData = (selectionData, tabsConfig, containerTab, selection, activeTab, swaContributedTabs, data, context, dispatch, allVisibleTabs) => {\n  return fetchChildTabs(containerTab, selection[0], activeTab, swaContributedTabs, context).then(output => {\n    const currentSelection = data.getData().summaryContext && data.getData().summaryContext.selection ? data.getData().summaryContext.selection : undefined;\n\n    if (!currentSelection || currentSelection && currentSelection.length === 1 && currentSelection[0].uid === selection[0].uid) {\n      return processFetchedData(data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, activeTab, output, containerTab.priority, allVisibleTabs, containerTab);\n    }\n\n    if (currentSelection && currentSelection.length === 1) {\n      return fetchTabsData(selectionData, tabsConfig, containerTab, currentSelection, activeTab, swaContributedTabs, data, context, dispatch);\n    }\n\n    return AwPromiseService.instance.resolve({\n      summaryContext: data.getData().summaryContext\n    });\n  });\n};\n\nconst evalTabObj = (tabsToShow, activeTab) => {\n  if (typeof activeTab !== 'object') {\n    let index = _.findIndex(tabsToShow, tab => {\n      return tab.pageId && tab.pageId === activeTab || tab.tabKey && tab.tabKey === activeTab || tab.name && tab.name === activeTab || tab.view && tab.view === activeTab || tab.id && tab.id === activeTab;\n    }, 0);\n\n    activeTab = tabsToShow[index];\n  }\n\n  return activeTab;\n};\n\nconst isInputSelectionSameAsCurrentSelection = (currentSelection, inputSelection) => {\n  if (!currentSelection && !inputSelection || currentSelection && currentSelection.length === 0 && inputSelection && inputSelection.length === 0) {\n    return true;\n  }\n\n  return currentSelection.length === inputSelection.length && inputSelection.length > 0 && _.isEqual(currentSelection[0].uid, inputSelection[0].uid);\n};\n\nconst areInputPropsAndDataNotPopulatedYet = (props, data) => {\n  return !props || !props.selection || !data || !props.tabsConfig || !props.tabsConfig.tabs;\n};\n\nconst areCurrentUnexpandedVisibleTabsSameAsInputUnexpandedVisibleTabs = (currentlyVisibleUnExpandedTabs, inputUnExpandedTabs) => {\n  if (!currentlyVisibleUnExpandedTabs && !inputUnExpandedTabs) {\n    return true;\n  }\n\n  if (!currentlyVisibleUnExpandedTabs || !inputUnExpandedTabs) {\n    return false;\n  }\n\n  if (currentlyVisibleUnExpandedTabs.length !== inputUnExpandedTabs.length) {\n    return false;\n  }\n\n  for (var i = 0; i < currentlyVisibleUnExpandedTabs.length; ++i) {\n    var cachedTabKey = currentlyVisibleUnExpandedTabs[i].tabKey ? currentlyVisibleUnExpandedTabs[i].tabKey : currentlyVisibleUnExpandedTabs[i].name;\n    var receivedTabKey = inputUnExpandedTabs[i].tabKey ? inputUnExpandedTabs[i].tabKey : inputUnExpandedTabs[i].name;\n\n    if (cachedTabKey !== receivedTabKey) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst isCurrentlyVisibleTabAContributedTabAndIsNoLongerAvailableInNewVisibleTabs = (summaryContext, unExpandedVisibleTabs, currentlyActiveTabId) => {\n  return summaryContext && summaryContext.activeTab && !summaryContext.activeTab.api && unExpandedVisibleTabs && unExpandedVisibleTabs.filter(tab => tab.view === currentlyActiveTabId).length === 0;\n};\n\nconst isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab = (tabRequestedToBeActivated, data) => {\n  let currentlyActiveTabKey = data && data.summaryContext && data.summaryContext.activeTab && data.summaryContext.activeTab.tabKey ? data.summaryContext.activeTab.tabKey : data && data.summaryContext && data.summaryContext.activeTab && data.summaryContext.activeTab.view ? data.summaryContext.activeTab.view : '';\n\n  if (tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey) {\n    currentlyActiveTabKey = data && data.getData() && data.getData().summaryContext && data.getData().summaryContext.activeTab && data.getData().summaryContext.activeTab.tabKey ? data && data.getData().summaryContext.activeTab.tabKey : data.getData() && data.getData().summaryContext && data.getData().summaryContext.activeTab && data.getData().summaryContext.activeTab.view ? data.getData().summaryContext.activeTab.view : '';\n\n    if (tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey) {\n      currentlyActiveTabKey = data && data.summaryContext ? data.summaryContext.activeTabKey : '';\n\n      if (tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey) {\n        currentlyActiveTabKey = data && data.getData().summaryContext ? data.getData().summaryContext.activeTabKey : '';\n\n        if (tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey) {\n          return true;\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nexport const getTabToActivateAndVisibleTabs = (data, props, unExpandedVisibleTabs) => {\n  const getTabToActivate = () => {\n    let containerTabs = [];\n    let swaContributedTabs = [];\n\n    if (tabsConfig) {\n      var allVisibleTabs = [];\n      tabsConfig.tabs.map(tab => {\n        let tabClone = { ...tab\n        };\n\n        if (conditionFilter(tabClone, tabsConfig, localSelection, context)) {\n          allVisibleTabs.push(tabClone);\n        }\n      });\n\n      for (const tab of allVisibleTabs) {\n        if (tab.hasChildTabs === true) {\n          containerTabs.push(tab);\n        } else {\n          swaContributedTabs.push(tab);\n        }\n      }\n    }\n\n    if (containerTabs.length > 0 && !skipAfreshChildFetch) {\n      dispatch({\n        path: 'data.changedAllVisibleTabs',\n        value: []\n      });\n      return fetchTabsData(props.selectionData, props.tabsConfig, containerTabs[0], localSelection, tabToActivateNow, swaContributedTabs, data, context, dispatch, allVisibleTabs);\n    }\n\n    if (containerTabs.length > 0) {\n      var output = {\n        childTabs: data.summaryContext ? data.summaryContext.childTabs : [],\n        activeTabContent: _.get(data, 'summaryContext.activeTab.tabContent')\n      };\n\n      if (!output.extraInfo) {\n        output.extraInfo = data.summaryContext && data.summaryContext.activeTab ? data.summaryContext.activeTab.extraInfo : null;\n      }\n\n      if (!output.childTabs || output.childTabs.length === 0) {\n        dispatch({\n          path: 'data.changedAllVisibleTabs',\n          value: unExpandedVisibleTabs\n        });\n        return;\n      }\n\n      return AwPromiseService.instance.resolve(processFetchedData(data, props.selectionData, props.tabsConfig, localSelection, context, dispatch, swaContributedTabs, tabToActivateNow, output, containerTabs[0].priority, allVisibleTabs, containerTabs[0]));\n    }\n\n    return AwPromiseService.instance.resolve(processFetchedData(data, props.selectionData, props.tabsConfig, localSelection, context, dispatch, swaContributedTabs, tabToActivateNow));\n  };\n\n  if (areInputPropsAndDataNotPopulatedYet(props, data)) {\n    return;\n  }\n\n  const {\n    dispatch\n  } = data;\n  const {\n    summaryContext\n  } = data.getData();\n  const {\n    selection,\n    context,\n    tabsConfig\n  } = props;\n  let localSelection = Array.isArray(selection) ? selection : [selection];\n  let allVisibleTabsInternal = [];\n\n  if (tabsConfig) {\n    tabsConfig.tabs.map(tab => {\n      let tabClone = { ...tab\n      };\n\n      if (conditionFilter(tabClone, tabsConfig, localSelection, context)) {\n        allVisibleTabsInternal.push(tabClone);\n      }\n    });\n  }\n\n  let tabRequestedToBeActivated = context && context.pageContext && context.pageContext.sublocationState && context.pageContext.sublocationState.secondaryActiveTabId !== '' ? context.pageContext.sublocationState.secondaryActiveTabId : '';\n\n  if (!tabRequestedToBeActivated) {\n    tabRequestedToBeActivated = '';\n  }\n\n  let currentlyActiveTabId = summaryContext && summaryContext.activeTabKey ? summaryContext.activeTabKey : '';\n  let tabToActivateNow = currentlyActiveTabId;\n\n  if (isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab(tabRequestedToBeActivated, data)) {\n    tabToActivateNow = tabRequestedToBeActivated;\n    localStorage.publish('lastActiveTab', tabToActivateNow);\n  }\n\n  if (summaryContext) {\n    if (!isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab(tabRequestedToBeActivated, data) && isInputSelectionSameAsCurrentSelection(summaryContext.selection, localSelection) && areCurrentUnexpandedVisibleTabsSameAsInputUnexpandedVisibleTabs(summaryContext.unExpandedVisibleTabs, allVisibleTabsInternal)) {\n      return;\n    }\n  }\n\n  let skipAfreshChildFetch = false;\n\n  if (summaryContext) {\n    if (isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab(tabRequestedToBeActivated, data)) {\n      tabToActivateNow = tabRequestedToBeActivated;\n    } else if (isInputSelectionSameAsCurrentSelection(summaryContext.selection, localSelection)) {\n      skipAfreshChildFetch = true;\n\n      if (isCurrentlyVisibleTabAContributedTabAndIsNoLongerAvailableInNewVisibleTabs(summaryContext, allVisibleTabsInternal, currentlyActiveTabId)) {\n        skipAfreshChildFetch = false;\n      }\n    }\n  }\n\n  if (tabToActivateNow === '') {\n    tabToActivateNow = localStorage.get('lastActiveTab') ? localStorage.get('lastActiveTab') : tabToActivateNow;\n  }\n\n  let localSummaryContext = { ...data.summaryContext\n  };\n  localSummaryContext.selection = localSelection;\n  localSummaryContext.unExpandedVisibleTabs = allVisibleTabsInternal;\n  localSummaryContext.activeTabKey = tabToActivateNow;\n  dispatch({\n    path: 'data.summaryContext',\n    value: localSummaryContext\n  });\n  let pwaEditContext = context ? context.editContext : '';\n\n  if (!pwaEditContext || pwaEditContext === '') {\n    pwaEditContext = 'TABLE_CONTEXT';\n  }\n\n  let pwaEditHandler = editHandlerService.getEditHandler(pwaEditContext);\n  const isActiveTabIsNonStickyAndNoSelectionChange = !summaryContext || _.get(summaryContext, 'activeTab.api') !== undefined || isInputSelectionSameAsCurrentSelection(summaryContext.selection, localSelection);\n\n  if (!pwaEditHandler || !pwaEditHandler.editInProgress() && isActiveTabIsNonStickyAndNoSelectionChange) {\n    return editHandlerService.leaveConfirmation().then(function () {\n      return getTabToActivate();\n    });\n  }\n\n  return getTabToActivate();\n};\n\nconst activateTab = (data, selectionData, tabsConfig, pageId, tabTitle, tabsToShow, swaContributedTabs, dispatch, selection, context, refresh, containerPriority) => {\n  const selectedTab = tabsToShow.filter(function (tab) {\n    return tab.pageId === pageId || tab.name === tabTitle;\n  })[0];\n\n  const updateSelectionSummaryContext = output => {\n    let {\n      summaryContext\n    } = processFetchedData(data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, selectedTab, output, containerPriority, tabsToShow);\n    dispatch({\n      path: 'data.summaryContext',\n      value: summaryContext\n    });\n  };\n\n  const handleTabChange = () => {\n    if (selectedTab && selectedTab.api) {\n      if (!selectedTab.tabContent || refresh) {\n        const selectedTabTitle = selectedTab.tabKey ? selectedTab.tabKey : selectedTab.view;\n        dispatch({\n          path: 'data.summaryContext.activeTabKey',\n          value: selectedTabTitle\n        });\n        selectedTab.api(selection[0], selectedTabTitle, null, null, context).then(output => {\n          updateSelectionSummaryContext(output);\n        });\n      }\n    } else {\n      updateSelectionSummaryContext();\n    }\n  };\n\n  let pwaEditContext = context ? context.editContext : '';\n\n  if (!pwaEditContext || pwaEditContext === '') {\n    pwaEditContext = 'TABLE_CONTEXT';\n  }\n\n  let pwaEditHandler = editHandlerService.getEditHandler(pwaEditContext);\n\n  if (!pwaEditHandler || !pwaEditHandler.editInProgress()) {\n    editHandlerService.leaveConfirmation().then(function () {\n      return handleTabChange();\n    });\n  } else {\n    return handleTabChange();\n  }\n};\n\nexport const updateSelection = selection => {\n  return Array.isArray(selection) ? selection : [selection];\n};\nexport const getContext = (vmDef, props, data) => {\n  return [new DerivedStateResult({\n    ctxParameters: [],\n    additionalParameters: [data.summaryContext, props.selection, props.context, props.selectionData],\n    compute: () => {\n      return {\n        activeTab: data.summaryContext ? data.summaryContext.activeTab : undefined,\n        selection: Array.isArray(props.selection) ? props.selection : [props.selection],\n        context: props.context,\n        api: data.summaryContext ? data.summaryContext.api : undefined,\n        selectionData: props.selectionData\n      };\n    }\n  })];\n};\n\nconst clearSelectionData = selectionData => {\n  if (selectionData && selectionData.getValue() && selectionData.getValue().selected && selectionData.getValue().selected.length > 0) {\n    selectionData.update({\n      selected: [],\n      relationInfo: []\n    });\n  }\n};\n\nconst getTabsState = tabsConfig => {\n  if (tabsConfig) {\n    return (tabsConfig.tabs || []).reduce((acc, tab) => {\n      let visibleWhenCondition = {};\n\n      if (tab.visibleWhen && tab.visibleWhen.condition) {\n        visibleWhenCondition = _.get(tabsConfig, tab.visibleWhen.condition);\n      } else {\n        visibleWhenCondition.expression = tab.visibleWhen;\n      }\n\n      const conditionDeps = [parseCondition(visibleWhenCondition, ['selection', 'context'])];\n      return {\n        ctxParameters: _.uniq(concat(flatten(conditionDeps.map(x => x.ctxParameters)), acc.ctxParameters)),\n        additionalParameters: _.uniq(concat(acc.additionalParameters, flatten(conditionDeps.map(x => x.additionalParameters))))\n      };\n    }, {\n      ctxParameters: [],\n      additionalParameters: []\n    });\n  }\n\n  return {\n    ctxParameters: [],\n    additionalParameters: []\n  };\n};\n\nexport const getVisibleTabs = (vmDef, props, data) => {\n  let {\n    context,\n    tabsConfig,\n    selection,\n    additionalParameters,\n    ctxParameters\n  } = props;\n  let localSelection = Array.isArray(selection) ? selection : [selection];\n\n  const getAllVisibleTabs = () => {\n    let allVisibleTabs = [];\n\n    if (tabsConfig) {\n      tabsConfig.tabs.map(tab => {\n        let tabClone = { ...tab\n        };\n\n        if (conditionFilter(tabClone, tabsConfig, localSelection, context)) {\n          allVisibleTabs.push(tabClone);\n        }\n      });\n    }\n\n    if (allVisibleTabs) {\n      return allVisibleTabs;\n    }\n  };\n\n  const scope = {\n    context,\n    selection\n  };\n\n  const getFromProps = path => _.get(scope, path);\n\n  const localAdditionalParameters = additionalParameters.map(getFromProps);\n  return new DerivedStateResult({\n    ctxParameters,\n    additionalParameters: localAdditionalParameters,\n    compute: getAllVisibleTabs\n  });\n};","map":{"version":3,"names":["_","moduleLoader","cfgSvc","localeService","editHandlerService","appCtxService","conditionService","AwPromiseService","localStorage","Debug","DerivedStateResult","parseCondition","concat","flatten","trace","loadTabTitle","tab","name","getLocalizedText","source","key","then","result","loadSecondaryWorkareaTabs","getCfg","tabsConfig","tabs","forEach","idx","pageId","initialize","ctxParameters","additionalParameters","getTabsState","conditionFilter","selection","context","conditionExpression","visibleWhen","condition","conditionExpressionObj","get","expression","displayTab","evaluateCondition","ctx","isXrtApplicable","hasOwnProperty","isUndefined","tcSessionData","isActiveTabStillVisible","visibleTabs","activeTab","filter","tabContent","isEqual","length","updateTabsToShow","tabsToShow","index","findIndex","map","selectedTab","undefined","isContributedTabActive","swaContributedTabs","ndx","view","fetchChildTabs","containerTab","isContributedTab","deferred","instance","defer","deps","doAction","depModuleObj","method","loadDependentModule","Promise","syncSublocationState","sublocationState","newSublocationState","value","secondaryActiveTabId","tabKey","update","clearSublocationState","processFetchedData","data","selectionData","dispatch","output","containerPriority","updatedTabsToShow","tabToActivate","childTabs","allVisibleTabs","getData","changedAllVisibleTabs","allVisibleContributedTabs","tabClone","hasChildTabs","push","childTab","priority","sort","t1","t2","requestedActiveTab","evalTabObj","isEmpty","activeTab1","fetchTabsData","activeTabContent","extraInfo","tabChangeCallback","tabTitle","refresh","publish","clearSelectionData","activateTab","activeTabKey","unExpandedVisibleTabs","summaryContext","api","currentSelection","uid","resolve","id","isInputSelectionSameAsCurrentSelection","inputSelection","areInputPropsAndDataNotPopulatedYet","props","areCurrentUnexpandedVisibleTabsSameAsInputUnexpandedVisibleTabs","currentlyVisibleUnExpandedTabs","inputUnExpandedTabs","i","cachedTabKey","receivedTabKey","isCurrentlyVisibleTabAContributedTabAndIsNoLongerAvailableInNewVisibleTabs","currentlyActiveTabId","isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab","tabRequestedToBeActivated","currentlyActiveTabKey","getTabToActivateAndVisibleTabs","getTabToActivate","containerTabs","localSelection","skipAfreshChildFetch","path","tabToActivateNow","Array","isArray","allVisibleTabsInternal","pageContext","localSummaryContext","pwaEditContext","editContext","pwaEditHandler","getEditHandler","isActiveTabIsNonStickyAndNoSelectionChange","editInProgress","leaveConfirmation","updateSelectionSummaryContext","handleTabChange","selectedTabTitle","updateSelection","getContext","vmDef","compute","getValue","selected","relationInfo","reduce","acc","visibleWhenCondition","conditionDeps","uniq","x","getVisibleTabs","getAllVisibleTabs","scope","getFromProps","localAdditionalParameters"],"sources":["C:/Users/rahukl57/Desktop/SWF/CreatingOwnComponentUsingJsx/node_modules/@swf/core/src/pagelevelcomponents/src/js/AwSelectionSummaryService.js"],"sourcesContent":["/* eslint-disable complexity */\n// Copyright (c) 2021 Siemens\nimport _ from 'lodash';\nimport moduleLoader from 'js/moduleLoader';\nimport cfgSvc from 'js/configurationService';\nimport localeService from 'js/localeService';\nimport editHandlerService from 'js/editHandlerService';\nimport appCtxService from 'js/appCtxService';\nimport conditionService from 'js/conditionService';\nimport AwPromiseService from 'js/awPromiseService';\nimport localStorage from 'js/localStorage';\nimport Debug from 'debug';\nimport { DerivedStateResult } from 'js/derivedContextService';\nimport { parseCondition } from 'js/conditionParser.service';\nimport { concat, flatten } from 'lodash';\n\nconst trace = new Debug( 'selection' );\n\nconst loadTabTitle = tab => {\n    if( typeof tab.name !== 'string' ) {\n        localeService.getLocalizedText( tab.name.source, tab.name.key ).then( function( result ) {\n            tab.name = result;\n        } );\n    }\n};\n\nconst loadSecondaryWorkareaTabs = async() => {\n    return await cfgSvc.getCfg( 'secondaryWorkareaTabs' ).then( tabsConfig => {\n        tabsConfig.tabs.forEach( function( tab, idx ) {\n            tab.pageId = tab.pageId ? tab.pageId : idx;\n        } );\n        tabsConfig.tabs.forEach( loadTabTitle );\n        return tabsConfig;\n    } );\n};\n\nexport const initialize = () => {\n    return loadSecondaryWorkareaTabs().then( tabsConfig => {\n        const { ctxParameters, additionalParameters } = getTabsState( tabsConfig );\n        return {\n            tabsConfig,\n            ctxParameters,\n            additionalParameters\n        };\n    } );\n};\n\nconst conditionFilter = ( tab, tabsConfig, selection, context ) => {\n    var conditionExpression = tab.visibleWhen;\n    if( tab.visibleWhen && tab.visibleWhen.condition ) {\n        var conditionExpressionObj = _.get( tabsConfig, tab.visibleWhen.condition );\n        conditionExpression = conditionExpressionObj.expression;\n    }\n\n    tab.displayTab = true;\n    if( conditionExpression ) {\n        tab.displayTab = conditionService.evaluateCondition( {\n            ctx: appCtxService.ctx,\n            selection: selection,\n            context: { ...context, isXrtApplicable: context && context.hasOwnProperty( 'isXrtApplicable' ) ? context.isXrtApplicable : !_.isUndefined( appCtxService.ctx.tcSessionData ) }\n        }, conditionExpression );\n    }\n    return tab.displayTab;\n};\n\nconst isActiveTabStillVisible = ( visibleTabs, activeTab ) => {\n    return visibleTabs.filter( tab => tab.tabContent ? tab.pageId === activeTab.pageId && _.isEqual( tab.tabContent, activeTab.tabContent ) : tab.pageId === activeTab.pageId ).length > 0;\n};\n\nconst updateTabsToShow = ( tabsToShow, activeTab ) => {\n    let index = _.findIndex( tabsToShow, ( tab ) => {\n        return tab.pageId === activeTab.pageId || tab.name === activeTab.name;\n    }, 0 );\n    tabsToShow = _.map( tabsToShow, ( tab, idx ) => {\n        if( idx === index ) {\n            tab.selectedTab = true;\n        } else {\n            tab.selectedTab = undefined;\n        }\n        return tab;\n    } );\n    return tabsToShow;\n};\n\nconst isContributedTabActive = ( swaContributedTabs, activeTab ) => {\n    if( activeTab && swaContributedTabs && swaContributedTabs.length > 0 ) {\n        let ndx = -1;\n        if( typeof activeTab === 'object' ) {\n            ndx = _.findIndex( swaContributedTabs, ( tab ) => {\n                return tab.pageId === activeTab.pageId || tab.name === activeTab.name;\n            }, 0 );\n        } else if( typeof activeTab === 'string' ) {\n            ndx = _.findIndex( swaContributedTabs, ( tab ) => {\n                return tab.name === activeTab || tab.view === activeTab;\n            }, 0 );\n        }\n        return ndx > -1;\n    }\n    return false;\n};\n\nconst fetchChildTabs = ( containerTab, selection, activeTab, swaContributedTabs, context ) => {\n    let isContributedTab = isContributedTabActive( swaContributedTabs, activeTab );\n    activeTab = isContributedTab === false ? activeTab : undefined;\n    var deferred = AwPromiseService.instance.defer();\n    if( containerTab.deps ) {\n        const doAction = depModuleObj => {\n            return depModuleObj[ containerTab.method ]( selection, activeTab, context, isContributedTab  );\n        };\n        return moduleLoader.loadDependentModule( containerTab.deps ).then( doAction );\n    }\n    return deferred.Promise;\n};\n\nexport const syncSublocationState = ( activeTab, sublocationState ) => {\n    let newSublocationState;\n    if( sublocationState ) {\n        newSublocationState = { ...sublocationState.value };\n    } else {\n        newSublocationState = {};\n    }\n    newSublocationState.secondaryActiveTabId = activeTab.tabKey ? activeTab.tabKey : activeTab.view;\n    if( sublocationState.secondaryActiveTabId !== newSublocationState.secondaryActiveTabId ) {\n        sublocationState.update( newSublocationState );\n    }\n};\n\nexport const clearSublocationState = ( sublocationState ) => {\n    let newSublocationState = { ...sublocationState.value };\n    newSublocationState.secondaryActiveTabId = undefined;\n    sublocationState.update( newSublocationState );\n};\n\nconst processFetchedData = ( data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, activeTab, output, containerPriority, updatedTabsToShow, containerTab ) => {\n    let tabToActivate = {};\n    let tabsToShow = [];\n    let childTabs = [];\n\n    if( output ) {\n        let allVisibleTabs = data.getData().changedAllVisibleTabs;\n        let allVisibleContributedTabs = [];\n        if( allVisibleTabs ) {\n            allVisibleTabs.map( ( tab ) => {\n                let tabClone = { ...tab };\n                if( !tabClone.hasChildTabs ) {\n                    allVisibleContributedTabs.push( tabClone );\n                }\n            } );\n            if( allVisibleContributedTabs.length === 0 ) {\n                allVisibleContributedTabs = swaContributedTabs;\n            }\n        } else {\n            allVisibleContributedTabs = swaContributedTabs;\n        }\n\n        childTabs = output.childTabs;\n        _.forEach( childTabs, ( childTab ) => { childTab.priority = containerPriority; } );\n        tabsToShow = tabsToShow.concat( childTabs, allVisibleContributedTabs );\n    } else {\n        tabsToShow = updatedTabsToShow ? updatedTabsToShow : swaContributedTabs;\n    }\n\n    // sort the contributed and container tabs based on priority\n    tabsToShow.sort( function( t1, t2 ) {\n        return t1.priority - t2.priority;\n    } );\n\n    let requestedActiveTab = activeTab;\n    activeTab = evalTabObj( tabsToShow, activeTab );\n    if( !_.isEmpty( activeTab ) && isActiveTabStillVisible( tabsToShow, activeTab ) ) {\n        tabToActivate = activeTab;\n        tabsToShow = updateTabsToShow( tabsToShow, activeTab );\n    } else if( _.isEmpty( activeTab ) ) {\n        requestedActiveTab = localStorage.get( 'lastActiveTab' );\n        let activeTab1 = evalTabObj( tabsToShow, requestedActiveTab );\n        if( !_.isEmpty( activeTab1 ) && isActiveTabStillVisible( tabsToShow, activeTab1 ) && requestedActiveTab !== '' ) {\n            return fetchTabsData( selectionData, tabsConfig, containerTab, selection, requestedActiveTab, swaContributedTabs, data, context, dispatch, tabsToShow );\n        }\n        tabToActivate = tabsToShow[ 0 ];\n        tabsToShow = updateTabsToShow( tabsToShow, tabToActivate );\n    } else {\n        tabToActivate = tabsToShow[ 0 ];\n        tabsToShow = updateTabsToShow( tabsToShow, tabToActivate );\n    }\n    if( tabToActivate ) {\n        tabToActivate.tabContent = output ? output.activeTabContent : undefined;\n        tabToActivate.extraInfo = output ? output.extraInfo : null;\n    }\n\n    const tabChangeCallback = ( pageId, tabTitle, refresh ) => {\n        localStorage.publish( 'lastActiveTab', pageId );\n        clearSelectionData( selectionData );\n        activateTab( data, selectionData, tabsConfig, pageId, tabTitle, tabsToShow, swaContributedTabs, dispatch, selection, context, refresh, containerPriority );\n    };\n\n    const activeTabKey = tabToActivate && tabToActivate.tabKey ? tabToActivate.tabKey : tabToActivate ? tabToActivate.view : '';\n\n    let unExpandedVisibleTabs = data && data.ctx && data.ctx.visibleTabs ? data.ctx.visibleTabs : undefined;\n    if( !unExpandedVisibleTabs || unExpandedVisibleTabs.length === 0 ) {\n        unExpandedVisibleTabs = data && data.getData() && data.getData().summaryContext && data.getData().summaryContext.unExpandedVisibleTabs;\n    }\n\n    return {\n        summaryContext: {\n            activeTab: tabToActivate,\n            visibleTabs: tabsToShow,\n            api: tabChangeCallback,\n            selection: selection,\n            allVisibleTabs: updatedTabsToShow,\n            activeTabKey: activeTabKey,\n            childTabs: childTabs,\n            unExpandedVisibleTabs\n        }\n    };\n};\n\nconst fetchTabsData = ( selectionData, tabsConfig, containerTab, selection, activeTab, swaContributedTabs, data, context, dispatch, allVisibleTabs ) => {\n    return fetchChildTabs( containerTab, selection[ 0 ], activeTab, swaContributedTabs, context ).then( ( output ) => {\n        const currentSelection = data.getData().summaryContext && data.getData().summaryContext.selection ? data.getData().summaryContext.selection : undefined;\n        if( !currentSelection || currentSelection && currentSelection.length === 1 && currentSelection[ 0 ].uid === selection[ 0 ].uid ) {\n            return processFetchedData( data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, activeTab, output, containerTab.priority, allVisibleTabs, containerTab );\n        }\n        if( currentSelection && currentSelection.length === 1 ) {\n            return fetchTabsData( selectionData, tabsConfig, containerTab, currentSelection, activeTab, swaContributedTabs, data, context, dispatch );\n        }\n        return AwPromiseService.instance.resolve( { summaryContext: data.getData().summaryContext } );\n    } );\n};\n\nconst evalTabObj = ( tabsToShow, activeTab ) => {\n    if( typeof activeTab !== 'object' ) {\n        let index = _.findIndex( tabsToShow, ( tab ) => {\n            return tab.pageId && tab.pageId === activeTab || tab.tabKey && tab.tabKey === activeTab || tab.name && tab.name === activeTab\n            || tab.view && tab.view === activeTab || tab.id && tab.id === activeTab;\n        }, 0 );\n        activeTab = tabsToShow[ index ];\n    }\n    return activeTab;\n};\n\nconst isInputSelectionSameAsCurrentSelection = ( currentSelection, inputSelection ) => {\n    if(  !currentSelection && !inputSelection  ||  currentSelection && currentSelection.length === 0 && inputSelection && inputSelection.length === 0  ) {\n        return true;\n    }\n    return currentSelection.length === inputSelection.length && inputSelection.length > 0 && _.isEqual( currentSelection[ 0 ].uid, inputSelection[ 0 ].uid );\n};\n\nconst areInputPropsAndDataNotPopulatedYet = ( props, data ) => {\n    return !props || !props.selection || !data || !props.tabsConfig || !props.tabsConfig.tabs;\n};\n\nconst areCurrentUnexpandedVisibleTabsSameAsInputUnexpandedVisibleTabs = ( currentlyVisibleUnExpandedTabs, inputUnExpandedTabs ) => {\n    if( !currentlyVisibleUnExpandedTabs && !inputUnExpandedTabs ) {\n        return true;\n    }\n    if( !currentlyVisibleUnExpandedTabs || !inputUnExpandedTabs ) {\n        return false;\n    }\n    if( currentlyVisibleUnExpandedTabs.length !== inputUnExpandedTabs.length ) {\n        return false;\n    }\n\n    for( var i = 0; i < currentlyVisibleUnExpandedTabs.length; ++i ) {\n        var cachedTabKey = currentlyVisibleUnExpandedTabs[ i ].tabKey ? currentlyVisibleUnExpandedTabs[ i ].tabKey : currentlyVisibleUnExpandedTabs[ i ].name;\n        var receivedTabKey = inputUnExpandedTabs[ i ].tabKey ? inputUnExpandedTabs[ i ].tabKey : inputUnExpandedTabs[ i ].name;\n        if( cachedTabKey !== receivedTabKey ) {\n            return false;\n        }\n    }\n    return true;\n};\n\nconst isCurrentlyVisibleTabAContributedTabAndIsNoLongerAvailableInNewVisibleTabs = ( summaryContext, unExpandedVisibleTabs, currentlyActiveTabId ) => {\n    return summaryContext && summaryContext.activeTab && !summaryContext.activeTab.api && unExpandedVisibleTabs && unExpandedVisibleTabs.filter( tab => tab.view === currentlyActiveTabId ).length === 0;\n};\n\nconst isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab = ( tabRequestedToBeActivated, data ) => {\n    let currentlyActiveTabKey = data && data.summaryContext && data.summaryContext.activeTab && data.summaryContext.activeTab.tabKey ? data.summaryContext.activeTab.tabKey : data && data.summaryContext && data.summaryContext.activeTab && data.summaryContext.activeTab.view ? data.summaryContext.activeTab.view : '';\n    if( tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey ) {\n        currentlyActiveTabKey = data && data.getData() && data.getData().summaryContext && data.getData().summaryContext.activeTab && data.getData().summaryContext.activeTab.tabKey ? data && data.getData().summaryContext.activeTab.tabKey : data.getData() && data.getData().summaryContext && data.getData().summaryContext.activeTab && data.getData().summaryContext.activeTab.view ? data.getData().summaryContext.activeTab.view : '';\n        if( tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey ) {\n            currentlyActiveTabKey = data && data.summaryContext ? data.summaryContext.activeTabKey : '';\n            if( tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey ) {\n                currentlyActiveTabKey = data && data.getData().summaryContext ? data.getData().summaryContext.activeTabKey : '';\n                if( tabRequestedToBeActivated !== '' && tabRequestedToBeActivated !== currentlyActiveTabKey ) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n};\n\nexport const getTabToActivateAndVisibleTabs = ( data, props, unExpandedVisibleTabs ) => {\n    const getTabToActivate = () => {\n        let containerTabs = [];\n        let swaContributedTabs = [];\n        if( tabsConfig ) {\n            var allVisibleTabs = [];\n            tabsConfig.tabs.map( ( tab ) => {\n                let tabClone = { ...tab };\n                if( conditionFilter( tabClone, tabsConfig, localSelection, context ) ) {\n                    allVisibleTabs.push( tabClone );\n                }\n            } );\n\n            for( const tab of allVisibleTabs ) {\n                if( tab.hasChildTabs === true ) {\n                    containerTabs.push( tab );\n                } else {\n                    swaContributedTabs.push( tab );\n                }\n            }\n        }\n\n        if( containerTabs.length > 0 && !skipAfreshChildFetch ) {\n            dispatch( { path: 'data.changedAllVisibleTabs', value: [] } );\n            return fetchTabsData( props.selectionData, props.tabsConfig, containerTabs[ 0 ], localSelection, tabToActivateNow, swaContributedTabs, data, context, dispatch, allVisibleTabs );\n        }\n        if( containerTabs.length > 0 ) {\n            var output = { childTabs: data.summaryContext ? data.summaryContext.childTabs : [], activeTabContent: _.get( data, 'summaryContext.activeTab.tabContent' ) };\n            if( !output.extraInfo ) {\n                output.extraInfo = data.summaryContext && data.summaryContext.activeTab ? data.summaryContext.activeTab.extraInfo : null;\n            }\n            if( !output.childTabs || output.childTabs.length === 0 ) {\n                dispatch( { path: 'data.changedAllVisibleTabs', value: unExpandedVisibleTabs } );\n                return;\n            }\n            return AwPromiseService.instance.resolve( processFetchedData( data, props.selectionData, props.tabsConfig, localSelection, context, dispatch,\n                swaContributedTabs, tabToActivateNow, output, containerTabs[ 0 ].priority, allVisibleTabs, containerTabs[0] ) );\n        }\n        return AwPromiseService.instance.resolve( processFetchedData( data, props.selectionData, props.tabsConfig, localSelection, context, dispatch, swaContributedTabs, tabToActivateNow ) );\n    };\n\n    if( areInputPropsAndDataNotPopulatedYet( props, data ) ) {\n        return;\n    }\n\n    const { dispatch } = data;\n    const { summaryContext } = data.getData();\n    const { selection, context, tabsConfig } = props;\n    let localSelection = Array.isArray( selection ) ? selection : [ selection ];\n\n    let allVisibleTabsInternal = [];\n    if( tabsConfig ) {\n        tabsConfig.tabs.map( ( tab ) => {\n            let tabClone = { ...tab };\n            if( conditionFilter( tabClone, tabsConfig, localSelection, context ) ) {\n                allVisibleTabsInternal.push( tabClone );\n            }\n        } );\n    }\n\n    let tabRequestedToBeActivated = context && context.pageContext && context.pageContext.sublocationState && context.pageContext.sublocationState.secondaryActiveTabId !== '' ? context.pageContext\n        .sublocationState.secondaryActiveTabId : '';\n\n    if( !tabRequestedToBeActivated ) {\n        tabRequestedToBeActivated = '';\n    }\n\n    let currentlyActiveTabId = summaryContext && summaryContext.activeTabKey ? summaryContext.activeTabKey : '';\n    let tabToActivateNow = currentlyActiveTabId;\n\n    if( isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab( tabRequestedToBeActivated, data ) ) {\n        tabToActivateNow = tabRequestedToBeActivated;\n        localStorage.publish( 'lastActiveTab', tabToActivateNow );\n    }\n\n    if( summaryContext ) {\n        if( !isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab( tabRequestedToBeActivated, data ) && isInputSelectionSameAsCurrentSelection( summaryContext.selection, localSelection ) &&\n            areCurrentUnexpandedVisibleTabsSameAsInputUnexpandedVisibleTabs( summaryContext.unExpandedVisibleTabs, allVisibleTabsInternal ) ) {\n            return;\n        }\n    }\n\n    let skipAfreshChildFetch = false;\n\n    if( summaryContext ) {\n        if( isProgrammaticTabChangeRequestedAndIsDifferentThanCurrentlyActiveTab( tabRequestedToBeActivated, data ) ) {\n            tabToActivateNow = tabRequestedToBeActivated;\n        } else if( isInputSelectionSameAsCurrentSelection( summaryContext.selection, localSelection ) ) {\n            skipAfreshChildFetch = true;\n            if( isCurrentlyVisibleTabAContributedTabAndIsNoLongerAvailableInNewVisibleTabs( summaryContext, allVisibleTabsInternal, currentlyActiveTabId ) ) {\n                skipAfreshChildFetch = false;\n            }\n        }\n    }\n    if( tabToActivateNow === '' ) {\n        tabToActivateNow = localStorage.get( 'lastActiveTab' ) ? localStorage.get( 'lastActiveTab' ) : tabToActivateNow;\n    }\n\n    let localSummaryContext = { ...data.summaryContext };\n    localSummaryContext.selection = localSelection;\n    localSummaryContext.unExpandedVisibleTabs = allVisibleTabsInternal;\n    localSummaryContext.activeTabKey = tabToActivateNow;\n    dispatch( { path: 'data.summaryContext', value: localSummaryContext } );\n\n    let pwaEditContext = context ? context.editContext : '';\n    if( !pwaEditContext || pwaEditContext === '' ) {\n        pwaEditContext = 'TABLE_CONTEXT';\n    }\n    let pwaEditHandler = editHandlerService.getEditHandler( pwaEditContext );\n    const isActiveTabIsNonStickyAndNoSelectionChange = !summaryContext || _.get( summaryContext, 'activeTab.api' ) !== undefined || isInputSelectionSameAsCurrentSelection( summaryContext.selection, localSelection );\n    if( !pwaEditHandler || !pwaEditHandler.editInProgress() && isActiveTabIsNonStickyAndNoSelectionChange ) {\n        return editHandlerService.leaveConfirmation().then( function() {\n            return getTabToActivate();\n        } );\n    }\n    return getTabToActivate();\n};\n\nconst activateTab = ( data, selectionData, tabsConfig, pageId, tabTitle, tabsToShow, swaContributedTabs, dispatch, selection, context, refresh, containerPriority ) => {\n    const selectedTab = tabsToShow.filter( function( tab ) {\n        return tab.pageId === pageId || tab.name === tabTitle;\n    } )[ 0 ];\n\n    const updateSelectionSummaryContext = ( output ) => {\n        let { summaryContext } = processFetchedData( data, selectionData, tabsConfig, selection, context, dispatch, swaContributedTabs, selectedTab, output, containerPriority, tabsToShow );\n        dispatch( { path: 'data.summaryContext', value: summaryContext } );\n    };\n\n    const handleTabChange = () => {\n        if( selectedTab && selectedTab.api ) {\n            if( !selectedTab.tabContent || refresh ) {\n                const selectedTabTitle = selectedTab.tabKey ? selectedTab.tabKey : selectedTab.view;\n                dispatch( { path: 'data.summaryContext.activeTabKey', value: selectedTabTitle } );\n                selectedTab.api( selection[ 0 ], selectedTabTitle, null, null, context ).then( output => {\n                    updateSelectionSummaryContext( output );\n                } );\n            }\n        } else {\n            updateSelectionSummaryContext();\n        }\n    };\n\n    let pwaEditContext = context ? context.editContext : '';\n    if( !pwaEditContext || pwaEditContext === '' ) {\n        pwaEditContext = 'TABLE_CONTEXT';\n    }\n\n    let pwaEditHandler = editHandlerService.getEditHandler( pwaEditContext );\n\n    if( !pwaEditHandler || !pwaEditHandler.editInProgress() ) {\n        editHandlerService.leaveConfirmation().then( function() {\n            return handleTabChange();\n        } );\n    } else {\n        return handleTabChange();\n    }\n};\n\nexport const updateSelection = ( selection ) => {\n    return Array.isArray( selection ) ? selection : [ selection ];\n};\n\nexport const getContext = ( vmDef, props, data ) => {\n    return [ new DerivedStateResult( {\n        ctxParameters: [],\n        additionalParameters: [ data.summaryContext, props.selection, props.context, props.selectionData ],\n        compute: () => {\n            return {\n                activeTab: data.summaryContext ? data.summaryContext.activeTab : undefined,\n                selection: Array.isArray( props.selection ) ? props.selection : [ props.selection ],\n                context: props.context,\n                api: data.summaryContext ? data.summaryContext.api : undefined,\n                selectionData: props.selectionData\n            };\n        }\n    } ) ];\n};\n\nconst clearSelectionData = ( selectionData ) => {\n    if( selectionData && selectionData.getValue() && selectionData.getValue().selected && selectionData.getValue().selected.length > 0 ) {\n        selectionData.update( { selected: [], relationInfo: [] } );\n    }\n};\n\nconst getTabsState = ( tabsConfig ) => {\n    if( tabsConfig ) {\n        return ( tabsConfig.tabs || [] ).reduce( ( acc, tab ) => {\n            let visibleWhenCondition = {};\n            if( tab.visibleWhen && tab.visibleWhen.condition ) {\n                visibleWhenCondition = _.get( tabsConfig, tab.visibleWhen.condition );\n            } else {\n                visibleWhenCondition.expression = tab.visibleWhen;\n            }\n            const conditionDeps = [ parseCondition( visibleWhenCondition, [ 'selection', 'context' ] ) ];\n            return {\n                ctxParameters: _.uniq( concat( flatten( conditionDeps.map( x => x.ctxParameters ) ), acc.ctxParameters ) ),\n                additionalParameters: _.uniq( concat( acc.additionalParameters, flatten( conditionDeps.map( x => x.additionalParameters ) ) ) )\n            };\n        }, {\n            ctxParameters: [],\n            additionalParameters: []\n        } );\n    }\n    return {\n        ctxParameters: [],\n        additionalParameters: []\n    };\n};\n\nexport const getVisibleTabs = ( vmDef, props, data ) => {\n    let { context, tabsConfig, selection, additionalParameters, ctxParameters } = props;\n    let localSelection = Array.isArray( selection ) ? selection : [ selection ];\n    const getAllVisibleTabs = () => {\n        let allVisibleTabs = [];\n        if( tabsConfig ) {\n            tabsConfig.tabs.map( ( tab ) => {\n                let tabClone = { ...tab };\n                if( conditionFilter( tabClone, tabsConfig, localSelection, context ) ) {\n                    allVisibleTabs.push( tabClone );\n                }\n            } );\n        }\n        if( allVisibleTabs ) {\n            return allVisibleTabs;\n        }\n    };\n    const scope = {\n        context,\n        selection\n    };\n    const getFromProps = ( path ) => _.get( scope, path );\n    const localAdditionalParameters = additionalParameters.map(\n        getFromProps );\n\n    return new DerivedStateResult( {\n        ctxParameters,\n        additionalParameters: localAdditionalParameters,\n        compute: getAllVisibleTabs\n    } );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}