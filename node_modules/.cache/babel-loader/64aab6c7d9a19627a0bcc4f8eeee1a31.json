{"ast":null,"code":"var _s4 = $RefreshSig$(),\n    _s5 = $RefreshSig$();\n\nvar _jsxFileName = \"C:\\\\Users\\\\rahukl57\\\\Desktop\\\\SWF\\\\CreatingOwnComponentUsingJsx\\\\node_modules\\\\@swf\\\\core\\\\src\\\\declreact\\\\src\\\\js\\\\reactPopup.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _this = this; // Copyright (c) 2020 Siemens\n\n/* eslint-disable require-jsdoc */\n\n/**\n * @module js/reactPopup\n */\n\n\nimport AwPromiseService from 'js/awPromiseService';\nimport { consolidateOptions } from 'js/popupService';\nimport { Tooltip } from 'js/tooltip';\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useInitHook } from 'js/reactHelper';\nimport _ from 'lodash';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst hasStaticReference = reference => reference && (_.isString(reference) || Boolean(reference.nodeName));\n\nconst usePopupInternal = initialOptions => {\n  _s4();\n\n  _s(); // the reference element which has the popup - could be static or dynamic\n  // 1, static - existed, selector or native dom element, eg: 'div.sw-logoImage'\n  // 2, dynamic - will be generated, vdom element\n\n\n  let reference = useRef(null);\n\n  if (hasStaticReference(initialOptions.reference)) {\n    reference = initialOptions.reference;\n  }\n\n  let uuid = useRef(null); // the popup element\n\n  let popupReference = useRef(null); // enable popup api return promise\n\n  let [showDeferred, hideDeferred] = [useRef(null), useRef(null)]; // popup options - only initialize once, call updateOptions to update the options\n\n  let baseOptions = consolidateOptions({ ...initialOptions,\n    popupReference,\n    reference,\n    showDeferred,\n    hideDeferred,\n    uuid\n  }, hide, updateOptions); // could change incrementally\n\n  let currentOptions = baseOptions;\n  const [options, setOptions] = useState(baseOptions);\n  useEffect(() => {\n    if (options.open && popupReference.current) {\n      let componentWillUnMounted = options.componentMounted(options, popupReference.current);\n      return () => componentWillUnMounted();\n    }\n\n    return undefined;\n  }, [options.open]); // support dynamic popup reference\n\n  useEffect(() => {\n    updateOptions({\n      reference\n    });\n  }, [reference.current]);\n\n  function show() {\n    let newOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    let force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false; // avoid event being passed in, cases of <Component action={popup.show} />\n\n    newOptions && newOptions.type && (newOptions = null); // always use base options for global popup\n\n    const base = baseOptions.global ? baseOptions : options; // mix-in new options if any\n\n    newOptions && Object.keys(newOptions).length > 0 && (currentOptions = consolidateOptions({ ...base,\n      ...newOptions\n    })); // run beforeOpen check to ensure whether need to change state\n    // `force === true` to skip beforeOpen check\n\n    let condition = force || currentOptions.beforeOpen(); // exclude toggleMode case  - null\n    // exclude multiple case    - popupRef\n\n    if (condition === true) {\n      updateOptions(Object.assign(currentOptions, {\n        open: true\n      }));\n    }\n\n    showDeferred.current = AwPromiseService.instance.defer();\n    hideDeferred.current = AwPromiseService.instance.defer();\n    return showDeferred.current.promise;\n  }\n\n  function hide() {\n    updateOptions({\n      open: false\n    }); // case null hideDeferred.current - means already being closed, return directly\n\n    return hideDeferred.current ? hideDeferred.current.promise : Promise.resolve(true);\n  }\n\n  function updateOptions(newOptions) {\n    setOptions(prev => {\n      // always return independent options for global case\n      if (newOptions.global) {\n        return newOptions;\n      }\n\n      return { ...prev,\n        ...newOptions\n      };\n    });\n  }\n\n  return {\n    // popup state and options\n    open: options && options.open,\n    options,\n    // getter - the reference element which owns the popup\n    reference,\n    // popup APIs - the apis to show / hide popup\n    show,\n    hide,\n    update: updateOptions\n  };\n};\n\n_s4(usePopupInternal, \"zV5uERPu49DLyRBG5octNrReuQQ=\");\n\n_s(usePopupInternal, \"OWeBv77KXYC+QD87XTf5y0PBBTA=\");\n\nconst usePopup = function (initialOptions) {\n  _s5();\n\n  _s2();\n\n  initialOptions = initialOptions || {};\n  const popup = usePopupInternal(initialOptions);\n  popup.userOptions = useRef(null); // mount\n\n  useInitHook(() => {\n    if (initialOptions.preset === 'tooltip') {\n      // tipWrapper.hooks to support tooltip move-in feature\n      // popup.userOptions - dynamic user options\n      // for debug: to quick enable / disable tooltip\n      // let show = () => null;\n      // let hide = () => null;\n      let show = () => popup.show({ ...tipWrapper.hooks,\n        ...popup.userOptions.current\n      }, true);\n\n      let hide = () => popup.hide();\n\n      const tipWrapper = new Tooltip(popup.reference.current, popup.options, show, hide); // return unmount fn inside of `tipWrapper.configure`\n\n      return tipWrapper.configure(tipWrapper);\n    }\n\n    return undefined;\n  }, popup.reference.current);\n  return popup;\n};\n\n_s5(usePopup, \"z+WUv/9RMdImwQPx921VVjrbR3s=\", false, function () {\n  return [usePopupInternal, useInitHook];\n});\n\n_s2(usePopup, \"z+WUv/9RMdImwQPx921VVjrbR3s=\", false, function () {\n  return [usePopupInternal, useInitHook];\n});\n\nconst handler = {\n  get: (target, key) => {\n    return target.prototype[key];\n  }\n}; // initialize popups for viewModel based on it's popup actions\n\nconst usePopups = function (viewModel) {\n  const initialOptionsMap = _.reduce(viewModel.declViewModelJson.actions, (result, _ref, actionId) => {\n    let {\n      actionType,\n      options,\n      inputData\n    } = _ref;\n    actionType === 'popup' && (result[actionId] = inputData && inputData.options || options);\n    return result;\n  }, {}); // fixed loop, safe to use.\n  // https://stackoverflow.com/questions/53906843/why-cant-react-hooks-be-called-inside-loops-or-nested-function\n\n\n  _.each(initialOptionsMap, function useLoop(initialOptions, actionId) {\n    let fn = initialOptions && initialOptions.preset === 'test' ? useTestContent : usePopup;\n    let action = viewModel.actions[actionId];\n    let actionHandler = fn(initialOptions);\n\n    if (!initialOptions || initialOptions.preset !== 'test') {\n      // extend action by proxy\n      action.prototype = actionHandler;\n      actionHandler = new Proxy(action, handler);\n    }\n\n    viewModel.actions[actionId] = actionHandler;\n  });\n}; // test harness for popup, purpose to provide dynamic/rich content to demonstrate the reactivity of popup.\n// remove in future.\n\n\nlet i = 1;\n\nconst title = /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"header-label\",\n  children: \"Lorem ipsum\"\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 162,\n  columnNumber: 15\n}, this); // eslint-disable-next-line max-len\n\n\nconst lorem = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure cillum dolore pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.';\nconst testActions = [{\n  action: setter => () => setter(prev => {\n    return { ...prev,\n      ...{\n        body: generateContent()\n      }\n    };\n  }),\n  label: 'Load More Data'\n}, {\n  action: setter => () => setter(prev => {\n    return { ...prev,\n      ...{\n        body: generateContent(true)\n      }\n    };\n  }),\n  label: 'Reset Data'\n}, {\n  action: target => () => target.hide(),\n  label: 'Close',\n  path: 'target'\n}];\n\nconst actions = (setter, target, ActionComponent) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: testActions.map(_ref2 => {\n      let {\n        action,\n        label,\n        path\n      } = _ref2;\n      return /*#__PURE__*/_jsxDEV(ActionComponent, {\n        action: path ? action(target) : action(setter),\n        className: \"small sample-btn\",\n        children: label\n      }, label, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 59\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 172,\n    columnNumber: 12\n  }, this);\n};\n\nconst generateContent = function () {\n  let reset = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n  if (reset) {\n    i = 0;\n  }\n\n  i += 1;\n  const items = Array.from({\n    length: i\n  }, (v, i) => i);\n  return items.reduce((total, item) => {\n    total.push( /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [lorem, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 42\n      }, _this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 47\n      }, _this)]\n    }, item, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 21\n    }, _this));\n    return total;\n  }, []);\n}; // simulate dynamic binding data\n// content could be changed anytime by actions\n\n\nconst useTestContent = () => {\n  var _s6 = $RefreshSig$();\n\n  var _s3 = $RefreshSig$();\n\n  return _s6(_s3(_s6(ActionComponent => {\n    _s6();\n\n    _s3(); // eslint-disable-next-line react-hooks/rules-of-hooks\n\n\n    const [content, setContent] = useState({\n      header: title,\n      actions: target => actions(setContent, target, ActionComponent),\n      body: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [lorem, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 34\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 39\n        }, this)]\n      }, -1, true, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 15\n      }, this)\n    });\n    return content;\n  }, \"WaUuTn1XjpfKS9y8Xh5Gi5A60TU=\"), \"mr1zRfjlSC5BYCs/zGWsMrK6wW4=\"), \"WaUuTn1XjpfKS9y8Xh5Gi5A60TU=\");\n};\n\nexport { usePopup, usePopups, useTestContent };","map":{"version":3,"sources":["C:/Users/rahukl57/Desktop/SWF/CreatingOwnComponentUsingJsx/node_modules/@swf/core/src/declreact/src/js/reactPopup.js"],"names":["hasStaticReference","reference","_","Boolean","usePopupInternal","initialOptions","useRef","uuid","popupReference","baseOptions","consolidateOptions","currentOptions","useState","useEffect","options","componentWillUnMounted","updateOptions","newOptions","force","base","Object","condition","open","showDeferred","AwPromiseService","hideDeferred","Promise","setOptions","prev","update","usePopup","popup","useInitHook","show","tipWrapper","current","hide","handler","get","target","usePopups","initialOptionsMap","viewModel","inputData","actionType","result","fn","action","actionHandler","i","title","lorem","testActions","setter","body","generateContent","label","path","actions","reset","items","length","total","useTestContent","ActionComponent","header"],"mappings":"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","sourcesContent":["// Copyright (c) 2020 Siemens\n/* eslint-disable require-jsdoc */\n\n/**\n * @module js/reactPopup\n */\nimport AwPromiseService from 'js/awPromiseService';\nimport { consolidateOptions } from 'js/popupService';\nimport { Tooltip } from 'js/tooltip';\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useInitHook } from 'js/reactHelper';\nimport _ from 'lodash';\n\nconst hasStaticReference = ( reference ) => reference && ( _.isString( reference ) || Boolean( reference.nodeName ) );\n\nconst usePopupInternal = ( initialOptions ) => {\n    // the reference element which has the popup - could be static or dynamic\n    // 1, static - existed, selector or native dom element, eg: 'div.sw-logoImage'\n    // 2, dynamic - will be generated, vdom element\n    let reference = useRef( null );\n    if( hasStaticReference( initialOptions.reference ) ) {\n        reference = initialOptions.reference;\n    }\n\n    let uuid = useRef( null );\n\n    // the popup element\n    let popupReference = useRef( null );\n\n    // enable popup api return promise\n    let [ showDeferred, hideDeferred ] = [ useRef( null ), useRef( null ) ];\n\n    // popup options - only initialize once, call updateOptions to update the options\n    let baseOptions = consolidateOptions( { ...initialOptions, popupReference, reference, showDeferred, hideDeferred, uuid }, hide, updateOptions );\n    // could change incrementally\n    let currentOptions = baseOptions;\n    const [ options, setOptions ] = useState( baseOptions );\n\n    useEffect( () => {\n        if( options.open && popupReference.current ) {\n            let componentWillUnMounted = options.componentMounted( options, popupReference.current );\n            return () => componentWillUnMounted();\n        }\n        return undefined;\n    }, [ options.open ] );\n\n    // support dynamic popup reference\n    useEffect( () => {\n        updateOptions( { reference } );\n    }, [ reference.current ] );\n\n    function show( newOptions = null, force = false ) {\n        // avoid event being passed in, cases of <Component action={popup.show} />\n        newOptions && newOptions.type && ( newOptions = null );\n        // always use base options for global popup\n        const base = baseOptions.global ? baseOptions : options;\n        // mix-in new options if any\n        newOptions && Object.keys( newOptions ).length > 0 && ( currentOptions = consolidateOptions( { ...base, ...newOptions } ) );\n\n        // run beforeOpen check to ensure whether need to change state\n        // `force === true` to skip beforeOpen check\n        let condition = force || currentOptions.beforeOpen();\n        // exclude toggleMode case  - null\n        // exclude multiple case    - popupRef\n        if( condition === true ) {\n            updateOptions( Object.assign( currentOptions, { open: true } ) );\n        }\n\n        showDeferred.current = AwPromiseService.instance.defer();\n        hideDeferred.current = AwPromiseService.instance.defer();\n\n        return showDeferred.current.promise;\n    }\n\n    function hide() {\n        updateOptions( { open: false } );\n        // case null hideDeferred.current - means already being closed, return directly\n        return hideDeferred.current ? hideDeferred.current.promise : Promise.resolve( true );\n    }\n\n    function updateOptions( newOptions ) {\n        setOptions( ( prev ) => {\n            // always return independent options for global case\n            if( newOptions.global ) {\n                return newOptions;\n            }\n            return { ...prev, ...newOptions };\n        } );\n    }\n\n    return {\n        // popup state and options\n        open: options && options.open,\n        options,\n\n        // getter - the reference element which owns the popup\n        reference,\n\n        // popup APIs - the apis to show / hide popup\n        show,\n        hide,\n        update: updateOptions\n    };\n};\n\nconst usePopup = function( initialOptions ) {\n    initialOptions = initialOptions || {};\n    const popup = usePopupInternal( initialOptions );\n    popup.userOptions = useRef( null );\n\n    // mount\n    useInitHook( () => {\n        if( initialOptions.preset === 'tooltip' ) {\n            // tipWrapper.hooks to support tooltip move-in feature\n            // popup.userOptions - dynamic user options\n            // for debug: to quick enable / disable tooltip\n            // let show = () => null;\n            // let hide = () => null;\n            let show = () => popup.show( { ...tipWrapper.hooks, ...popup.userOptions.current }, true );\n            let hide = () => popup.hide();\n            const tipWrapper = new Tooltip( popup.reference.current, popup.options, show, hide );\n            // return unmount fn inside of `tipWrapper.configure`\n            return tipWrapper.configure( tipWrapper );\n        }\n        return undefined;\n    }, popup.reference.current );\n\n    return popup;\n};\n\nconst handler = {\n    get: ( target, key ) => {\n        return target.prototype[ key ];\n    }\n};\n\n// initialize popups for viewModel based on it's popup actions\nconst usePopups = function( viewModel ) {\n    const initialOptionsMap = _.reduce( viewModel.declViewModelJson.actions, ( result, { actionType, options, inputData }, actionId ) => {\n        actionType === 'popup' && ( result[ actionId ] = inputData && inputData.options || options );\n        return result;\n    }, {} );\n\n    // fixed loop, safe to use.\n    // https://stackoverflow.com/questions/53906843/why-cant-react-hooks-be-called-inside-loops-or-nested-function\n    _.each( initialOptionsMap, function useLoop( initialOptions, actionId ) {\n        let fn = initialOptions && initialOptions.preset === 'test' ? useTestContent : usePopup;\n        let action = viewModel.actions[ actionId ];\n        let actionHandler = fn( initialOptions );\n        if( !initialOptions || initialOptions.preset !== 'test' ) {\n            // extend action by proxy\n            action.prototype = actionHandler;\n            actionHandler = new Proxy( action, handler );\n        }\n        viewModel.actions[ actionId ] = actionHandler;\n    } );\n};\n\n// test harness for popup, purpose to provide dynamic/rich content to demonstrate the reactivity of popup.\n// remove in future.\nlet i = 1;\nconst title = <div className='header-label'>Lorem ipsum</div>;\n// eslint-disable-next-line max-len\nconst lorem =\n    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure cillum dolore pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.';\nconst testActions = [\n    { action: setter => () => setter( ( prev ) => { return { ...prev, ...{ body: generateContent() } }; } ), label: 'Load More Data' },\n    { action: setter => () => setter( ( prev ) => { return { ...prev, ...{ body: generateContent( true ) } }; } ), label: 'Reset Data' },\n    { action: target => () => target.hide(), label: 'Close', path: 'target' }\n];\nconst actions = ( setter, target, ActionComponent ) => {\n    return <div>\n        { testActions.map( ( { action, label, path } ) => <ActionComponent key={label} action={ path ? action( target ) : action( setter ) } className='small sample-btn'>{ label }</ActionComponent> ) }\n    </div>;\n};\nconst generateContent = ( reset = false ) => {\n    if( reset ) {\n        i = 0;\n    }\n    i += 1;\n    const items = Array.from( { length: i }, ( v, i ) => i );\n    return items.reduce( ( total, item ) => {\n        total.push( <p key={item}>{lorem}<br/><br/></p> );\n        return total;\n    }, [] );\n};\n\n// simulate dynamic binding data\n// content could be changed anytime by actions\nconst useTestContent = () => ( ActionComponent ) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const [ content, setContent ] = useState( {\n        header: title,\n        actions: ( target ) => actions( setContent, target, ActionComponent ),\n        body: <p key={-1}>{lorem}<br/><br/></p>\n    } );\n\n    return content;\n};\n\nexport {\n    usePopup,\n    usePopups,\n    useTestContent\n};\n"]},"metadata":{},"sourceType":"module"}