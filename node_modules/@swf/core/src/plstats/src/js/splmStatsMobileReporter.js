// Copyright (c) 2020 Siemens

/**
 * Reporter for Mobile Devices
 *
 * @module js/splmStatsMobileReporter
 *
 * @publishedApolloService
 *
 */
import _ from 'lodash';
import messagingService from 'js/messagingService';

/**
 * Instances of this class represent a reporter for Mobile Devices
 *
 * @class SPLMStatsMobileReporter
 */
function SPLMStatsMobileReporter() {
    let self = this;

    self.report = function( obj ) {
        const failedRequests = obj.Network.errorInfo.requestsAborted.concat( obj.Network.errorInfo.requestsErrored ).concat( obj.Network.errorInfo.requestsTimeout );
        const showMsg = _.debounce( function() {
            var objStr = 'Performance Metrics:';
            objStr += '\nTTI: ' + obj.TTI.toFixed( 3 ) + 'ms';
            objStr += '\nTotal Network Time: ' + obj.totalNetworkTime.toFixed( 3 ) + 'ms';
            objStr += '\nTotal SOA Requests: ' + obj.Network.SoaDetails.length;
            objStr += '\nFailed SOA Requests: ' + failedRequests.length;
            objStr += '\nTotal HTTP Requests: ' + obj.Network.totalHttpRequests;
            objStr += '\nDOM Node Count: ' + obj.DOM.elemCount;
            objStr += '\nDOM Tree Depth: ' + obj.DOM.DOMTreeDepth;
            objStr += '\nNumber of Unique Components: ' + obj.Component.uniqueComponents;
            objStr += '\nNumber of Component Renders: ' + obj.Component.componentRenders;
            messagingService.showInfo( objStr );
        }, 1000, { leading: false, trailing: true } );
        showMsg();
    };

    self.reportCustom = function( input ) {
        const showMsg = _.debounce( function() {
            var _input = '~Invalid input~';
            if( typeof input === 'string' ) {
                _input = input;
            } else if( typeof input === 'function' ) {
                _input = input();
            } else if( typeof input === 'object' ) {
                _input = JSON.stringify( input );
            }
            messagingService.showInfo( _input );
        }, 500, { leading: true, trailing: false } );
        showMsg();
    };
    return self;
}

export default SPLMStatsMobileReporter;
