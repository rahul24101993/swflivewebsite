// Copyright (c) 2021 Siemens
import AwPic from 'viewmodel/AwPicViewModel';
import wcagSvc from 'js/wcagService';
import { noop } from 'js/declUtils';

export const awTabRenderFunction = ( props ) => {
    const { tabModel, onTabSelected, onTabClose } = props;
    const tabSelectedClass = props.tabModel.selectedTab ? 'sw-tab-selected ' : 'sw-tab-title';

    const onKeyDown = ( event, tabModel ) => {
        if( wcagSvc.isValidKeyPress( event ) ) {
            onTabSelected( tabModel );
        }
    };


    //Close tab key press
    const onTabCloseKeyDown = ( event, tabModel ) => {
        event.stopPropagation();
        if( wcagSvc.isValidKeyPress( event ) ) {
            onTabClose( tabModel );
        }
    };

    //Close tab
    const onTabCloseClick = ( event, tabModel ) => {
        event.stopPropagation();
        onTabClose( tabModel );
    };

    const showCloseableButton = ( tabModel ) => {
        const tabCloseableClass = props.tabModel.selectedTab ? ' aw-tab-highLightedCloseButton ' : ' aw-tab-normalCloseButton ';
        if( tabModel.closeable ) {
            return (
                <div className={`aw-tab-close-button-container ${tabCloseableClass}`} tabIndex='0'
                    role='button' aria-label={tabModel.closeCommandTitle} onClick={( event )=> onTabCloseClick( event, tabModel )}
                    onKeyDown={( event )=>onTabCloseKeyDown( event, tabModel )}>
                    <AwPic className='sw-tab-icon' iconId={tabModel.closeCommandIcon}></AwPic>
                </div>
            );
        }
    };

    return tabModel.displayTab && tabModel.name ?
        <li className='sw-tab' role='tab' aria-selected={tabModel.selectedTab} >
            <a href={noop}
                className={'sw-row sw-aria-border ' + tabSelectedClass}
                aria-label={tabModel.name}
                name={tabModel.pageId}
                tabKey={tabModel.tabKey}
                tabIndex={0}
                onClick={() => onTabSelected( tabModel )}
                onKeyDown={( event ) => onKeyDown( event, tabModel )}>
                <AwPic className='sw-tab-icon' iconId={tabModel.iconId} source={tabModel.source}></AwPic>
                {tabModel.name}
                {tabModel.closeable ? showCloseableButton( tabModel ) : ''}
            </a>
        </li> :
        '';
    // to remove Sonar code smell issue, above line should be: <></>;
    // unfortunately this fails audit atm due to a issue parsing the jsx fragment
    // Prasad Sawant is creating a Polarion item to track and fix, then this can be removed
};
