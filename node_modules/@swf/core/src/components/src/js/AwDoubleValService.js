// Copyright (c) 2021 Siemens
import AwPropertyNonEditVal from 'viewmodel/AwPropertyNonEditValViewModel';
import AwPropertyLovVal from 'viewmodel/AwPropertyLovValViewModel';
import sanitizer from 'js/sanitizer';
import { getValClass } from 'js/componentUtils';

export const awDoubleValRenderFunction = ( props ) => {
    const {
        viewModel,
        ctxMin,
        actions,
        i18n,
        fields,
        grids,
        formProp,
        messages,
        ...prop
    } = props;
    // use simple non-edit val if not editing
    if( !prop.fielddata.isEditable ) {
        return (
            <AwPropertyNonEditVal {...prop}></AwPropertyNonEditVal>
        );
    }

    let sanitizedProps = sanitizer.sanitizeHTMLTagProps( prop, 'input' );
    const inputClass = getValClass( props );

    var handleChange = ( event ) => {
        if( prop.typex === 'DOUBLEARRAY' ) {
            let newVal = event.target.value.replace( /[^\+|\-|0-9\.|e]/g, '' );
            event.target.value = newVal;
        }
    };
    var keyPressed = ( event ) => {
        if( event.key === 'Enter' || event.type === 'blur' && prop.typex === 'DOUBLEARRAY' ) {
            event.preventDefault();
            prop.onChange( event );
            event.target.value = '';
        }
    };
    if( prop.fielddata.renderingHint === 'label' ) {
        return (
            <AwPropertyNonEditVal {...prop} ></AwPropertyNonEditVal>
        );
    } else if( !prop.fielddata.renderingHint && prop.fielddata.hasLov ) {
        return (
            <AwPropertyLovVal {...prop} onChange={handleChange}></AwPropertyLovVal>
        );
    } else if( prop.typex === 'DOUBLEARRAY' ) {
        return (
            <input type='text' maxLength={prop.maxLength} data-locator={prop.label} aria-required={prop.isRequired} placeholder={prop.placeholder} className={inputClass} onChange={handleChange} onKeyPress={keyPressed} onBlur={keyPressed}/>
        );
    }
    return (
        <input {...sanitizedProps} className={inputClass} type='text' autoComplete='off'/>
    );
};
