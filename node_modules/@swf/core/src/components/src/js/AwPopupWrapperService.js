import React from 'react';
import _ from 'lodash';
import AwPopup from 'viewmodel/AwPopupViewModel';
import AwInclude from 'viewmodel/AwIncludeViewModel';

export const awPopupWrapperRenderFunction = ( props ) => {
    const { popup, content, children } = props;
    const { options, reference, open } = popup;

    const renderChildContent = () => {
        if( children ) {
            return typeof children === 'function' ?
                children( reference ) :
                React.cloneElement( children, {
                    ref: reference,
                    // Case HOC component
                    domRef: reference
                } );
        }
        return null;
    };

    const renderPopoverContent = () => {
        let fill = <>empty</>;
        if( options.view ) {
            fill = <AwInclude name={options.view} subPanelContext={options.subPanelContext}/>;
        } else if( content ) {
            fill = content;
        }
        return open && <AwPopup {...options}>{fill}</AwPopup>;
    };

    return <>
        { renderChildContent() }
        { renderPopoverContent() }
    </>;
};
