// Copyright (c) 2020 Siemens
/* eslint-env es6 */

/**
 * This utility module provides helpful functions for HTML content.
 *
 * @module js/htmlUtils
 */

var exports = {};

/**
 * Locate the closest element or parent element by selector
 *
 * @param {DOMElement} element element to start search
 *
 * @param {String} selector css selector to use in locating closest element
 *
 * @param {Int} maxLevelsUp the maximum levels up to search
 *
 * @returns {DOMElement} the closest parent element
 */
exports.closestElement = function( element, selector, maxLevelsUp ) {
    if( element && typeof element.length !== 'undefined' && element.length ) {
        element = element[ 0 ];
    }

    var matchesFn;

    // find vendor prefix
    [ 'matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector' ].some( function( fn ) {
        if( typeof document.body[ fn ] === 'function' ) {
            matchesFn = fn;
            return true;
        }
        return false;
    } );

    // check for current element matching
    if( element && element[ matchesFn ]( selector ) ) {
        return element;
    }

    // traverse parents
    var parent;
    var currLevelUp = 1;
    while( element ) {
        if( maxLevelsUp !== undefined && currLevelUp > maxLevelsUp ) {
            return null;
        }

        parent = element.parentElement;
        if( parent && parent[ matchesFn ]( selector ) ) {
            return parent;
        }
        element = parent;
        currLevelUp++;
    }

    return null;
};

/**
 * Locate an element given an xpath and an element to start the search.
 *
 * @param {String} xpath xpath to use to locate
 * @param {DOMElement} element element to start search
 * @returns {DOMElement} located element or null
 */
exports.getElementByXpath = function( xpath, element ) {
    return document.evaluate( xpath, element, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null ).singleNodeValue;
};

export default exports;
