// Copyright (c) 2021 Siemens

/**
 * @module js/useVmoStore
 */
import { useCtx } from './reactAppCtx';

/**
 * Custom hook to sync up component properties with the VMO store based on the "props" configuration
 *
 * @param {Object} props Properties for this component
 * @param {Object} definition View model JSON definition
 * @returns {Object} Update version of any view model object properties. Key will not be set if props configuration is not "viewModelObject"
 */
export const useVmoStore = ( props, definition ) => {
    return Object.entries( definition || {} )
        .reduce( ( acc, [ name, propDef ] ) => {
            if( propDef.type === 'viewModelObject' ) {
                const path = [ 'vmo', props[name] ? props[name].uid : 'null' ];
                // eslint-disable-next-line react-hooks/rules-of-hooks
                const ctxVal = useCtx( path ).value;
                acc[name] = ctxVal || props[name];
            }
            return acc;
        }, {} );
};

export default useVmoStore;
