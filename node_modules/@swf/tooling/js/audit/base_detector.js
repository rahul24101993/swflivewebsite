const { get } = require( 'lodash' );

/**
 * Detect common things in modules
 */
module.exports = {
    id: 'base',
    /**
     * Get anything that other modules could depend on
     */
    getIncluded: async( loader ) => {
        const jsFileList = await loader.getFileList( 'src/js' );
        let js = jsFileList.map( x => `js/${x.replace( /\.js$/, '' )}` );
        const bootstrap = await loader.getJson( 'bootstrap.json' );
        if( get( bootstrap, 'config.paths' ) ) {
            for( const shortcut of Object.keys( bootstrap.config.paths ) ) {
                for( const path of js ) {
                    if( path.startsWith( bootstrap.config.paths[ shortcut ] ) ) {
                        js.push( path.replace( bootstrap.config.paths[ shortcut ], shortcut ) );
                    }
                }
            }
            js = [ ...js, ...Object.keys( bootstrap.config.paths ) ];
        }
        const viewModelList = await loader.getFileList( 'src/viewmodel' );
        const viewModel = viewModelList.map( x => x.replace( /ViewModel\.json$/, '' ) );
        return {
            js,
            'view model': viewModel
        };
    }
};
