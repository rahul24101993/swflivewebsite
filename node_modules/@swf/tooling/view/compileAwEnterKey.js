/* eslint-disable complexity */
/* eslint-disable sonarjs/cognitive-complexity */
// Copyright (c) 2020 Siemens
/* eslint-env node */

/**
 * aw-enter-key Node Compiler
 */
const {
    Node
} = require( './utils' );

const Attr = 'aw-enter-key';

/**
 * Evaluate condition for current compiler
 * @param {Node} node input DOM Node
 * @param {context} context input context
 * @returns {boolean} true if condition matches
 */
const when = ( node ) => {
    return node.nodeType === Node.ELEMENT_NODE &&
        node.hasAttribute( Attr );
};

/**
 * Compile view input to target framework format
 * @param {Node} node input DOM Node
 * @param {context} context input context
 * @returns {Array} compile output as string array
 */
const compile = ( node, context ) => {
    let exprEnterKey = node.getAttribute( Attr );
    if( exprEnterKey ) {
        exprEnterKey = exprEnterKey.replace( /(\r\n|\n|\r)/gm, '' ).trim();
        if( !exprEnterKey.startsWith( 'actions' ) ) {
            exprEnterKey = 'actions.' + exprEnterKey;
        }
        node.removeAttribute( Attr );
        node.setAttribute( Attr + '-hoc', `{{${exprEnterKey}}}` );
    }
    return context.compileFn( node, context );
};

module.exports = {
    when,
    compile
};
