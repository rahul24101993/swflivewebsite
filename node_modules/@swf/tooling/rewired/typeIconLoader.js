// Copyright (c) 2022 Siemens

const { getEffectiveAlias } = require( './utils' );
const { Stopwatch } = require( './perfUtils' );

/**
 * Fetch type icons
 */
module.exports = function( source ) {
    const stopwatch = new Stopwatch( 'typeIconLoader' );

    let typeIcons = [];
    let aliasMap = getEffectiveAlias() || {};
    typeIcons = Object.keys( aliasMap ).filter( key => /^image[\\/]type([^\\/]*).svg$/.test( key ) ).map( key => key.replace( /^image[\\/]([^\\/]*).svg$/, '$1' ) );

    const output = source.replace( '//AFX_CONFIG_ENTRY', JSON.stringify( typeIcons ) );
    stopwatch.end();
    return output;
};
