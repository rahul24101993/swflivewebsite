// Copyright (c) 2022 Siemens

const { getEffectiveAlias } = require( './utils' );
const { Stopwatch } = require( './perfUtils' );

/**
 * main function of schema json loader
 * @param {string} source input file content
 * @returns {string} modified source as return value
 */
module.exports = function( source ) {
    const stopwatch = new Stopwatch( 'componentRegistryLoader' );
    const aliasMap = getEffectiveAlias();
    const vmKeys = Object.keys( aliasMap ).filter( key => /^viewmodel[\\/]/.test( key ) );
    const output = source.replace( '//SWF_COMPONENT_CHECKER_COMMENT', vmKeys );
    stopwatch.end();
    return output;
};
