#!/usr/bin/env node

const argv = require( 'yargs' )
    .demandCommand( 0 )
    .usage( 'Usage: node $0 [options]' )
    .example( 'node $0', 'Start the HTTP server' )
    .options( {
        config: {
            description: 'path to configuration file',
            normalize: true,
            config: true
        },
        siteDir: {
            alias: 'path',
            description: 'path to site directory',
            default: 'site',
            normalize: true
        },
        index: {
            description: 'index file',
            default: 'index.html'
        },
        port: {
            description: 'HTTP server port to use\noverridden by EXPRESS_PORT environment variable',
            default: 3000,
            number: true
        },
        log_level: {
            description: 'logger output level\noverridden by LOG_LEVEL environment variable',
            default: process.env.LOG_LEVEL || 'info'
        },
        launch: {
            description: 'launch browser upon startup?',
            default: false,
            boolean: true
        },
        livereload: {
            description: 'livereload server port; disabled if 0',
            default: 0,
            number: true
        }
    } )
    .argv;

const options = argv.config && require( argv.config ) || {};
require( __dirname + '/lib/expressServer' ).launch( options );
