(this.webpackJsonpcreatingjsxcomponent=this.webpackJsonpcreatingjsxcomponent||[]).push([[52],{213:function(t,n,e){"use strict";e.r(n),e.d(n,"setAuthStatus",(function(){return L})),e.d(n,"getAuthStatus",(function(){return M})),e.d(n,"isAuthenticationInProgress",(function(){return b})),e.d(n,"setAuthenticationInProgress",(function(){return O})),e.d(n,"pickAuthenticator",(function(){return I})),e.d(n,"terminateSession",(function(){return N})),e.d(n,"setLocationToDefault",(function(){return T})),e.d(n,"locationReplace",(function(){return R})),e.d(n,"postSignOut",(function(){return w})),e.d(n,"checkSessionValid",(function(){return y})),e.d(n,"authenticationSuccessful",(function(){return x})),e.d(n,"resetPipeLine",(function(){return C})),e.d(n,"runPostAuthInit",(function(){return B})),e.d(n,"runPostLoginBlocking",(function(){return E})),e.d(n,"runNavToState",(function(){return J})),e.d(n,"initLocalStorage",(function(){return U})),e.d(n,"reset",(function(){return j}));var i,o,a=e(19),u=e(581),r=e(582),s=e(7),c=e(26),f=e(98),l=e(32),h=e(6),g=e(82),p=e(0),S=e(159),d=e(11),v=e(43),A=e(499),P=void 0!==c.default.getUrlAttributes().logAuthActivity,k=!1,m={};let L=function(t){f.a.setAuthStatus(t)},M=function(){return f.a.getIsAuthenticated()},b=function(){return f.a.isAuthenticationInProgress()},O=function(t){f.a.setAuthenticationInProgress(t)},I=function(){return o?d.a.instance.resolve(o):a.default.getCfg("solutionDef").then((function(n){return t=n.authenticator,a.default.getCfg("authenticator")})).then((function(n){return P&&h.a.info("SM: pickAuthenticator: "+t),p.b.loadDependentModule(n[t].dep)})).then((function(t){if(!t)throw new Error("No authenticator provided!");return t.getAuthenticator()})).then((function(t){return o=t}));var t};let N=function(){return sessionStorage.clear(),m.pickAuthenticator().then((function(){return function(){if(o)return o.signOut().then((function(){m.postSignOut()})).catch((function(){h.a.error("SM: authenticator signOut() err"),m.postSignOut()}));h.a.error("SM:ERROR - processing signOut, but no Authenticator is available")}()}))},T=function(){var t=location.origin+location.pathname+location.search;o&&o.getPostSignOutURL&&(t=o.getPostSignOutURL(),k=!0),P&&h.a.info("SM: setLocationToDefault - target URL: "+t),m.locationReplace(t)},R=function(t){k=!0,location.replace(t)},w=function(){m.setAuthStatus(!1),m.setAuthenticationInProgress(!1),l.default.publish("signingOut","true"),m.setLocationToDefault()};l.default.subscribe("signingOut",(()=>{T()}));let y=function(t){i=t,P&&h.a.info("SM: checkSessionValid: navigationTarget="+t),l.default.removeItem("signingOut");var n=d.a.instance.defer();return m.pickAuthenticator().then((function(t){P&&h.a.info("SM: authenticator chosen"),t.checkIfSessionAuthenticated().then((function(){P&&h.a.info("SM: auth check Good! already authenticated"),m.setAuthStatus(!0),r.a.checkPostLoginAuthenticatedStages()?(m.runNavToState(),s.a.publish("authentication.complete",{status:"OK"})):m.runPostLoginBlocking().then((function(){m.runNavToState(),s.a.publish("authentication.complete",{status:"OK"})}),(function(){P&&h.a.info("SM: end runPostLoginBlocking Stage - but ERROR"),m.runNavToState(),s.a.publish("authentication.complete",{status:"OK"})})),n.resolve()})).catch((function(t){P&&h.a.info("SM: auth check exception: \n"+JSON.stringify(t,null,2)+'\n SM: Go to "checkAuthentication" state'),t&&t.cause&&500===t.cause.status&&(h.a.error(t),window.location.replace(c.default.getBaseURL()+"serverError.html")),m.setAuthenticationInProgress(!0),v.a.instance.go("checkAuthentication"),s.a.publish("authentication.complete",{status:"Failed"}),n.resolve()}))}),(function(t){h.a.error("SM: Unable to pick an authenticator - serious configuration error!"),s.a.publish("authentication.complete",{status:"Failed"}),n.reject(t)})),n.promise},x=function(){return m.setAuthStatus(!0),m.setAuthenticationInProgress(!1),P&&h.a.info('SM: authSuccessful, fire "session.signIn" event'),s.a.publish("session.signIn",{}),m.runPostAuthInit().then((function(){return P&&h.a.info("SM: runPostAuthInit Stage complete - continue to next Auth step"),m.runPostLoginBlocking()})).then((function(){return m.runNavToState()}))},C=function(){P&&h.a.info("SM: resetPipeLine"),r.a.resetPostLoginStages()},B=function(){return m.pickAuthenticator().then((function(){return P&&h.a.info("SM: runPostAuthInit"),g.a.authenticationSuccessful(),o?o.postAuthInitialization():d.a.instance.resolve()}))};var D=function(t,n,e,i){P&&h.a.info("SM: running on steps for idx: "+n+" name: "+t.name),t.active||(P&&h.a.info("SM: not active, skipping step: "+t.name),e(n));var o=d.a.instance.defer();if(o.promise.then((function(){P&&h.a.info("SM: done with pipeline Step continue. "+t.name),e(n)}),(function(){P&&h.a.info("SM: done with pipeline Step - REJECT "+t.name),i(n)})),t.routeName&&t.routeName.length>0){var a=t.routeName,u=v.a.instance.get(a);u&&(u.data?u.data.nextContinuation=o:u.data={nextContinuation:o}),v.a.instance.go(a,{},{notify:!0,location:!1})}else t.workFunction?t.workFunction(t,o):(P&&h.a.info("SM: No work function, assume fOK path"),e(n))};let E=function(){var t=d.a.instance.defer();return u.a.loadContributions("postLoginPipeline").then((function(n){if(n&&n.length>0){var e=r.a.sortPostLoginPipeline(n);if(e&&e.length>0){var i=null,o=null;i=function(n){e[n].status=!0,l.default.publish("postLoginStagesKey",JSON.stringify(e));var a=n+1;a>=e.length?(P&&h.a.info("SM: done with last step, continue post promise"),t.resolve()):D(e[a],a,i,o)},o=function(n){e[n].status=!1,l.default.publish("postLoginStagesKey",JSON.stringify(e)),P&&h.a.info("SM: one of the steps had an error: "+n),t.reject()};for(var a=null,u=0;u<e.length;u++)if(!e[u].status){a=e[u];break}a?D(a,u,i,o):t.resolve()}else t.resolve()}else t.resolve()}),(function(){h.a.error("SM: contribution service error for postLoginPipeline"),t.resolve()})),t.promise},J=function(){i?(P&&h.a.info("SM: runNavToState Stage - redirect to original target: "+i.toState),v.a.instance.go(i.toState,i.toParams,i.options)):h.a.error("SM: post auth, runNavToState - NO saved Nav Target!!")};function K(){k||location.reload(!1)}let U=function(){l.default.subscribe("awSession",K)},j=function(){o=null};m={setAuthStatus:L,getAuthStatus:M,isAuthenticationInProgress:b,setAuthenticationInProgress:O,pickAuthenticator:I,terminateSession:N,setLocationToDefault:T,locationReplace:R,postSignOut:w,checkSessionValid:y,authenticationSuccessful:x,resetPipeLine:C,runPostAuthInit:B,runPostLoginBlocking:E,runNavToState:J,initLocalStorage:U,reset:j},n.default=m,U(),A.default.initProfiler(),S.a.initClickListener()}}]);