(this.webpackJsonpcreatingjsxcomponent=this.webpackJsonpcreatingjsxcomponent||[]).push([[47],{3112:function(e,t,r){"use strict";r.r(t),r.d(t,"updateSearchContext",(function(){return f})),r.d(t,"createStateFromUrl",(function(){return F})),r.d(t,"createSearchFilterMapFromUrl",(function(){return v})),r.d(t,"getSearchFilterStringFromActiveFilterMap",(function(){return C})),r.d(t,"getActiveFilters",(function(){return b})),r.d(t,"lazyUpdate",(function(){return m})),r.d(t,"updateURL",(function(){return y})),r.d(t,"updateSearchCriteria",(function(){return A})),r.d(t,"syncStateFromUrl",(function(){return M})),r.d(t,"getSelectedFiltersMap",(function(){return x})),r.d(t,"updateSearchPWASelectionModel",(function(){return U})),r.d(t,"getActiveSublocationTab",(function(){return O})),r.d(t,"updateChartsDataOnSelectionChange",(function(){return T})),r.d(t,"updateSublocationTabs",(function(){return _})),r.d(t,"updateGlobalSelection",(function(){return V})),r.d(t,"updateSelectionQueryParamInURL",(function(){return k})),r.d(t,"updateSearchStateWithSelectionData",(function(){return I}));var a=r(1),i=r.n(a),l=r(2968),n=r(2996),c=r(12),o=r(43),s=r(15);const u={constructBaseSearchCriteria:(e,t)=>{const r=c.default.getCtx("preferences"),a=r.AWC_ColorFiltering[0];e.colorToggle=e.showChartColorBars?a:"false",e.forceChart=u.getForceChartParameterValue(e),e.bulkFiltering=!1!==e.bulkFiltering,e.showAutoUpdateFilteringOption=u.getValueForShowAutoUpdateFilteringOption(),e.bulkFilteringPreference="AWC_Search_Auto_Update_Filters",e.autoApplyFilters=!e.bulkFiltering||u.getAutoUpdateFilteringPreferenceValue(),e.bulkFiltersApplied=!1;const i=c.default.getCtx("searchPreFilters"),l=i?i.ownPrefilters:void 0,n=i?i.catPrefilters:void 0;if("Awp0FullTextSearchProvider"===e.provider)e.criteria=e.criteria?e.criteria:{},e.criteria.limitedFilterCategoriesEnabled=e.criteria&&e.criteria.limitedFilterCategoriesEnabled?e.criteria.limitedFilterCategoriesEnabled:r.AWC_Limited_Filter_Categories_Enabled[0],e.criteria.listOfExpandedCategories="",n&&n.selectedCategory&&n.selectedCategory.length>0||l&&l.selectedCategory&&l.selectedCategory.length>0?e.criteria.forceThreshold="true":t&&t.hasOwnProperty("filter")&&t.filter&&t.filter.length>0&&(e.criteria.forceThreshold="false"),t&&t.hasOwnProperty("savedSearchUid")&&(e.criteria.savedSearchUid=t.savedSearchUid);return e},getForceChartParameterValue:e=>{let t=!0;if(e&&e.selectFirstObjectPreference){let r=c.default.getCtx("preferences."+e.selectFirstObjectPreference);r=r&&r[0]?r[0].toLowerCase():void 0,t="true"!==r}return t},getCriteriaForNewSearch:(e,t)=>{let r=e.criteria;if(r&&(r.searchString=t,"Awp0FullTextSearchProvider"===e.provider))r.forceThreshold="true",r.listOfExpandedCategories="";return r},getCriteriaAfterFilterSelection:e=>{let t=e.criteria;if("Awp0FullTextSearchProvider"===e.provider)t.forceThreshold="false",e.additionalSearchString&&e.additionalSearchString.length>0&&(t.searchString=e.additionalSearchString);return t},getAutoUpdateFilteringPreferenceValue:()=>{let e=!0,t=c.default.getCtx("preferences.AWC_Search_Auto_Update_Filters");return t=t&&t[0]?t[0].toLowerCase():void 0,e="false"!==t,e},getValueForShowAutoUpdateFilteringOption:()=>{let e=!0,t=c.default.getCtx("preferences.AWC_Search_Show_Auto_Update_Filters");return t=t&&t[0]?t[0].toLowerCase():void 0,e="false"!==t,e}};var d=u,p=r(3100),g=r(2993),h=r(39);const S=new(r.n(h).a)("selection"),f=e=>{var t=c.default.getCtx(e.clientScopeURI+".sortCriteria");void 0===t||""===t?(c.default.updatePartialCtx(e.clientScopeURI+".sortCriteria",[]),c.default.updatePartialCtx("sublocation.sortCriteria",[])):c.default.updatePartialCtx("sublocation.sortCriteria",t)},F=(e,t,r,a,i,n,c)=>{if(i)return;const[u,p]=w(t,r,a),g=o.a.instance,h=g.params,S=e.context&&e.context.search?e.context.search:{},f=e.selectionQueryParamKey?e.selectionQueryParamKey:"s_uid";let F,C,b="",m="";h.hasOwnProperty("searchCriteria")&&(b=h.searchCriteria?h.searchCriteria:b),h.hasOwnProperty("filter")&&(m=h.filter?h.filter:m),h.hasOwnProperty(f)&&(F=h[f],C=f);const P=g.current.data&&g.current.data.label?g.current.data.label:"";const y={...d.constructBaseSearchCriteria(S,h)},A=S.chartTitle;let M=A?s.default.getLocalizedText(A.source,A.key):new Promise((e=>e())),x=y.criteria&&y.criteria.hasOwnProperty("searchString")&&y.criteria.searchString.length>0?y.criteria.searchString:b;return M.then((t=>{const{activeFilterMap:r}=v(e),a=l.a.getFilters();y.criteria=Object.assign({},y.criteria,n),y.criteria.searchString=x;let i={searchStringPrimary:x,searchStringSecondary:"",label:P,filterString:m,totalFound:S.showLoadingText?void 0:0,loadDataAction:S.loadDataAction,provider:S.provider,sortType:S.sortType,chartTitle:t,objectsGroupedByProperty:null,activeFilters:a,activeFilterMap:r,searchInProgress:x&&x.length>0||m&&m.length>0,searchFilterMap:{},selectionQueryParam:{key:C,value:F}};Object.assign(y,i),p?p(y):u.update(y),U(c,i.selectionQueryParam)}))},v=e=>({activeFilterMap:l.a.buildSearchFilters(e.context).activeFilterMap}),C=e=>{let t={};if(e&&e.length>0)for(let r=0;r<e.length;r++){let a=e[r];t[a.name]=a.values}return l.a.buildFilterString(t)},b=e=>{const t=e.map((e=>e&&e.filterValues&&e.filterValues.length>0?e.filterValues.filter((e=>e.selected.value)):[]));return i.a.flatten(t)},m=(e,t)=>{if(e&&e.activeFilters){let r=o.a.instance.params.searchCriteria;const a=l.a.buildFilterString(e.activeFilters);if(e.filterString!==a&&(e.autoApplyFilters||e.bulkFiltersApplied)){const r=l.a.buildSearchFiltersFromSearchState(e.activeFilters);let i=d.getCriteriaAfterFilterSelection(e),n=d.getForceChartParameterValue(e);if(l.a.doSearch(null,i?i.searchString:null,e.activeFilters),t)t({...e,criteria:i,forceChart:n,filterString:a,activeFilterMap:r.activeFilterMap,searchInProgress:!0,categories:void 0,additionalSearchString:void 0});else{let t={...e.value};t.criteria=i,t.forceChart=n,t.filterString=a,t.activeFilterMap=r.activeFilterMap,t.searchInProgress=!0,t.categories=void 0,t.additionalSearchString=void 0,e.update(t)}}else if(a===e.selectedFiltersString||e.autoApplyFilters||e.bulkFiltersApplied){if(r&&e.criteria&&e.criteria.searchString!==r)if(l.a.doSearch(null,e.criteria.searchString,e.activeFilters),t)t({...e,categories:void 0});else{let t={...e.value};t.categories=void 0,e.update(t)}}else{e.selectedFiltersString=a;const r=l.a.getPendingFiltersMap(e.activeFilters,e.activeFilterMap),i=l.a.buildSearchFiltersFromSearchState(r.positivePendingFilterMap),n=l.a.buildSearchFiltersFromSearchState(r.negativePendingFilterMap);if(t)t({...e,positivePendingFilters:i.activeFilters,negativePendingFilters:n.activeFilters,positivePendingFilterMap:i.activeFilterMap,negativePendingFilterMap:n.activeFilterMap});else{let t={...e.value};t.positivePendingFilters=i.activeFilters,t.negativePendingFilters=n.activeFilters,t.positivePendingFilterMap=i.activeFilterMap,t.negativePendingFilterMap=n.activeFilterMap,e.update(t)}}}else if(o.a.instance.params.filter&&e.filterString!==o.a.instance.params.filter)if(t)t({...e,filterString:o.a.instance.params.filter});else{let t={...e.value};t.filterString=o.a.instance.params.filter,e.update(t)}};let P=i.a.debounce(((e,t)=>{m(e,t)}),800);const y=(e,t,r,a)=>{if(a)return;const[i,l]=w(e,t,r);P(i,l)},A=(e,t,r)=>{let a=e.getAtomicData();const i=Object.assign({},a.criteria,r);t.searchState({...a,criteria:i})},w=(e,t,r)=>{const a=e||t;return e&&e.update?[a,void 0]:[a,r.searchState]},M=(e,t,r)=>{const[a,i]=w(e,t,r),n=o.a.instance.params;let c=null,s="";if(n.hasOwnProperty("searchCriteria")&&(c=n.searchCriteria),n.hasOwnProperty("filter")&&(s=n.filter?n.filter:s),c&&a&&a.criteria&&a.criteria.searchString!==c||s!==a.filterString){const e=l.a.getFilterMapWithPrefilters(),t=l.a.buildSearchFiltersFromSearchState(e);let r={criteria:d.getCriteriaForNewSearch(a,c),searchStringPrimary:c,searchStringSecondary:"",activeFilters:e,activeFilterMap:t.activeFilterMap,categories:[],filterString:s,searchFilterCategories:[],categoriesExpandCollapseMap:void 0,allCategoriesVisible:void 0,searchInProgress:!0,totalFound:a.showLoadingText?void 0:0,forceChart:d.getForceChartParameterValue(a)};if(r.criteriaJSONString=JSON.stringify(r.criteria),i)i({...a,...r});else{let e={...a.value};Object.assign(e,r),a.update(e)}}},x=e=>{var t={};for(const[r,a]of Object.entries(e))if(a){let e=[];a.filterValues&&a.filterValues.length>0&&a.filterValues.forEach((r=>{if(r.selected.dbValue)switch(a.type){case"NumericFilter":{let t=n.a.INTERNAL_NUMERIC_FILTER+r.internalName;e.push(t);break}case"DateFilter":{let e=t[r.categoryName]?t[r.categoryName]:[];e.push(r.internalName),t[r.categoryName]=e;break}default:e.push(r.internalName)}})),a.numericRangeString&&e.push(a.numericRangeString),a.dateRangeString&&e.push(a.dateRangeString),e.length&&(t[a.internalName]=e)}return l.a.removeDependentDateFilters(t)},U=(e,t)=>{!e.getSelection().length&&t&&t.value&&e.setSelection([t.value])},O=e=>{let t="";if(e&&e.length>0){let r=e.filter((e=>e.selectedTab))[0];t=r.id||r.tabKey||r.name}return t},T=(e,t,r)=>{const[a,i]=w(e,t,r);if(a&&a.pwaSelection){const e=a.pwaSelection,t=!e||0===e.length,r=t?"true":"false";if(i)i({...a,forceChart:t,recreateChartProvider:r});else{let e={...a.value};e.forceChart=t,e.recreateChartProvider=r,a.update(e)}}},_=(e,t)=>{e&&t.dbValue&&t.dbValue.primaryActiveTabId&&""!==t.dbValue.primaryActiveTabId&&Object(p.tabCallbackApi)(void 0,t.dbValue.primaryActiveTabId,e)},V=(e,t)=>{i.a.isEmpty(e)||(t?t.update(e):g.a.updateSelection(e.selected,e.pselected,e.relationInfo),S("AwSearchSublocationService selectionData: ",e))},k=(e,t)=>{const r=e||t;if(r.selectionQueryParam&&r.selectionQueryParam.key){let e=r.pwaSelection&&1===r.pwaSelection.length?r.pwaSelection[0].uid:null;o.a.instance.go(".",{[r.selectionQueryParam.key]:e})}},I=(e,t,r)=>{const a=e||t;if(!i.a.isEmpty(r)){let e=a?{...a.value}:void 0;e&&("primary"===r.source?e.pwaSelection=r.selected?r.selected:[]:"base"!==r.source&&void 0!==r.source||(e.pwaSelection=[]),a.update(e))}},N={updateSearchContext:f,createStateFromUrl:F,createSearchFilterMapFromUrl:v,getSearchFilterStringFromActiveFilterMap:C,getActiveFilters:b,lazyUpdate:m,updateURL:y,updateSearchCriteria:A,syncStateFromUrl:M,getSelectedFiltersMap:x,updateSearchPWASelectionModel:U,getActiveSublocationTab:O,updateChartsDataOnSelectionChange:T,updateSublocationTabs:_,updateGlobalSelection:V,updateSearchStateWithSelectionData:I,updateSelectionQueryParamInURL:k};t.default=N}}]);